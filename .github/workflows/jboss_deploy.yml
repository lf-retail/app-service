name: Deploy WAR to JBoss

on:
  workflow_dispatch:
env:
  GITHUB_TOKEN: ${{ secrets.Workflow2_PAT_TOKEN_GITHUB }}
  
jobs:
  deploy:
    runs-on: self-hosted
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
        
      - name: list 
        run: |
         ls -l /opt/wildfly/bin/
         echo "WAR_PATH: $WAR_PATH"
         


      - name: Set up JDK 11
        uses: actions/setup-java@v3
        with:
          java-version: '11'
          distribution: 'temurin'  
          
      - name: login to JBoss and deploy war file
        env:
          JBOSS_USERNAME: ${{ secrets.JBOSS_USERNAME }} 
          JBOSS_PASSWORD: ${{ secrets.JBOSS_PASSWORD }} 
          #JBOSS_ENDPOINT: ${{ vars.JBOSS_ENDPOINT }} 
          #AWS_SSH_KEY: ${{ secrets.AWS_SSH_KEY }}
          #WAR_PATH: ${{github.workspace }}
          
        run: |

         echo "Running undeploy command"
         #cp ${{ github.workspace }}/helloworld.war /home/ubuntu/app-dir/
         #cd ${{ github.workspace }}/dist
         '/opt/wildfly/bin/jboss-cli.sh --connect --controller=13.234.120.105 --user=$JBOSS_USERNAME --password=$JBOSS_PASSWORD --command="undeploy /home/ubuntu/app-dir/helloworld.war"'

         #echo "Running deploy command"
         #'/opt/wildfly/bin/jboss-cli.sh --connect --controller=13.234.120.105 --user=$JBOSS_USERNAME --password=$JBOSS_PASSWORD --command="deploy $WAR_PATH --server-groups=HelloWorld"'
         #sshpass -p $AWS_SSH_KEY ssh ubuntu@13.234.120.105 '/opt/wildfly/bin/jboss-cli.sh --connect --controller=13.234.120.105 --user=$JBOSS_USERNAME --password=$JBOSS_PASSWORD --command="deploy ${{github.workspace }}/helloworld.war --server-groups=HelloWorld"'

         #echo "Check deployment status"
         #sshpass -p $AWS_SSH_KEY ssh ubuntu@13.234.120.105 '/opt/wildfly/bin/jboss-cli.sh --connect --controller=13.234.120.105 --user=$JBOSS_USERNAME --password=$JBOSS_PASSWORD --command="deployment-info --name=helloworld.war"'
