#!/bin/bash

# Server details (adapt these variables to your environment)
WAS_HOST="10.15.11.209"
WAS_PORT="9043" # Change to your WAS administrative port, often 9043 for HTTPS
WAS_ADMIN_USER="deployer"
WAS_ADMIN_PASSWORD="deployer@123"

# WAR file and application details
WAR_FILE_PATH="/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war"
APP_NAME="KYC_Remediation"
CONTEXT_ROOT="KYC_Remediation"

# Combine all shared libraries into a single string
SHARED_LIB=$(printf ",%s" "$@")
SHARED_LIB=${SHARED_LIB:1} # Remove the leading comma

# Path to wsadmin.sh (adjust for your WAS installation)
WSADMIN="/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/wsadmin.sh"

# wsadmin script content
WSADMIN_SCRIPT="
# Connect to WebSphere Application Server
AdminConfig.connect('$WAS_ADMIN_USER', '$WAS_ADMIN_PASSWORD')

# Check if the application already exists
if AdminApp.list().find('$APP_NAME') != -1:
    print('Application $APP_NAME already exists. Skipping installation.')
else:
    # Install the application with Parent Last class loader policy
    AdminApp.install('$WAR_FILE_PATH', '[ -appname $APP_NAME -contextroot $CONTEXT_ROOT -MapModulesToServers [[ .* .* WebSphere:cell=YourCellName,node=YourNodeName,server=YourServerName ]] -MapWebModToVH [[ .* .* default_host ]] -classloaderMode PARENT_LAST ]')
    # Install the application
    #AdminApp.install('$WAR_FILE_PATH', '[ -appname $APP_NAME -contextroot $CONTEXT_ROOT -MapWebModToVH [[ .* .* default_host ]] ]')
    # Map shared libraries (Optional: Adjust or remove according to your requirements)
    AdminConfig.create('LibraryRef', AdminConfig.getid('/Deployment:$APP_NAME/'), '[[libraryName $SHARED_LIB]]')
    # Save configuration changes
    AdminConfig.save()

# Disconnect from the server
AdminConfig.disconnect()
"

# Check if shared libraries were provided
if [ -z "$SHARED_LIB" ]; then
    echo "No shared libraries provided. Deployment failed."
    exit 1
fi

# Execute the script with wsadmin
echo "Deploying $APP_NAME from WAR file: $WAR_FILE_PATH"
echo "$WSADMIN_SCRIPT" | $WSADMIN -lang jython -conntype SOAP -host $WAS_HOST -port $WAS_PORT -user $WAS_ADMIN_USER -password $WAS_ADMIN_PASSWORD

if [ $? -eq 0 ]; then
    echo "Deployment of $APP_NAME completed successfully."
else
    echo "Deployment failed. Check the output for errors."
    exit 1
fi
===================

#!/bin/bash

# Server details

WAS_HOST="10.15.11.209"

WAS_PORT="9043"

WAS_ADMIN_USER="deployer"

WAS_ADMIN_PASSWORD="deployer@123"

# WAR file and application details

WAR_FILE_PATH="/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war"

APP_NAME="KYC_Remediation"

CONTEXT_ROOT="KYC_Remediation"

# Combine shared libraries into a single string

SHARED_LIB="ibps_library,omnidocs_library,wfs_library,od_library"

# Path to wsadmin.sh

WSADMIN="/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/wsadmin.sh"

# wsadmin script content

WSADMIN_SCRIPT="

# Check if the application already exists

if '$APP_NAME' in AdminApp.list().splitlines():

    print('Application $APP_NAME already exists. Skipping installation.')

else:

    # Install the application

    AdminApp.install('$WAR_FILE_PATH', '-appname $APP_NAME -contextroot $CONTEXT_ROOT -MapWebModToVH [[ .* .* default_host ]]')

    # Map shared libraries

    AdminConfig.create('LibraryRef', AdminConfig.getid('/Deployment:$APP_NAME/'), '[[libraryName $SHARED_LIB]]')

    # Save configuration changes

    AdminConfig.save()

"

# Execute the script with wsadmin

echo "Deploying $APP_NAME from WAR file: $WAR_FILE_PATH"

echo "$WSADMIN_SCRIPT" | $WSADMIN -lang jython -conntype SOAP -host $WAS_HOST -port $WAS_PORT -user $WAS_ADMIN_USER -password $WAS_ADMIN_PASSWORD

# Check deployment status

if [ $? -eq 0 ]; then

    echo "Deployment of $APP_NAME completed successfully."

else

    echo "Deployment failed. Check the output for errors."

    exit 1

fi

==============

I wanted to confirm that the deployment of the IBPS lose file on the UAT cluster servers, 10.15.11.209 and 10.15.11.210, has been completed successfully.

Currently, we're in the process of implementing another script for the installation of the WAR file on the WAS console. However, we've encountered some issues along the way.

Could you please confirm the port number for the WAS server?

WAS_HOST="10.15.11.209"
WAS_PORT="9043" 


===============

Dear Shanmuganathan,

As per the below error script is try to find below SOAP port.

SOAP_CONNECTOR_ADDRESS=8879

Also below highlighted part below application (KYC_Remediation) is already installed in server. 

Deploying KYC_Remediation from WAR file: /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war
WASX7023E: Error creating "SOAP" connection to host "10.15.11.209"; exception information: com.ibm.websphere.management.exception.ConnectorNotAvailableException: [SOAPException: faultCode=SOAP-ENV:Protocol; msg=Unsupported response content type &quot;text/html&quot;, must be: &quot;text/xml&quot;. Response was:
&lt;H1&gt;SRVE0255E: A WebGroup/Virtual Host to handle / has not been defined.&lt;/H1&gt;&lt;BR&gt;&lt;H3&gt;SRVE0255E: A WebGroup/Virtual Host to handle 10.15.11.209:9043 has not been defined.&lt;/H3&gt;&lt;BR&gt;
]
WASX7213I: This scripting client is not connected to a server process; please refer to the log file /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/logs/wsadmin.traceout for additional information.
WASX8011W: AdminTask object is not available.
WASX7031I: For help, enter: "print Help.help()"
wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>Traceback (innermost last):
  (no code object) at line 0
  File "<input>", line 2
SyntaxError: invalid syntax
wsadmin>Application KYC_Remediation already exists. Skipping installation.
wsadmin>wsadmin>Traceback (innermost last):
  (no code object) at line 0
  File "<input>", line 1
        else:
        ^
SyntaxError: invalid syntax
wsadmin>wsadmin>wsadmin>wsadmin>WASX7015E: Exception running command: "    AdminApp.install('/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war', '-appname KYC_Remediation -contextroot KYC_Remediation -MapWebModToVH [[ .* .* default_host ]]')"; exception information:
com.ibm.ws.scripting.ScriptingException: WASX7206W: The application management service is not running. Application management commands will not run.
 
wsadmin>wsadmin>wsadmin>wsadmin>WASX7015E: Exception running command: "    AdminConfig.create('LibraryRef', AdminConfig.getid('/Deployment:KYC_Remediation/'), '[[libraryName ibps_library,omnidocs_library,wfs_library,od_library]]')"; exception information:
com.ibm.ws.scripting.ScriptingException: WASX7070E: The configuration service is not available.
 
wsadmin>wsadmin>wsadmin>wsadmin>WASX7015E: Exception running command: "    AdminConfig.save()"; exception information:
com.ibm.ws.scripting.ScriptingException: WASX7070E: The configuration service is not available.
 
wsadmin>wsadmin>wsadmin>Deployment failed. Check the output for errors.


I wanted to inform you that the deployment of the IBPS loose files on the UAT cluster servers, 10.15.11.209 and 10.15.11.210, has been successfully completed.
Currently, we are in the process of implementing another script for the installation of the WAR file on the WAS console. Unfortunately, we've encountered some issues along the way.
During our discussion with Anisur Rahman from the IBPS team, he suggested changing the SOAP port and implementing the script in case the WAR application is already installed.
I'm actively working on this and will provide you with an update once it's done.
=====================

#!/bin/bash

# Server details

WAS_HOST="10.15.11.209"

WAS_PORT="8879"

WAS_ADMIN_USER="deployer"

WAS_ADMIN_PASSWORD="deployer@123"

# WAR file and application details

WAR_FILE_PATH="/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war"

APP_NAME="KYC_Remediation"

CONTEXT_ROOT="KYC_Remediation"

# Combine shared libraries into a single string

SHARED_LIB="ibps_library,omnidocs_library,wfs_library,od_library"

# Path to wsadmin.sh

WSADMIN="/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/wsadmin.sh"

# wsadmin script content

WSADMIN_SCRIPT="

# Check if the application already exists

if '$APP_NAME' in AdminApp.list().splitlines():

    print('Application $APP_NAME already exists. Skipping installation.')

else:

    # Install the application
	
	 AdminApp.help()

    # AdminApp.install('$WAR_FILE_PATH', '-appname $APP_NAME -contextroot $CONTEXT_ROOT -MapWebModToVH [[ .* .* default_host ]]')

    # Map shared libraries

    # AdminConfig.create('LibraryRef', AdminConfig.getid('/Deployment:$APP_NAME/'), '[[libraryName $SHARED_LIB]]')

    # Save configuration changes

    # AdminConfig.save()

"

# Execute the script with wsadmin

echo "Deploying $APP_NAME from WAR file: $WAR_FILE_PATH"

echo "$WSADMIN_SCRIPT" | $WSADMIN -lang jython -conntype SOAP -host $WAS_HOST -port $WAS_PORT -user $WAS_ADMIN_USER -password $WAS_ADMIN_PASSWORD

# Check deployment status

if [ $? -eq 0 ]; then

    echo "Deployment of $APP_NAME completed successfully."

else

    echo "Deployment failed. Check the output for errors."

    exit 1

fi
=================

#!/bin/bash
# Server details
WAS_HOST="10.15.11.209"
WAS_PORT="8879"
WAS_ADMIN_USER="deployer"
WAS_ADMIN_PASSWORD="deployer@123"

# WAR file and application details
WAR_FILE_PATH="/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war"
APP_NAME="KYC_Remediation"
CONTEXT_ROOT="KYC_Remediation"

# Combine shared libraries into a single string
SHARED_LIB="ibps_library,omnidocs_library,wfs_library,od_library"

# Path to wsadmin.sh
WSADMIN="/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/wsadmin.sh"

# wsadmin script content
WSADMIN_SCRIPT="

# Check if the application already exists
if '$APP_NAME' in AdminApp.list().splitlines():
    #print('Application $APP_NAME already exists. Skipping installation.')
    AdminApp.help()
else:
    # Install the application
	 AdminApp.help()
    # AdminApp.install('$WAR_FILE_PATH', '-appname $APP_NAME -contextroot $CONTEXT_ROOT -MapWebModToVH [[ .* .* default_host ]]')
    # Map shared libraries
    # AdminConfig.create('LibraryRef', AdminConfig.getid('/Deployment:$APP_NAME/'), '[[libraryName $SHARED_LIB]]')
    # Save configuration changes
    # AdminConfig.save()
"

# Execute the script with wsadmin
echo "Deploying $APP_NAME from WAR file: $WAR_FILE_PATH"
echo "$WSADMIN_SCRIPT" | $WSADMIN -lang jython -conntype SOAP -host $WAS_HOST -port $WAS_PORT -user $WAS_ADMIN_USER -password $WAS_ADMIN_PASSWORD

# Check deployment status
if [ $? -eq 0 ]; then
    echo "Deployment of $APP_NAME completed successfully."
else
    echo "Deployment failed. Check the output for errors."
    exit 1
fi
======================

#!/bin/bash

# Server details
WAS_HOST="10.15.11.209"
WAS_PORT="8879"
WAS_ADMIN_USER="deployer"
WAS_ADMIN_PASSWORD="deployer@123"

# WAR file and application details
WAR_FILE_PATH="/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war"
APP_NAME="KYC_Remediation"
CONTEXT_ROOT="KYC_Remediation"

# Combine shared libraries into a single string
SHARED_LIB="ibps_library,omnidocs_library,wfs_library,od_library"

# Path to wsadmin.sh
WSADMIN="/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/wsadmin.sh"

# wsadmin script content
WSADMIN_SCRIPT="
# Check if the application already exists
if '$APP_NAME' in AdminApp.list().splitlines():
    #print('Application $APP_NAME already exists. Skipping installation.')
    AdminApp.help()
else:
    # Install the application
    AdminApp.help()
    # AdminApp.install('$WAR_FILE_PATH', '-appname $APP_NAME -contextroot $CONTEXT_ROOT -MapWebModToVH [[ .* .* default_host ]]')
    # Map shared libraries
    # AdminConfig.create('LibraryRef', AdminConfig.getid('/Deployment:$APP_NAME/'), '[[libraryName $SHARED_LIB]]')
    # Save configuration changes
    # AdminConfig.save()
"

# Execute the script with wsadmin
echo "Deploying $APP_NAME from WAR file: $WAR_FILE_PATH"
echo "$WSADMIN_SCRIPT" | $WSADMIN -lang jython -conntype SOAP -host $WAS_HOST -port $WAS_PORT -user $WAS_ADMIN_USER -password $WAS_ADMIN_PASSWORD

# Check deployment status
if [ $? -eq 0 ]; then
    echo "Deployment of $APP_NAME completed successfully."
else
    echo "Deployment failed. Check the output for errors."
    exit 1
fi
=======================

TASK [IBPS-deployment : Run war-install-in-was.sh on Target Server] ************
task path: /ansible/GITHUB_RUNNER/actions-runner10/_work/ibps-was-ansible-cd/ibps-was-ansible-cd/roles/IBPS-deployment/tasks/main-war-installation.yml:27
<10.15.11.209> ESTABLISH SSH CONNECTION FOR USER: itdevtra
<10.15.11.209> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o Port=22 -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="itdevtra"' -o ConnectTimeout=30 -o ControlPath=/home/itdevtra/.ansible/cp/9d82de7b55 10.15.11.209 '/bin/sh -c '"'"'( umask 77 && mkdir -p "` echo /tmp `"&& mkdir /tmp/ansible-tmp-1713787810.955295-2120680-200127630301599 && echo ansible-tmp-1713787810.955295-2120680-200127630301599="` echo /tmp/ansible-tmp-1713787810.955295-2120680-200127630301599 `" ) && sleep 0'"'"''
<10.15.11.209> (0, b'ansible-tmp-1713787810.955295-2120680-200127630301599=/tmp/ansible-tmp-1713787810.955295-2120680-200127630301599\n', b'')
Using module file /usr/lib/python3.6/site-packages/ansible/modules/commands/command.py
<10.15.11.209> PUT /home/itdevtra/.ansible/tmp/ansible-local-212063554r94j79/tmp8vt8bszr TO /tmp/ansible-tmp-1713787810.955295-2120680-200127630301599/AnsiballZ_command.py
<10.15.11.209> SSH: EXEC sftp -b - -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o Port=22 -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="itdevtra"' -o ConnectTimeout=30 -o ControlPath=/home/itdevtra/.ansible/cp/9d82de7b55 '[10.15.11.209]'
<10.15.11.209> (0, b'sftp> put /home/itdevtra/.ansible/tmp/ansible-local-212063554r94j79/tmp8vt8bszr /tmp/ansible-tmp-1713787810.955295-2120680-200127630301599/AnsiballZ_command.py\n', b'')
<10.15.11.209> ESTABLISH SSH CONNECTION FOR USER: itdevtra
<10.15.11.209> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o Port=22 -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="itdevtra"' -o ConnectTimeout=30 -o ControlPath=/home/itdevtra/.ansible/cp/9d82de7b55 10.15.11.209 '/bin/sh -c '"'"'chmod u+x /tmp/ansible-tmp-1713787810.955295-2120680-200127630301599/ /tmp/ansible-tmp-1713787810.955295-2120680-200127630301599/AnsiballZ_command.py && sleep 0'"'"''
<10.15.11.209> (0, b'', b'')
<10.15.11.209> ESTABLISH SSH CONNECTION FOR USER: itdevtra
<10.15.11.209> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o Port=22 -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="itdevtra"' -o ConnectTimeout=30 -o ControlPath=/home/itdevtra/.ansible/cp/9d82de7b55 -tt 10.15.11.209 '/bin/sh -c '"'"'/usr/bin/python /tmp/ansible-tmp-1713787810.955295-2120680-200127630301599/AnsiballZ_command.py && sleep 0'"'"''
<10.15.11.209> (0, b'\r\n{"changed": true, "end": "2024-04-22 16:13:27.453129", "stdout": "Deploying KYC_Remediation from WAR file: /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war\\nWASX7209I: Connected to process \\"dmgr\\" on node antibpsapp1CellManager01 using SOAP connector;  The type of process is: DeploymentManager\\nWASX7031I: For help, enter: \\"print Help.help()\\"\\nwsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>\'WASX7095I: The AdminApp object allows application objects to be manipulated\\\\n\\\\t-- this includes installing, uninstalling, editing, and listing. Most\\\\n\\\\tof the commands supported by AdminApp operate in two modes: the default\\\\n\\\\tmode is one in which AdminApp communicates with the WebSphere server to\\\\n\\\\taccomplish its tasks.  A local mode is also possible, in which no\\\\n\\\\tserver communication takes place.  The local mode operation is invoked\\\\n\\\\tby bringing up the scripting client with no server connected using the\\\\n\\\\tcommand line \\"-conntype NONE\\" option tor setting the\\\\n\\\\t\\"com.ibm.ws.scripting.connectionType=NONE\\" property in the\\\\n\\\\twsadmin.properties.\\\\n\\\\n\\\\tThe following commands are supported by AdminApp; more detailed\\\\n\\\\tinformation about each of these commands is available by using the\\\\n\\\\t\\"help\\" command of AdminApp and supplying the name of the command\\\\n\\\\tas an argument.\\\\n\\\\ndeleteUserAndGroupEntries \\\\n\\\\t\\\\tDeletes all the user/group information for all the roles and\\\\n\\\\t\\\\tall the user name/password information for RunAs roles for a\\\\n\\\\t\\\\tgiven application\\\\nedit\\\\t\\\\tEdits the properties of an application\\\\neditInteractive\\\\tEdits the properties of an application interactively\\\\nexport\\\\t\\\\tExports application to a file\\\\nexportDDL\\\\tExports DDL from application to a directory\\\\nexportFile\\\\tExports content of a single file from an application to a file\\\\ngetDeployStatus\\\\tReturns the combined Deployment status of the application\\\\nhelp\\\\t\\\\tShows help information\\\\ninstall\\\\t\\\\tInstalls an application, given a file name and an option string\\\\ninstallInteractive\\\\n\\\\t\\\\tInstalls an application in interactive mode, given a file name\\\\n\\\\t\\\\tand an option string\\\\nisAppReady\\\\tChecks whether the application is ready to be run\\\\nlist\\\\t\\\\tLists all installed applications\\\\nlistModules\\\\tLists the modules in a specified application\\\\noptions\\\\t\\\\tShows the options available, for a given file, application,\\\\n\\\\t\\\\tor in general\\\\nrenameApplication\\\\tRename a given application\\\\npublishWSDL\\\\tPublishs WSDL files for a given application\\\\nsearchJNDIReferences\\\\n\\\\t\\\\tLists application that refers to the given JNDIName on a given\\\\n\\\\t\\\\tnode\\\\ntaskInfo\\\\tShows detailed information pertaining to a given install task\\\\n\\\\t\\\\tfor a given file\\\\nuninstall\\\\tUninstalls an application, given an application name and\\\\n\\\\t\\\\tan option string\\\\nupdate\\\\t\\\\tUpdates an installed application\\\\nupdateAccessIDs\\\\tUpdates the user/group binding information with accessID\\\\n\\\\t\\\\tfrom user registry for a given application\\\\nupdateInteractive\\\\tUpdates an installed application interactively\\\\nview\\\\t\\\\tViews an application or module, given an application or\\\\n\\\\t\\\\tmodule name\'\\nwsadmin>Deployment of KYC_Remediation completed successfully.", "cmd": "cd /ibm/IBM/Application/release/release.3.0.0.41 && ./war-install-in-was.sh", "rc": 0, "start": "2024-04-22 16:13:19.073718", "stderr": "", "delta": "0:00:08.379411", "invocation": {"module_args": {"creates": null, "executable": null, "_uses_shell": true, "strip_empty_ends": true, "_raw_params": "cd /ibm/IBM/Application/release/release.3.0.0.41 && ./war-install-in-was.sh", "removes": null, "argv": null, "warn": false, "chdir": null, "stdin_add_newline": true, "stdin": null}}}\r\n', b'Shared connection to 10.15.11.209 closed.\r\n')
<10.15.11.209> ESTABLISH SSH CONNECTION FOR USER: itdevtra
<10.15.11.209> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o Port=22 -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="itdevtra"' -o ConnectTimeout=30 -o ControlPath=/home/itdevtra/.ansible/cp/9d82de7b55 10.15.11.209 '/bin/sh -c '"'"'rm -f -r /tmp/ansible-tmp-1713787810.955295-2120680-200127630301599/ > /dev/null 2>&1 && sleep 0'"'"''
<10.15.11.209> (0, b'', b'')
changed: [ANTIBPSAPP1] => {
    "changed": true,
    "cmd": "cd /ibm/IBM/Application/release/release.3.0.0.41 && ./war-install-in-was.sh",
    "delta": "0:00:08.379411",
    "end": "2024-04-22 16:13:27.453129",
    "invocation": {
        "module_args": {
            "_raw_params": "cd /ibm/IBM/Application/release/release.3.0.0.41 && ./war-install-in-was.sh",
            "_uses_shell": true,
            "argv": null,
            "chdir": null,
            "creates": null,
            "executable": null,
            "removes": null,
            "stdin": null,
            "stdin_add_newline": true,
            "strip_empty_ends": true,
            "warn": false
        }
    },
    "rc": 0,
    "start": "2024-04-22 16:13:19.073718",
    "stderr": "",
    "stderr_lines": [],
    "stdout": "Deploying KYC_Remediation from WAR file: /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war\nWASX7209I: Connected to process \"dmgr\" on node antibpsapp1CellManager01 using SOAP connector;  The type of process is: DeploymentManager\nWASX7031I: For help, enter: \"print Help.help()\"\nwsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>'WASX7095I: The AdminApp object allows application objects to be manipulated\\n\\t-- this includes installing, uninstalling, editing, and listing. Most\\n\\tof the commands supported by AdminApp operate in two modes: the default\\n\\tmode is one in which AdminApp communicates with the WebSphere server to\\n\\taccomplish its tasks.  A local mode is also possible, in which no\\n\\tserver communication takes place.  The local mode operation is invoked\\n\\tby bringing up the scripting client with no server connected using the\\n\\tcommand line \"-conntype NONE\" option tor setting the\\n\\t\"com.ibm.ws.scripting.connectionType=NONE\" property in the\\n\\twsadmin.properties.\\n\\n\\tThe following commands are supported by AdminApp; more detailed\\n\\tinformation about each of these commands is available by using the\\n\\t\"help\" command of AdminApp and supplying the name of the command\\n\\tas an argument.\\n\\ndeleteUserAndGroupEntries \\n\\t\\tDeletes all the user/group information for all the roles and\\n\\t\\tall the user name/password information for RunAs roles for a\\n\\t\\tgiven application\\nedit\\t\\tEdits the properties of an application\\neditInteractive\\tEdits the properties of an application interactively\\nexport\\t\\tExports application to a file\\nexportDDL\\tExports DDL from application to a directory\\nexportFile\\tExports content of a single file from an application to a file\\ngetDeployStatus\\tReturns the combined Deployment status of the application\\nhelp\\t\\tShows help information\\ninstall\\t\\tInstalls an application, given a file name and an option string\\ninstallInteractive\\n\\t\\tInstalls an application in interactive mode, given a file name\\n\\t\\tand an option string\\nisAppReady\\tChecks whether the application is ready to be run\\nlist\\t\\tLists all installed applications\\nlistModules\\tLists the modules in a specified application\\noptions\\t\\tShows the options available, for a given file, application,\\n\\t\\tor in general\\nrenameApplication\\tRename a given application\\npublishWSDL\\tPublishs WSDL files for a given application\\nsearchJNDIReferences\\n\\t\\tLists application that refers to the given JNDIName on a given\\n\\t\\tnode\\ntaskInfo\\tShows detailed information pertaining to a given install task\\n\\t\\tfor a given file\\nuninstall\\tUninstalls an application, given an application name and\\n\\t\\tan option string\\nupdate\\t\\tUpdates an installed application\\nupdateAccessIDs\\tUpdates the user/group binding information with accessID\\n\\t\\tfrom user registry for a given application\\nupdateInteractive\\tUpdates an installed application interactively\\nview\\t\\tViews an application or module, given an application or\\n\\t\\tmodule name'\nwsadmin>Deployment of KYC_Remediation completed successfully.",
    "stdout_lines": [
        "Deploying KYC_Remediation from WAR file: /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war",
        "WASX7209I: Connected to process \"dmgr\" on node antibpsapp1CellManager01 using SOAP connector;  The type of process is: DeploymentManager",
        "WASX7031I: For help, enter: \"print Help.help()\"",
        "wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>'WASX7095I: The AdminApp object allows application objects to be manipulated\\n\\t-- this includes installing, uninstalling, editing, and listing. Most\\n\\tof the commands supported by AdminApp operate in two modes: the default\\n\\tmode is one in which AdminApp communicates with the WebSphere server to\\n\\taccomplish its tasks.  A local mode is also possible, in which no\\n\\tserver communication takes place.  The local mode operation is invoked\\n\\tby bringing up the scripting client with no server connected using the\\n\\tcommand line \"-conntype NONE\" option tor setting the\\n\\t\"com.ibm.ws.scripting.connectionType=NONE\" property in the\\n\\twsadmin.properties.\\n\\n\\tThe following commands are supported by AdminApp; more detailed\\n\\tinformation about each of these commands is available by using the\\n\\t\"help\" command of AdminApp and supplying the name of the command\\n\\tas an argument.\\n\\ndeleteUserAndGroupEntries \\n\\t\\tDeletes all the user/group information for all the roles and\\n\\t\\tall the user name/password information for RunAs roles for a\\n\\t\\tgiven application\\nedit\\t\\tEdits the properties of an application\\neditInteractive\\tEdits the properties of an application interactively\\nexport\\t\\tExports application to a file\\nexportDDL\\tExports DDL from application to a directory\\nexportFile\\tExports content of a single file from an application to a file\\ngetDeployStatus\\tReturns the combined Deployment status of the application\\nhelp\\t\\tShows help information\\ninstall\\t\\tInstalls an application, given a file name and an option string\\ninstallInteractive\\n\\t\\tInstalls an application in interactive mode, given a file name\\n\\t\\tand an option string\\nisAppReady\\tChecks whether the application is ready to be run\\nlist\\t\\tLists all installed applications\\nlistModules\\tLists the modules in a specified application\\noptions\\t\\tShows the options available, for a given file, application,\\n\\t\\tor in general\\nrenameApplication\\tRename a given application\\npublishWSDL\\tPublishs WSDL files for a given application\\nsearchJNDIReferences\\n\\t\\tLists application that refers to the given JNDIName on a given\\n\\t\\tnode\\ntaskInfo\\tShows detailed information pertaining to a given install task\\n\\t\\tfor a given file\\nuninstall\\tUninstalls an application, given an application name and\\n\\t\\tan option string\\nupdate\\t\\tUpdates an installed application\\nupdateAccessIDs\\tUpdates the user/group binding information with accessID\\n\\t\\tfrom user registry for a given application\\nupdateInteractive\\tUpdates an installed application interactively\\nview\\t\\tViews an application or module, given an application or\\n\\t\\tmodule name'",
        "wsadmin>Deployment of KYC_Remediation completed successfully."
    ]
}
======

Sreedevi.Unnikrishnana@rakbank.ae
Anisur.Shaikh@rakbank.ae
Muhammad.Waqas@rakbank.ae
===============

#!/bin/bash
 
# Server details

WAS_HOST="10.15.11.209"

WAS_PORT="9043"

WAS_ADMIN_USER="deployer"

WAS_ADMIN_PASSWORD="deployer@123"
 
# WAR file and application details

WAR_FILE_PATH="/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war"

APP_NAME="KYC_Remediation"

CONTEXT_ROOT="KYC_Remediation"
 
# Combine shared libraries into a single string

SHARED_LIB="ibps_library,omnidocs_library,wfs_library,od_library"
 
# Path to wsadmin.sh

WSADMIN="/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/wsadmin.sh"
 
# wsadmin script content

WSADMIN_SCRIPT="

# Check if the application already exists

if '$APP_NAME' in AdminApp.list().splitlines():

    print('Application $APP_NAME already exists. Updating...')

    # Update the application

    AdminApp.update('$APP_NAME', 'app', ['-operation', 'update', '-contents', '$WAR_FILE_PATH', '-contextroot', '$CONTEXT_ROOT'])

    # Map shared libraries

    AdminConfig.create('LibraryRef', AdminConfig.getid('/Deployment:$APP_NAME/'), '[[libraryName $SHARED_LIB]]')

    # Save configuration changes

    AdminConfig.save()

else:

    # Install the application

    AdminApp.install('$WAR_FILE_PATH', '-appname $APP_NAME -contextroot $CONTEXT_ROOT -MapWebModToVH [[ .* .* default_host ]]')

    # Map shared libraries

    AdminConfig.create('LibraryRef', AdminConfig.getid('/Deployment:$APP_NAME/'), '[[libraryName $SHARED_LIB]]')

    # Save configuration changes

    AdminConfig.save()

"
 
# Execute the script with wsadmin

echo "Deploying $APP_NAME from WAR file: $WAR_FILE_PATH"

echo "$WSADMIN_SCRIPT" | $WSADMIN -lang jython -conntype SOAP -host $WAS_HOST -port $WAS_PORT -user $WAS_ADMIN_USER -password $WAS_ADMIN_PASSWORD
 
# Check deployment status

if [ $? -eq 0 ]; then

    echo "Deployment of $APP_NAME completed successfully."

else

    echo "Deployment failed. Check the output for errors."

    exit 1

fi
===========

TASK [IBPS-deployment : Run war-install-in-was.sh on Target Server] ************
task path: /ansible/GITHUB_RUNNER/actions-runner10/_work/ibps-was-ansible-cd/ibps-was-ansible-cd/roles/IBPS-deployment/tasks/main-war-installation.yml:27
<10.15.11.209> ESTABLISH SSH CONNECTION FOR USER: itdevtra
<10.15.11.209> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o Port=22 -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="itdevtra"' -o ConnectTimeout=30 -o ControlPath=/home/itdevtra/.ansible/cp/9d82de7b55 10.15.11.209 '/bin/sh -c '"'"'( umask 77 && mkdir -p "` echo /tmp `"&& mkdir /tmp/ansible-tmp-1713857326.3317873-2550208-11619782997177 && echo ansible-tmp-1713857326.3317873-2550208-11619782997177="` echo /tmp/ansible-tmp-1713857326.3317873-2550208-11619782997177 `" ) && sleep 0'"'"''
<10.15.11.209> (0, b'ansible-tmp-1713857326.3317873-2550208-11619782997177=/tmp/ansible-tmp-1713857326.3317873-2550208-11619782997177\n', b'')
Using module file /usr/lib/python3.6/site-packages/ansible/modules/commands/command.py
<10.15.11.209> PUT /home/itdevtra/.ansible/tmp/ansible-local-25501572ik78c74/tmp9jtbdneb TO /tmp/ansible-tmp-1713857326.3317873-2550208-11619782997177/AnsiballZ_command.py
<10.15.11.209> SSH: EXEC sftp -b - -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o Port=22 -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="itdevtra"' -o ConnectTimeout=30 -o ControlPath=/home/itdevtra/.ansible/cp/9d82de7b55 '[10.15.11.209]'
<10.15.11.209> (0, b'sftp> put /home/itdevtra/.ansible/tmp/ansible-local-25501572ik78c74/tmp9jtbdneb /tmp/ansible-tmp-1713857326.3317873-2550208-11619782997177/AnsiballZ_command.py\n', b'')
<10.15.11.209> ESTABLISH SSH CONNECTION FOR USER: itdevtra
<10.15.11.209> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o Port=22 -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="itdevtra"' -o ConnectTimeout=30 -o ControlPath=/home/itdevtra/.ansible/cp/9d82de7b55 10.15.11.209 '/bin/sh -c '"'"'chmod u+x /tmp/ansible-tmp-1713857326.3317873-2550208-11619782997177/ /tmp/ansible-tmp-1713857326.3317873-2550208-11619782997177/AnsiballZ_command.py && sleep 0'"'"''
<10.15.11.209> (0, b'', b'')
<10.15.11.209> ESTABLISH SSH CONNECTION FOR USER: itdevtra
<10.15.11.209> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o Port=22 -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="itdevtra"' -o ConnectTimeout=30 -o ControlPath=/home/itdevtra/.ansible/cp/9d82de7b55 -tt 10.15.11.209 '/bin/sh -c '"'"'/usr/bin/python /tmp/ansible-tmp-1713857326.3317873-2550208-11619782997177/AnsiballZ_command.py && sleep 0'"'"''
<10.15.11.209> (1, b'\r\n{"changed": true, "end": "2024-04-23 11:32:03.794641", "stdout": "Deploying KYC_Remediation from WAR file: /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war\\nWASX7246E: Cannot establish \\"SOAP\\" connection to host \\"10.15.11.209\\" because of an authentication failure. Ensure that user and password are correct on the command line or in a properties file.\\nException message (if any): \\"Unable to authenticate user of the incoming SOAP request\\"\\nWASX7213I: This scripting client is not connected to a server process; please refer to the log file /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/logs/wsadmin.traceout for additional information.\\nWASX8011W: AdminTask object is not available.\\nWASX7031I: For help, enter: \\"print Help.help()\\"\\nwsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>WASX7015E: Exception running command: \\"\\"; exception information:\\ncom.ibm.ws
<10.15.11.209> Failed to connect to the host via ssh: Shared connection to 10.15.11.209 closed.
<10.15.11.209> ESTABLISH SSH CONNECTION FOR USER: itdevtra
<10.15.11.209> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o Port=22 -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="itdevtra"' -o ConnectTimeout=30 -o ControlPath=/home/itdevtra/.ansible/cp/9d82de7b55 10.15.11.209 '/bin/sh -c '"'"'rm -f -r /tmp/ansible-tmp-1713857326.3317873-2550208-11619782997177/ > /dev/null 2>&1 && sleep 0'"'"''
<10.15.11.209> (0, b'', b'')
fatal: [ANTIBPSAPP1]: FAILED! => {
    "changed": true,
    "cmd": "cd /ibm/IBM/Application/release/release.3.0.0.41 && ./war-install-in-was.sh",
    "delta": "0:00:08.087689",
    "end": "2024-04-23 11:32:03.794641",
    "invocation": {
        "module_args": {
            "_raw_params": "cd /ibm/IBM/Application/release/release.3.0.0.41 && ./war-install-in-was.sh",
            "_uses_shell": true,
            "argv": null,
            "chdir": null,
            "creates": null,
            "executable": null,
            "removes": null,
            "stdin": null,
            "stdin_add_newline": true,
            "strip_empty_ends": true,
            "warn": false
        }
    },
    "msg": "non-zero return code",
    "rc": 1,
    "start": "2024-04-23 11:31:55.706952",
    "stderr": "",
    "stderr_lines": [],
    "stdout": "Deploying KYC_Remediation from WAR file: /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war\nWASX7246E: Cannot establish \"SOAP\" connection to host \"10.15.11.209\" because of an authentication failure. Ensure that user and password are correct on the command line or in a properties file.\nException message (if any): \"Unable to authenticate user of the incoming SOAP request\"\nWASX7213I: This scripting client is not connected to a server process; please refer to the log file /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/logs/wsadmin.traceout for additional information.\nWASX8011W: AdminTask object is not available.\nWASX7031I: For help, enter: \"print Help.help()\"\nwsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>WASX7015E: Exception running command: \"\"; exception information:\ncom.ibm.ws.scripting.ScriptingException: WASX7206W: The application management service is not running. 
    "stdout_lines": [
        "Deploying KYC_Remediation from WAR file: /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war",
        "WASX7246E: Cannot establish \"SOAP\" connection to host \"10.15.11.209\" because of an authentication failure. Ensure that user and password are correct on the command line or in a properties file.",
        "Exception message (if any): \"Unable to authenticate user of the incoming SOAP request\"",
        "WASX7213I: This scripting client is not connected to a server process; please refer to the log file /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/logs/wsadmin.traceout for additional information.",
        "WASX8011W: AdminTask object is not available.",
        "WASX7031I: For help, enter: \"print Help.help()\"",
        "wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>WASX7015E: Exception running command: \"\"; exception information:",
        "com.ibm.ws.scripting.ScriptingException: WASX7206W: The application management service is not running. Application management commands will not run.",
        "",
        "wsadmin>Deployment failed. Check the output for errors."
    ]
}
...ignoring
=====================

#!/bin/bash

# Server details
WAS_HOST="10.15.11.209"
WAS_PORT="8879"
WAS_ADMIN_USER="itdevtra"
WAS_ADMIN_PASSWORD="itdevtra123"

# WAR file and application details
WAR_FILE_PATH="/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war"
APP_NAME="KYC_Remediation"
CONTEXT_ROOT="KYC_Remediation"

# Combine shared libraries into a single string
SHARED_LIB="ibps_library,omnidocs_library,wfs_library,od_library"

# Path to wsadmin.sh
WSADMIN="/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/wsadmin.sh"

# wsadmin script content
WSADMIN_SCRIPT="
# Check if the application already exists
if '$APP_NAME' in AdminApp.list().splitlines():
    #print('Application $APP_NAME already exists. Skipping installation.')
    AdminApp.help()
else:
    # Install the application
    AdminApp.help()
    # AdminApp.install('$WAR_FILE_PATH', '-appname $APP_NAME -contextroot $CONTEXT_ROOT -MapWebModToVH [[ .* .* default_host ]]')
    # Map shared libraries
    # AdminConfig.create('LibraryRef', AdminConfig.getid('/Deployment:$APP_NAME/'), '[[libraryName $SHARED_LIB]]')
    # Save configuration changes
    # AdminConfig.save()
"

# Execute the script with wsadmin
echo "Deploying $APP_NAME from WAR file: $WAR_FILE_PATH"
echo "$WSADMIN_SCRIPT" | $WSADMIN -lang jython -conntype SOAP -host $WAS_HOST -port $WAS_PORT -user $WAS_ADMIN_USER -password $WAS_ADMIN_PASSWORD

# Check deployment status
if [ $? -eq 0 ]; then
    echo "Deployment of $APP_NAME completed successfully."
else
    echo "Deployment failed. Check the output for errors."
    exit 1
fi
=====================

TASK [IBPS-deployment : Run war-install-in-was.sh on Target Server] ************
task path: /ansible/GITHUB_RUNNER/actions-runner10/_work/ibps-was-ansible-cd/ibps-was-ansible-cd/roles/IBPS-deployment/tasks/main-war-installation.yml:27
<10.15.11.209> ESTABLISH SSH CONNECTION FOR USER: itdevtra
<10.15.11.209> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o Port=22 -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="itdevtra"' -o ConnectTimeout=30 -o ControlPath=/home/itdevtra/.ansible/cp/9d82de7b55 10.15.11.209 '/bin/sh -c '"'"'( umask 77 && mkdir -p "` echo /tmp `"&& mkdir /tmp/ansible-tmp-1713860016.2175527-2567739-5376503727684 && echo ansible-tmp-1713860016.2175527-2567739-5376503727684="` echo /tmp/ansible-tmp-1713860016.2175527-2567739-5376503727684 `" ) && sleep 0'"'"''
<10.15.11.209> (0, b'ansible-tmp-1713860016.2175527-2567739-5376503727684=/tmp/ansible-tmp-1713860016.2175527-2567739-5376503727684\n', b'')
Using module file /usr/lib/python3.6/site-packages/ansible/modules/commands/command.py
<10.15.11.209> PUT /home/itdevtra/.ansible/tmp/ansible-local-2567694yhjza82r/tmprkxgy8fu TO /tmp/ansible-tmp-1713860016.2175527-2567739-5376503727684/AnsiballZ_command.py
<10.15.11.209> SSH: EXEC sftp -b - -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o Port=22 -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="itdevtra"' -o ConnectTimeout=30 -o ControlPath=/home/itdevtra/.ansible/cp/9d82de7b55 '[10.15.11.209]'
<10.15.11.209> (0, b'sftp> put /home/itdevtra/.ansible/tmp/ansible-local-2567694yhjza82r/tmprkxgy8fu /tmp/ansible-tmp-1713860016.2175527-2567739-5376503727684/AnsiballZ_command.py\n', b'')
<10.15.11.209> ESTABLISH SSH CONNECTION FOR USER: itdevtra
<10.15.11.209> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o Port=22 -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="itdevtra"' -o ConnectTimeout=30 -o ControlPath=/home/itdevtra/.ansible/cp/9d82de7b55 10.15.11.209 '/bin/sh -c '"'"'chmod u+x /tmp/ansible-tmp-1713860016.2175527-2567739-5376503727684/ /tmp/ansible-tmp-1713860016.2175527-2567739-5376503727684/AnsiballZ_command.py && sleep 0'"'"''
<10.15.11.209> (0, b'', b'')
<10.15.11.209> ESTABLISH SSH CONNECTION FOR USER: itdevtra
<10.15.11.209> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o Port=22 -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="itdevtra"' -o ConnectTimeout=30 -o ControlPath=/home/itdevtra/.ansible/cp/9d82de7b55 -tt 10.15.11.209 '/bin/sh -c '"'"'/usr/bin/python /tmp/ansible-tmp-1713860016.2175527-2567739-5376503727684/AnsiballZ_command.py && sleep 0'"'"''
<10.15.11.209> (1, b'\r\n{"changed": true, "end": "2024-04-23 12:16:58.290027", "stdout": "Deploying KYC_Remediation from WAR file: /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war\\nWASX7246E: Cannot establish \\"SOAP\\" connection to host \\"10.15.11.209\\" because of an authentication failure. Ensure that user and password are correct on the command line or in a properties file.\\nException message (if any): \\"Unable to authenticate user of the incoming SOAP request\\"\\nWASX7213I: This scripting client is not connected to a server process; please refer to the log file /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/logs/wsadmin.traceout for additional information.\\nWASX8011W: AdminTask object is not available.\\nWASX7031I: For help, enter: \\"print Help.help()\\"\\nwsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>WASX7015E: Exception running command: \\"\\"; exception information:\\ncom.ibm.ws.scripting.ScriptingException: WASX7206W: The application management service is not running. Application management commands will not run.\\n\\nwsadmin>Deployment failed. Check the output for errors.", "cmd": "cd /ibm/IBM/Application/release/release.3.0.0.41 && ./war-install-in-was.sh", "failed": true, "delta": "0:00:12.609001", "stderr": "", "rc": 1, "invocation": {"module_args": {"creates": null, "executable": null, "_uses_shell": true, "strip_empty_ends": true, "_raw_params": "cd /ibm/IBM/Application/release/release.3.0.0.41 && ./war-install-in-was.sh", "removes": null, "argv": null, "warn": false, "chdir": null, "stdin_add_newline": true, "stdin": null}}, "start": "2024-04-23 12:16:45.681026", "msg": "non-zero return code"}\r\n', b'Shared connection to 10.15.11.209 closed.\r\n')
<10.15.11.209> Failed to connect to the host via ssh: Shared connection to 10.15.11.209 closed.
<10.15.11.209> ESTABLISH SSH CONNECTION FOR USER: itdevtra
<10.15.11.209> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o Port=22 -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="itdevtra"' -o ConnectTimeout=30 -o ControlPath=/home/itdevtra/.ansible/cp/9d82de7b55 10.15.11.209 '/bin/sh -c '"'"'rm -f -r /tmp/ansible-tmp-1713860016.2175527-2567739-5376503727684/ > /dev/null 2>&1 && sleep 0'"'"''
<10.15.11.209> (0, b'', b'')
fatal: [ANTIBPSAPP1]: FAILED! => {
    "changed": true,
    "cmd": "cd /ibm/IBM/Application/release/release.3.0.0.41 && ./war-install-in-was.sh",
    "delta": "0:00:12.609001",
    "end": "2024-04-23 12:16:58.290027",
    "invocation": {
        "module_args": {
            "_raw_params": "cd /ibm/IBM/Application/release/release.3.0.0.41 && ./war-install-in-was.sh",
            "_uses_shell": true,
            "argv": null,
            "chdir": null,
            "creates": null,
            "executable": null,
            "removes": null,
            "stdin": null,
            "stdin_add_newline": true,
            "strip_empty_ends": true,
            "warn": false
        }
    },
    "msg": "non-zero return code",
    "rc": 1,
    "start": "2024-04-23 12:16:45.681026",
    "stderr": "",
    "stderr_lines": [],
    "stdout": "Deploying KYC_Remediation from WAR file: /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war\nWASX7246E: Cannot establish \"SOAP\" connection to host \"10.15.11.209\" because of an authentication failure. Ensure that user and password are correct on the command line or in a properties file.\nException message (if any): \"Unable to authenticate user of the incoming SOAP request\"\nWASX7213I: This scripting client is not connected to a server process; please refer to the log file /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/logs/wsadmin.traceout for additional information.\nWASX8011W: AdminTask object is not available.\nWASX7031I: For help, enter: \"print Help.help()\"\nwsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>WASX7015E: Exception running command: \"\"; exception information:\ncom.ibm.ws.scripting.ScriptingException: WASX7206W: The application management service is not running. Application management commands will not run.\n\nwsadmin>Deployment failed. Check the output for errors.",
    "stdout_lines": [
        "Deploying KYC_Remediation from WAR file: /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war",
        "WASX7246E: Cannot establish \"SOAP\" connection to host \"10.15.11.209\" because of an authentication failure. Ensure that user and password are correct on the command line or in a properties file.",
        "Exception message (if any): \"Unable to authenticate user of the incoming SOAP request\"",
        "WASX7213I: This scripting client is not connected to a server process; please refer to the log file /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/logs/wsadmin.traceout for additional information.",
        "WASX8011W: AdminTask object is not available.",
        "WASX7031I: For help, enter: \"print Help.help()\"",
        "wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>WASX7015E: Exception running command: \"\"; exception information:",
        "com.ibm.ws.scripting.ScriptingException: WASX7206W: The application management service is not running. Application management commands will not run.",
        "",
        "wsadmin>Deployment failed. Check the output for errors."
    ]
}
...ignoring
==========================

[2:54 PM] Pradip Kanasani
ask Anisure to run this command from the IBM WAS server manually 
[2:54 PM] Pradip Kanasani
./wsadmin.sh -lang jython -user admin_user -password admin_password

[2:54 PM] Pradip Kanasani
by proving those user name and password 
=================

[4/23/24 13:49:04:396 GST] 00000001 ManagerAdmin  I   TRAS0017I: The startup trace state is *=info.
[4/23/24 13:49:04:661 GST] 00000001 AbstractShell A   WASX7326I: Loaded properties file "/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/properties/wsadmin.properties"
[4/23/24 13:49:04:990 GST] 00000001 ProviderTrack I com.ibm.ffdc.osgi.ProviderTracker AddingService FFDC1007I: FFDC Provider Installed: com.ibm.ffdc.util.provider.FfdcOnDirProvider@b6a03636
[4/23/24 13:49:05:107 GST] 00000001 SSLConfigMana I   CWPKI0051I: The process has the java security property jdk.certpath.disabledAlgorithms set to [MD2, MD5, SHA1 jdkCA & usage TLSServer, RSA keySize < 1024, DSA keySize < 1024, EC keySize < 224, include jdk.disabled.namedCurves, SHA1 usage SignedJAR & denyAfter 2019-01-01].  The WebSphere Application server is setting the java security property jdk.certpath.disabledAlgorithms to [MD2, MD5, SHA1 jdkCA & usage TLSServer, RSA keySize < 1024, DSA keySize < 1024, EC keySize < 224]. 
[4/23/24 13:49:05:110 GST] 00000001 SSLConfigMana I   CWPKI0051I: The process has the java security property jdk.tls.disabledAlgorithms set to [SSLv3, TLSv1, TLSv1.1, RC4, DES, MD5withRSA, DH keySize < 1024, DESede, EC keySize < 224, 3DES_EDE_CBC, anon, NULL, DES_CBC, include jdk.disabled.namedCurves].  The WebSphere Application server is setting the java security property jdk.tls.disabledAlgorithms to [SSLv3, RC4, DES, MD5withRSA, DH keySize < 1024, DESede, EC keySize < 224, 3DES_EDE_CBC, anon, NULL, DES_CBC]. 
[4/23/24 13:49:05:112 GST] 00000001 SSLConfigMana I   CWPKI0027I: Disabling default hostname verification for HTTPS URL connections.
[4/23/24 13:49:05:116 GST] 00000001 SecurityObjec I   CWSCF0002I: The client code is attempting to load the security configuration the server and this operation is not allowed.
[4/23/24 13:49:10:886 GST] 00000001 AbstractShell A   WASX7092I: Command not logged; contains a password.
[4/23/24 13:49:10:889 GST] 00000001 AbstractShell E   WASX7120E: Diagnostic information from exception with text "javax.management.JMRuntimeException: Unable to authenticate user of the incoming SOAP request
" follows:

javax.management.JMRuntimeException: Unable to authenticate user of the incoming SOAP request
        at com.ibm.ws.management.connector.soap.SOAPConnectorClient.handleAdminFault(SOAPConnectorClient.java:968)
        at com.ibm.ws.management.connector.soap.SOAPConnectorClient.invokeTemplateOnce(SOAPConnectorClient.java:933)
        at com.ibm.ws.management.connector.soap.SOAPConnectorClient.invokeTemplate(SOAPConnectorClient.java:697)
        at com.ibm.ws.management.connector.soap.SOAPConnectorClient.invokeTemplate(SOAPConnectorClient.java:687)
        at com.ibm.ws.management.connector.soap.SOAPConnectorClient.getAttribute(SOAPConnectorClient.java:642)
        at com.ibm.ws.management.connector.soap.SOAPConnectorClient.invoke(SOAPConnectorClient.java:498)
        at com.sun.proxy.$Proxy3.getAttribute(Unknown Source)
        at com.ibm.ws.management.AdminClientImpl.getAttribute(AdminClientImpl.java:153)
        at com.ibm.ws.scripting.CommonScriptingObject.connectToAdminService(CommonScriptingObject.java:130)
        at com.ibm.ws.scripting.CommonScriptingObject.<init>(CommonScriptingObject.java:104)
        at com.ibm.ws.scripting.AdminControlClient.<init>(AdminControlClient.java:170)
        at com.ibm.ws.scripting.AbstractShell.createControlClient(AbstractShell.java:1290)
        at com.ibm.ws.scripting.AbstractShell.run(AbstractShell.java:2253)
        at com.ibm.ws.scripting.WasxShell.main(WasxShell.java:1172)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:90)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:55)
        at java.lang.reflect.Method.invoke(Method.java:508)
        at com.ibm.wsspi.bootstrap.WSLauncher.launchMain(WSLauncher.java:234)
        at com.ibm.wsspi.bootstrap.WSLauncher.main(WSLauncher.java:96)
        at com.ibm.wsspi.bootstrap.WSLauncher.run(WSLauncher.java:77)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:90)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:55)
        at java.lang.reflect.Method.invoke(Method.java:508)
        at org.eclipse.equinox.internal.app.EclipseAppContainer.callMethodWithException(EclipseAppContainer.java:587)
        at org.eclipse.equinox.internal.app.EclipseAppHandle.run(EclipseAppHandle.java:198)
        at org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication(EclipseAppLauncher.java:110)
        at org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start(EclipseAppLauncher.java:79)
        at org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:369)
        at org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:179)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:90)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:55)
        at java.lang.reflect.Method.invoke(Method.java:508)
        at org.eclipse.core.launcher.Main.invokeFramework(Main.java:340)
        at org.eclipse.core.launcher.Main.basicRun(Main.java:282)
        at org.eclipse.core.launcher.Main.run(Main.java:981)
        at com.ibm.wsspi.bootstrap.WSPreLauncher.launchEclipse(WSPreLauncher.java:425)
        at com.ibm.wsspi.bootstrap.WSPreLauncher.main(WSPreLauncher.java:178)

[4/23/24 13:49:10:889 GST] 00000001 AdminControlC W   WASX7072E: The control service is not available.
[4/23/24 13:49:10:902 GST] 00000001 AdminConfigCl W   WASX7198W: The configuration service is not running. Configuration commands will not run.
[4/23/24 13:49:10:912 GST] 00000001 AdminConfigCl A   WASX7208I: Validation settings in effect now: Level=HIGHEST, Cross-validation=true, Output file=/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/logs/wsadmin.valout
[4/23/24 13:49:10:927 GST] 00000001 AdminAppClien W   WASX7072E: The control service is not available.
[4/23/24 13:49:11:200 GST] 00000001 ModelMgr      I   WSVR0801I: Initializing all server configuration models
[4/23/24 13:49:11:895 GST] 00000001 WorkSpaceMana A   WKSP0500I: Workspace configuration consistency check is disabled.
[4/23/24 13:49:12:199 GST] 00000001 AdminAppClien W   WASX7206W: The application management service is not running. Application management commands will not run.
[4/23/24 13:49:12:200 GST] 00000001 AdminCmdClien W   WASX7198W: The configuration service is not running. Configuration commands will not run.
[4/23/24 13:49:12:200 GST] 00000001 AdminCmdClien W   WASX8011W: AdminTask object is not available.
[4/23/24 13:49:39:281 GST] 00000001 AbstractShell A   WASX7090I: Executing command: """"
[4/23/24 13:49:39:568 GST] 00000001 AbstractShell A   WASX7090I: Executing command: """"
[4/23/24 13:49:39:854 GST] 00000001 AbstractShell A   WASX7090I: Executing command: """"
[4/23/24 13:51:29:306 GST] 00000001 AbstractShell A   WASX7090I: Executing command: "cd /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/logs/"
[4/23/24 13:51:29:511 GST] 00000001 AbstractShell A   WASX7090I: Executing command: """"
[4/23/24 13:51:29:652 GST] 00000001 AbstractShell A   WASX7090I: Executing command: """"
[4/23/24 13:51:29:782 GST] 00000001 AbstractShell A   WASX7090I: Executing command: """"
[4/23/24 13:51:45:927 GST] 00000001 AbstractShell A   WASX7090I: Execuexit"command: "ls -la
[4/23/24 13:51:46:706 GST] 00000001 AbstractShell A   WASX7090I: Executing command: """"
[4/23/24 13:51:46:927 GST] 00000001 AbstractShell A   WASX7090I: Executing command: """"
[4/23/24 13:51:49:623 GST] 00000001 WasxShell     A   WASX7331I: Unexpected exception received when querying for changes in this session:       com.ibm.ws.scripting.ScriptingException: WASX7070E: The configuration service is not available.
========================

[Yesterday 5:20 PM] Shanmuganathan Murugesan
#!/bin/bash
 
# Server details

WAS_HOST="10.15.11.209"

WAS_PORT="9043"

WAS_ADMIN_USER="deployer"

WAS_ADMIN_PASSWORD="deployer@123"
 
# WAR file and application details

WAR_FILE_PATH="/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war"

APP_NAME="KYC_Remediation"

CONTEXT_ROOT="KYC_Remediation"
 
# Combine shared libraries into a single string

SHARED_LIB="ibps_library,omnidocs_library,wfs_library,od_library"
 
# Path to wsadmin.sh

WSADMIN="/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/wsadmin.sh"
 
# wsadmin script content

WSADMIN_SCRIPT="

# Check if the application already exists

if '$APP_NAME' in AdminApp.list().splitlines():

    print('Application $APP_NAME already exists. Updating...')

    # Update the application

    AdminApp.update('$APP_NAME', 'app', ['-operation', 'update', '-contents', '$WAR_FILE_PATH', '-contextroot', '$CONTEXT_ROOT'])

    # Map shared libraries

    AdminConfig.create('LibraryRef', AdminConfig.getid('/Deployment:$APP_NAME/'), '[[libraryName $SHARED_LIB]]')

    # Save configuration changes

    AdminConfig.save()

else:

    # Install the application

    AdminApp.install('$WAR_FILE_PATH', '-appname $APP_NAME -contextroot $CONTEXT_ROOT -MapWebModToVH [[ .* .* default_host ]]')
    AdminApp.install('$WAR_FILE_PATH', '-appname $APP_NAME -contextroot $CONTEXT_ROOT -MapWebModToVH [[ .* .* default_host ]] -MapModulesToServers [[ .* .* WebSphere:cell=antibpsapp1Cell01,node=antibpsapp1Node01,server=server1 ]]') 
    # Map shared libraries

    AdminConfig.create('LibraryRef', AdminConfig.getid('/Deployment:$APP_NAME/'), '[[libraryName $SHARED_LIB]]')

    # Save configuration changes

    AdminConfig.save()

"
 
# Execute the script with wsadmin

echo "Deploying $APP_NAME from WAR file: $WAR_FILE_PATH"

echo "$WSADMIN_SCRIPT" | $WSADMIN -lang jython -conntype SOAP -host $WAS_HOST -port $WAS_PORT -user $WAS_ADMIN_USER -password $WAS_ADMIN_PASSWORD
 
# Check deployment status

if [ $? -eq 0 ]; then

    echo "Deployment of $APP_NAME completed successfully."

else

    echo "Deployment failed. Check the output for errors."

    exit 1

fi
=============

#!/bin/bash

# Server details
WAS_HOST="10.15.11.209"
WAS_PORT="9043"
WAS_ADMIN_USER="deployer"
WAS_ADMIN_PASSWORD="deployer@123"

# WAR file and application details
WAR_FILE_PATH="/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war"
APP_NAME="KYC_Remediation"
CONTEXT_ROOT="KYC_Remediation"

# Combine shared libraries into a single string
SHARED_LIB="ibps_library,omnidocs_library,wfs_library,od_library"

# Path to wsadmin.sh
WSADMIN="/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/wsadmin.sh"

# wsadmin script content
WSADMIN_SCRIPT="
# Check if the application already exists
if '$APP_NAME' in AdminApp.list().splitlines():
    echo 'Application $APP_NAME already exists. Updating...'

    # Update the application
    AdminApp.update('$APP_NAME', 'app', ['-operation', 'update', '-contents', '$WAR_FILE_PATH', '-contextroot', '$CONTEXT_ROOT', '-MapWebModToVH', '[[ .* .* default_host ]]', '-MapModulesToServers', '[[ .* .* WebSphere:cell=antibpsapp1Cell01,node=antibpsapp1Node01,server=server1 ]]'])

    # Map shared libraries
    AdminConfig.create('LibraryRef', AdminConfig.getid('/Deployment:$APP_NAME/'), '[[libraryName $SHARED_LIB]]')

    # Save configuration changes
    AdminConfig.save()
else:
    echo 'Deploying $APP_NAME from WAR file: $WAR_FILE_PATH'
    # Install the application
    AdminApp.install('$WAR_FILE_PATH', '-appname $APP_NAME -contextroot $CONTEXT_ROOT -MapWebModToVH [[ .* .* default_host ]] -MapModulesToServers [[ .* .* WebSphere:cell=antibpsapp1Cell01,node=antibpsapp1Node01,server=server1 ]]')

    # Map shared libraries
    AdminConfig.create('LibraryRef', AdminConfig.getid('/Deployment:$APP_NAME/'), '[[libraryName $SHARED_LIB]]')

    # Save configuration changes
    AdminConfig.save()
fi
"

# Execute the script with wsadmin
echo "$WSADMIN_SCRIPT" | $WSADMIN -lang jython -conntype SOAP -host $WAS_HOST -port $WAS_PORT -user $WAS_ADMIN_USER -password $WAS_ADMIN_PASSWORD

# Check deployment status
if [ $? -eq 0 ]; then
    echo "Deployment of $APP_NAME completed successfully."
else
    echo "Deployment failed. Check the output for errors."
    exit 1
fi
=============

TASK [IBPS-deployment : Run war-install-in-was.sh on Target Server] ************
task path: /ansible/GITHUB_RUNNER/actions-runner10/_work/ibps-was-ansible-cd/ibps-was-ansible-cd/roles/IBPS-deployment/tasks/main-war-installation.yml:27
<10.15.11.209> ESTABLISH SSH CONNECTION FOR USER: itdevtra
<10.15.11.209> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o Port=22 -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="itdevtra"' -o ConnectTimeout=30 -o ControlPath=/home/itdevtra/.ansible/cp/9d82de7b55 10.15.11.209 '/bin/sh -c '"'"'( umask 77 && mkdir -p "` echo /tmp `"&& mkdir /tmp/ansible-tmp-1713884139.1796818-2722607-250256108452136 && echo ansible-tmp-1713884139.1796818-2722607-250256108452136="` echo /tmp/ansible-tmp-1713884139.1796818-2722607-250256108452136 `" ) && sleep 0'"'"''
<10.15.11.209> (0, b'ansible-tmp-1713884139.1796818-2722607-250256108452136=/tmp/ansible-tmp-1713884139.1796818-2722607-250256108452136\n', b'')
Using module file /usr/lib/python3.6/site-packages/ansible/modules/commands/command.py
<10.15.11.209> PUT /home/itdevtra/.ansible/tmp/ansible-local-2722516dxxkjr8y/tmpsb1urfc0 TO /tmp/ansible-tmp-1713884139.1796818-2722607-250256108452136/AnsiballZ_command.py
<10.15.11.209> SSH: EXEC sftp -b - -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o Port=22 -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="itdevtra"' -o ConnectTimeout=30 -o ControlPath=/home/itdevtra/.ansible/cp/9d82de7b55 '[10.15.11.209]'
<10.15.11.209> (0, b'sftp> put /home/itdevtra/.ansible/tmp/ansible-local-2722516dxxkjr8y/tmpsb1urfc0 /tmp/ansible-tmp-1713884139.1796818-2722607-250256108452136/AnsiballZ_command.py\n', b'')
<10.15.11.209> ESTABLISH SSH CONNECTION FOR USER: itdevtra
<10.15.11.209> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o Port=22 -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="itdevtra"' -o ConnectTimeout=30 -o ControlPath=/home/itdevtra/.ansible/cp/9d82de7b55 10.15.11.209 '/bin/sh -c '"'"'chmod u+x /tmp/ansible-tmp-1713884139.1796818-2722607-250256108452136/ /tmp/ansible-tmp-1713884139.1796818-2722607-250256108452136/AnsiballZ_command.py && sleep 0'"'"''
<10.15.11.209> (0, b'', b'')
<10.15.11.209> ESTABLISH SSH CONNECTION FOR USER: itdevtra
<10.15.11.209> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o Port=22 -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="itdevtra"' -o ConnectTimeout=30 -o ControlPath=/home/itdevtra/.ansible/cp/9d82de7b55 -tt 10.15.11.209 '/bin/sh -c '"'"'/usr/bin/python /tmp/ansible-tmp-1713884139.1796818-2722607-250256108452136/AnsiballZ_command.py && sleep 0'"'"''
<10.15.11.209> (1, b'\r\n{"changed": true, "end": "2024-04-23 18:59:12.888743", "stdout": "WASX7209I: Connected to process \\"dmgr\\" on node antibpsapp1CellManager01 using SOAP connector;  The type of process is: DeploymentManager\\nWASX7031I: For help, enter: \\"print Help.help()\\"\\nwsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>WASX7015E: Exception running command: \\"    AdminApp.update(\'KYC_Remediation\', \'app\', [\'-operation\', \'update\', \'-contents\', \'/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war\', \'-contextroot\', \'KYC_Remediation\', \'-MapWebModToVH\', \'[[ .* .* default_host ]]\', \'-MapModulesToServers\', \'[[ .* .* WebSphere:cell=antibpsapp1Cell01,node=antibpsapp1Node01,server=server1 ]]\'])\\"; exception information:\\ncom.ibm.ws.scripting.ScriptingException: WASX7280E: An application with name \\"KYC_Remediation\\" does not exist.\\n\\nwsadmin>wsadmin>wsadmin>WASX7015E: Exception running command: \\"    AdminConfig.create(\'LibraryRef\', AdminConfig.getid(\'/Deployment:KYC_Remediation/\'), \'[[libraryName ibps_library,omnidocs_library,wfs_library,od_library]]\')\\"; exception information:\\ncom.ibm.ws.scripting.ScriptingException: WASX7444E: Invalid parameter value \\"\\" for parameter \\"parent config id\\" on command \\"create\\"\\n\\nwsadmin>wsadmin>wsadmin>\'\'\\nwsadmin>wsadmin>wsadmin>wsadmin>WASX7327I: Contents of was.policy file:\\n //\\n// Template policy file for enterprise application.\\n// Extra permissions can be added if required by the enterprise application.\\n//\\n// NOTE: Syntax errors in the policy files will cause the enterprise application FAIL to start.\\n//       Extreme care should be taken when editing these policy files. It is advised to use\\n//       the policytool provided by the JDK for editing the policy files\\n//       (WAS_HOME/java/jre/bin/policytool). \\n//\\n\\ngrant codeBase \\"file:${application}\\" {\\n};\\n\\ngrant codeBase \\"file:${jars}\\" {\\n};\\n\\ngrant codeBase \\"file:${connectorComponent}\\" {\\n};\\n\\ngrant codeBase \\"file:${webComponent}\\" {\\n};\\n\\ngrant codeBase \\"file:${ejbComponent}\\" {\\n};\\n\\n\\nADMA5016I: Installation of KYC_Remediation started.\\nADMA5026E: No valid target is specified in ObjectName WebSphere:cell=antibpsapp1Cell01,node=antibpsapp1Node01,server=server1 for module KYC_Remediation.war+WEB-INF/web.xml.\\nADMA5011I: The cleanup of the temp directory for application KYC_Remediation is complete.\\nADMA5014E: The installation of application KYC_Remediation failed.\\nWASX7015E: Exception running command: \\"    AdminApp.install(\'/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war\', \'-appname KYC_Remediation -contextroot KYC_Remediation -MapWebModToVH [[ .* .* default_host ]] -MapModulesToServers [[ .* .* WebSphere:cell=antibpsapp1Cell01,node=antibpsapp1Node01,server=server1 ]]\')\\"; exception information:\\ncom.ibm.ws.scripting.ScriptingException: WASX7132E: Application install for /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war failed: see previous messages for details.\\n\\nwsadmin>wsadmin>wsadmin>WASX7015E: Exception running command: \\"    AdminConfig.create(\'LibraryRef\', AdminConfig.getid(\'/Deployment:KYC_Remediation/\'), \'[[libraryName ibps_library,omnidocs_library,wfs_library,od_library]]\')\\"; exception information:\\ncom.ibm.ws.scripting.ScriptingException: WASX7444E: Invalid parameter value \\"\\" for parameter \\"parent config id\\" on command \\"create\\"\\n\\nwsadmin>wsadmin>wsadmin>\'\'\\nwsadmin>WASX7015E: Exception running command: \\"fi\\"; exception information:\\ncom.ibm.bsf.BSFException: exception from Jython:\\nTraceback (innermost last):\\n  File \\"<input>\\", line 1, in ?\\nNameError: fi\\n\\nwsadmin>wsadmin>Deployment failed. Check the output for errors.", "cmd": "cd /ibm/IBM/Application/release/release.3.0.0.41 && ./war-install-in-was.sh", "failed": true, "delta": "0:00:23.877537", "stderr": "Traceback (innermost last):\\n  (no code object) at line 0\\n  File \\"<input>\\", line 2\\n\\t    echo \'Application KYC_Remediation already exists. Updating...\'\\n\\t         ^\\nSyntaxError: invalid syntax\\nTraceback (innermost last):\\n  (no code object) at line 0\\n  File \\"<input>\\", line 1\\n\\telse:\\n\\t^\\nSyntaxError: invalid syntax\\nTraceback (innermost last):\\n  (no code object) at line 0\\n  File \\"<input>\\", line 1\\n\\t    echo \'Deploying KYC_Remediation from WAR file: /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war\'\\n\\t         ^\\nSyntaxError: invalid syntax", "rc": 1, "invocation": {"module_args": {"creates": null, "executable": null, "_uses_shell": true, "strip_empty_ends": true, "_raw_params": "cd /ibm/IBM/Application/release/release.3.0.0.41 && ./war-install-in-was.sh", "removes": null, "argv": null, "warn": false, "chdir": null, "stdin_add_newline": true, "stdin": null}}, "start": "2024-04-23 18:58:49.011206", "msg": "non-zero return code"}\r\n', b'Shared connection to 10.15.11.209 closed.\r\n')
<10.15.11.209> Failed to connect to the host via ssh: Shared connection to 10.15.11.209 closed.
<10.15.11.209> ESTABLISH SSH CONNECTION FOR USER: itdevtra
<10.15.11.209> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o Port=22 -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="itdevtra"' -o ConnectTimeout=30 -o ControlPath=/home/itdevtra/.ansible/cp/9d82de7b55 10.15.11.209 '/bin/sh -c '"'"'rm -f -r /tmp/ansible-tmp-1713884139.1796818-2722607-250256108452136/ > /dev/null 2>&1 && sleep 0'"'"''
<10.15.11.209> (0, b'', b'')
fatal: [ANTIBPSAPP1]: FAILED! => {
    "changed": true,
    "cmd": "cd /ibm/IBM/Application/release/release.3.0.0.41 && ./war-install-in-was.sh",
    "delta": "0:00:23.877537",
    "end": "2024-04-23 18:59:12.888743",
    "invocation": {
        "module_args": {
            "_raw_params": "cd /ibm/IBM/Application/release/release.3.0.0.41 && ./war-install-in-was.sh",
            "_uses_shell": true,
            "argv": null,
            "chdir": null,
            "creates": null,
            "executable": null,
            "removes": null,
            "stdin": null,
            "stdin_add_newline": true,
            "strip_empty_ends": true,
            "warn": false
        }
    },
    "msg": "non-zero return code",
    "rc": 1,
    "start": "2024-04-23 18:58:49.011206",
    "stderr": "Traceback (innermost last):\n  (no code object) at line 0\n  File \"<input>\", line 2\n\t    echo 'Application KYC_Remediation already exists. Updating...'\n\t         ^\nSyntaxError: invalid syntax\nTraceback (innermost last):\n  (no code object) at line 0\n  File \"<input>\", line 1\n\telse:\n\t^\nSyntaxError: invalid syntax\nTraceback (innermost last):\n  (no code object) at line 0\n  File \"<input>\", line 1\n\t    echo 'Deploying KYC_Remediation from WAR file: /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war'\n\t         ^\nSyntaxError: invalid syntax",
    "stderr_lines": [
        "Traceback (innermost last):",
        "  (no code object) at line 0",
        "  File \"<input>\", line 2",
        "\t    echo 'Application KYC_Remediation already exists. Updating...'",
        "\t         ^",
        "SyntaxError: invalid syntax",
        "Traceback (innermost last):",
        "  (no code object) at line 0",
        "  File \"<input>\", line 1",
        "\telse:",
        "\t^",
        "SyntaxError: invalid syntax",
        "Traceback (innermost last):",
        "  (no code object) at line 0",
        "  File \"<input>\", line 1",
        "\t    echo 'Deploying KYC_Remediation from WAR file: /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war'",
        "\t         ^",
        "SyntaxError: invalid syntax"
    ],
    "stdout": "WASX7209I: Connected to process \"dmgr\" on node antibpsapp1CellManager01 using SOAP connector;  The type of process is: DeploymentManager\nWASX7031I: For help, enter: \"print Help.help()\"\nwsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>WASX7015E: Exception running command: \"    AdminApp.update('KYC_Remediation', 'app', ['-operation', 'update', '-contents', '/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war', '-contextroot', 'KYC_Remediation', '-MapWebModToVH', '[[ .* .* default_host ]]', '-MapModulesToServers', '[[ .* .* WebSphere:cell=antibpsapp1Cell01,node=antibpsapp1Node01,server=server1 ]]'])\"; exception information:\ncom.ibm.ws.scripting.ScriptingException: WASX7280E: An application with name \"KYC_Remediation\" does not exist.\n\nwsadmin>wsadmin>wsadmin>WASX7015E: Exception running command: \"    AdminConfig.create('LibraryRef', AdminConfig.getid('/Deployment:KYC_Remediation/'), '[[libraryName ibps_library,omnidocs_library,wfs_library,od_library]]')\"; exception information:\ncom.ibm.ws.scripting.ScriptingException: WASX7444E: Invalid parameter value \"\" for parameter \"parent config id\" on command \"create\"\n\nwsadmin>wsadmin>wsadmin>''\nwsadmin>wsadmin>wsadmin>wsadmin>WASX7327I: Contents of was.policy file:\n //\n// Template policy file for enterprise application.\n// Extra permissions can be added if required by the enterprise application.\n//\n// NOTE: Syntax errors in the policy files will cause the enterprise application FAIL to start.\n//       Extreme care should be taken when editing these policy files. It is advised to use\n//       the policytool provided by the JDK for editing the policy files\n//       (WAS_HOME/java/jre/bin/policytool). \n//\n\ngrant codeBase \"file:${application}\" {\n};\n\ngrant codeBase \"file:${jars}\" {\n};\n\ngrant codeBase \"file:${connectorComponent}\" {\n};\n\ngrant codeBase \"file:${webComponent}\" {\n};\n\ngrant codeBase \"file:${ejbComponent}\" {\n};\n\n\nADMA5016I: Installation of KYC_Remediation started.\nADMA5026E: No valid target is specified in ObjectName WebSphere:cell=antibpsapp1Cell01,node=antibpsapp1Node01,server=server1 for module KYC_Remediation.war+WEB-INF/web.xml.\nADMA5011I: The cleanup of the temp directory for application KYC_Remediation is complete.\nADMA5014E: The installation of application KYC_Remediation failed.\nWASX7015E: Exception running command: \"    AdminApp.install('/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war', '-appname KYC_Remediation -contextroot KYC_Remediation -MapWebModToVH [[ .* .* default_host ]] -MapModulesToServers [[ .* .* WebSphere:cell=antibpsapp1Cell01,node=antibpsapp1Node01,server=server1 ]]')\"; exception information:\ncom.ibm.ws.scripting.ScriptingException: WASX7132E: Application install for /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war failed: see previous messages for details.\n\nwsadmin>wsadmin>wsadmin>WASX7015E: Exception running command: \"    AdminConfig.create('LibraryRef', AdminConfig.getid('/Deployment:KYC_Remediation/'), '[[libraryName ibps_library,omnidocs_library,wfs_library,od_library]]')\"; exception information:\ncom.ibm.ws.scripting.ScriptingException: WASX7444E: Invalid parameter value \"\" for parameter \"parent config id\" on command \"create\"\n\nwsadmin>wsadmin>wsadmin>''\nwsadmin>WASX7015E: Exception running command: \"fi\"; exception information:\ncom.ibm.bsf.BSFException: exception from Jython:\nTraceback (innermost last):\n  File \"<input>\", line 1, in ?\nNameError: fi\n\nwsadmin>wsadmin>Deployment failed. Check the output for errors.",
    "stdout_lines": [
        "WASX7209I: Connected to process \"dmgr\" on node antibpsapp1CellManager01 using SOAP connector;  The type of process is: DeploymentManager",
        "WASX7031I: For help, enter: \"print Help.help()\"",
        "wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>WASX7015E: Exception running command: \"    AdminApp.update('KYC_Remediation', 'app', ['-operation', 'update', '-contents', '/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war', '-contextroot', 'KYC_Remediation', '-MapWebModToVH', '[[ .* .* default_host ]]', '-MapModulesToServers', '[[ .* .* WebSphere:cell=antibpsapp1Cell01,node=antibpsapp1Node01,server=server1 ]]'])\"; exception information:",
        "com.ibm.ws.scripting.ScriptingException: WASX7280E: An application with name \"KYC_Remediation\" does not exist.",
        "",
        "wsadmin>wsadmin>wsadmin>WASX7015E: Exception running command: \"    AdminConfig.create('LibraryRef', AdminConfig.getid('/Deployment:KYC_Remediation/'), '[[libraryName ibps_library,omnidocs_library,wfs_library,od_library]]')\"; exception information:",
        "com.ibm.ws.scripting.ScriptingException: WASX7444E: Invalid parameter value \"\" for parameter \"parent config id\" on command \"create\"",
        "",
        "wsadmin>wsadmin>wsadmin>''",
        "wsadmin>wsadmin>wsadmin>wsadmin>WASX7327I: Contents of was.policy file:",
        " //",
        "// Template policy file for enterprise application.",
        "// Extra permissions can be added if required by the enterprise application.",
        "//",
        "// NOTE: Syntax errors in the policy files will cause the enterprise application FAIL to start.",
        "//       Extreme care should be taken when editing these policy files. It is advised to use",
        "//       the policytool provided by the JDK for editing the policy files",
        "//       (WAS_HOME/java/jre/bin/policytool). ",
        "//",
        "",
        "grant codeBase \"file:${application}\" {",
        "};",
        "",
        "grant codeBase \"file:${jars}\" {",
        "};",
        "",
        "grant codeBase \"file:${connectorComponent}\" {",
        "};",
        "",
        "grant codeBase \"file:${webComponent}\" {",
        "};",
        "",
        "grant codeBase \"file:${ejbComponent}\" {",
        "};",
        "",
        "",
        "ADMA5016I: Installation of KYC_Remediation started.",
        "ADMA5026E: No valid target is specified in ObjectName WebSphere:cell=antibpsapp1Cell01,node=antibpsapp1Node01,server=server1 for module KYC_Remediation.war+WEB-INF/web.xml.",
        "ADMA5011I: The cleanup of the temp directory for application KYC_Remediation is complete.",
        "ADMA5014E: The installation of application KYC_Remediation failed.",
        "WASX7015E: Exception running command: \"    AdminApp.install('/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war', '-appname KYC_Remediation -contextroot KYC_Remediation -MapWebModToVH [[ .* .* default_host ]] -MapModulesToServers [[ .* .* WebSphere:cell=antibpsapp1Cell01,node=antibpsapp1Node01,server=server1 ]]')\"; exception information:",
        "com.ibm.ws.scripting.ScriptingException: WASX7132E: Application install for /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war failed: see previous messages for details.",
        "",
        "wsadmin>wsadmin>wsadmin>WASX7015E: Exception running command: \"    AdminConfig.create('LibraryRef', AdminConfig.getid('/Deployment:KYC_Remediation/'), '[[libraryName ibps_library,omnidocs_library,wfs_library,od_library]]')\"; exception information:",
        "com.ibm.ws.scripting.ScriptingException: WASX7444E: Invalid parameter value \"\" for parameter \"parent config id\" on command \"create\"",
        "",
        "wsadmin>wsadmin>wsadmin>''",
        "wsadmin>WASX7015E: Exception running command: \"fi\"; exception information:",
        "com.ibm.bsf.BSFException: exception from Jython:",
        "Traceback (innermost last):",
        "  File \"<input>\", line 1, in ?",
        "NameError: fi",
        "",
        "wsadmin>wsadmin>Deployment failed. Check the output for errors."
    ]
}
...ignoring
========================

#!/bin/bash

# Server details
WAS_HOST="10.15.11.209"
WAS_PORT="8879"
WAS_ADMIN_USER="deployer"
WAS_ADMIN_PASSWORD="deployer@123"

# WAR file and application details
WAR_FILE_PATH="/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war"
APP_NAME="KYC_Remediation"
CONTEXT_ROOT="KYC_Remediation"

# Combine shared libraries into a single string
SHARED_LIB="ibps_library,omnidocs_library,wfs_library,od_library"

# Path to wsadmin.sh
WSADMIN="/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/wsadmin.sh"

# wsadmin script content
WSADMIN_SCRIPT="
# Check if the application already exists
if '$APP_NAME' in AdminApp.list().splitlines():
    print 'Application $APP_NAME already exists. Updating...'

    # Update the application
    AdminApp.update('$APP_NAME', 'app', ['-operation', 'update', '-contents', '$WAR_FILE_PATH', '-contextroot', '$CONTEXT_ROOT', '-MapWebModToVH', '[[ .* .* default_host ]]', '-MapModulesToServers', '[[ .* .* WebSphere:cell=antibpsapp1Cell01,node=antibpsapp1Node01,server=server1 ]]'])

    # Map shared libraries
    AdminConfig.create('LibraryRef', AdminConfig.getid('/Deployment:$APP_NAME/'), '[[libraryName $SHARED_LIB]]')

    # Save configuration changes
    AdminConfig.save()
else:
    print 'Deploying $APP_NAME from WAR file: $WAR_FILE_PATH'
    # Install the application
    AdminApp.install('$WAR_FILE_PATH', '-appname $APP_NAME -contextroot $CONTEXT_ROOT -MapWebModToVH [[ .* .* default_host ]] -MapModulesToServers [[ .* .* WebSphere:cell=antibpsapp1Cell01,node=antibpsapp1Node01,server=server1 ]]')

    # Map shared libraries
    AdminConfig.create('LibraryRef', AdminConfig.getid('/Deployment:$APP_NAME/'), '[[libraryName $SHARED_LIB]]')

    # Save configuration changes
    AdminConfig.save()
fi
"

# Execute the script with wsadmin
echo "$WSADMIN_SCRIPT" | $WSADMIN -lang jython -conntype SOAP -host $WAS_HOST -port $WAS_PORT -user $WAS_ADMIN_USER -password $WAS_ADMIN_PASSWORD

# Check deployment status
if [ $? -eq 0 ]; then
    echo "Deployment of $APP_NAME completed successfully."
else
    echo "Deployment failed. Check the output for errors."
    exit 1
fi
===========================
TASK [IBPS-deployment : Run war-install-in-was.sh on Target Server] ************
task path: /ansible/GITHUB_RUNNER/actions-runner10/_work/ibps-was-ansible-cd/ibps-was-ansible-cd/roles/IBPS-deployment/tasks/main-war-installation.yml:27
<10.15.11.209> ESTABLISH SSH CONNECTION FOR USER: itdevtra
<10.15.11.209> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o Port=22 -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="itdevtra"' -o ConnectTimeout=30 -o ControlPath=/home/itdevtra/.ansible/cp/9d82de7b55 10.15.11.209 '/bin/sh -c '"'"'( umask 77 && mkdir -p "` echo /tmp `"&& mkdir /tmp/ansible-tmp-1713885889.8364644-2734025-154317193159194 && echo ansible-tmp-1713885889.8364644-2734025-154317193159194="` echo /tmp/ansible-tmp-1713885889.8364644-2734025-154317193159194 `" ) && sleep 0'"'"''
<10.15.11.209> (0, b'ansible-tmp-1713885889.8364644-2734025-154317193159194=/tmp/ansible-tmp-1713885889.8364644-2734025-154317193159194\n', b'')
Using module file /usr/lib/python3.6/site-packages/ansible/modules/commands/command.py
<10.15.11.209> PUT /home/itdevtra/.ansible/tmp/ansible-local-2733982oeh9sj4s/tmpcxa56khq TO /tmp/ansible-tmp-1713885889.8364644-2734025-154317193159194/AnsiballZ_command.py
<10.15.11.209> SSH: EXEC sftp -b - -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o Port=22 -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="itdevtra"' -o ConnectTimeout=30 -o ControlPath=/home/itdevtra/.ansible/cp/9d82de7b55 '[10.15.11.209]'
<10.15.11.209> (0, b'sftp> put /home/itdevtra/.ansible/tmp/ansible-local-2733982oeh9sj4s/tmpcxa56khq /tmp/ansible-tmp-1713885889.8364644-2734025-154317193159194/AnsiballZ_command.py\n', b'')
<10.15.11.209> ESTABLISH SSH CONNECTION FOR USER: itdevtra
<10.15.11.209> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o Port=22 -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="itdevtra"' -o ConnectTimeout=30 -o ControlPath=/home/itdevtra/.ansible/cp/9d82de7b55 10.15.11.209 '/bin/sh -c '"'"'chmod u+x /tmp/ansible-tmp-1713885889.8364644-2734025-154317193159194/ /tmp/ansible-tmp-1713885889.8364644-2734025-154317193159194/AnsiballZ_command.py && sleep 0'"'"''
<10.15.11.209> (0, b'', b'')
<10.15.11.209> ESTABLISH SSH CONNECTION FOR USER: itdevtra
<10.15.11.209> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o Port=22 -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="itdevtra"' -o ConnectTimeout=30 -o ControlPath=/home/itdevtra/.ansible/cp/9d82de7b55 -tt 10.15.11.209 '/bin/sh -c '"'"'/usr/bin/python /tmp/ansible-tmp-1713885889.8364644-2734025-154317193159194/AnsiballZ_command.py && sleep 0'"'"''
<10.15.11.209> (1, b'\r\n{"changed": true, "end": "2024-04-23 19:28:23.759885", "stdout": "WASX7209I: Connected to process \\"dmgr\\" on node antibpsapp1CellManager01 using SOAP connector;  The type of process is: DeploymentManager\\nWASX7031I: For help, enter: \\"print Help.help()\\"\\nwsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>WASX7015E: Exception running command: \\"    AdminApp.update(\'KYC_Remediation\', \'app\', [\'-operation\', \'update\', \'-contents\', \'/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war\', \'-contextroot\', \'KYC_Remediation\', \'-MapWebModToVH\', \'[[ .* .* default_host ]]\', \'-MapModulesToServers\', \'[[ .* .* WebSphere:cell=antibpsapp1Cell01,node=antibpsapp1Node01,server=server1 ]]\'])\\"; exception information:\\ncom.ibm.ws.scripting.ScriptingException: WASX7280E: An application with name \\"KYC_Remediation\\" does not exist.\\n\\nwsadmin>wsadmin>wsadmin>WASX7015E: Exception running command: \\"    AdminConfig.create(\'LibraryRef\', AdminConfig.getid(\'/Deployment:KYC_Remediation/\'), \'[[libraryName ibps_library,omnidocs_library,wfs_library,od_library]]\')\\"; exception information:\\ncom.ibm.ws.scripting.ScriptingException: WASX7444E: Invalid parameter value \\"\\" for parameter \\"parent config id\\" on command \\"create\\"\\n\\nwsadmin>wsadmin>wsadmin>\'\'\\nwsadmin>wsadmin>Deploying KYC_Remediation from WAR file: /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war\\nwsadmin>wsadmin>WASX7327I: Contents of was.policy file:\\n //\\n// Template policy file for enterprise application.\\n// Extra permissions can be added if required by the enterprise application.\\n//\\n// NOTE: Syntax errors in the policy files will cause the enterprise application FAIL to start.\\n//       Extreme care should be taken when editing these policy files. It is advised to use\\n//       the policytool provided by the JDK for editing the policy files\\n//       (WAS_HOME/java/jre/bin/policytool). \\n//\\n\\ngrant codeBase \\"file:${application}\\" {\\n};\\n\\ngrant codeBase \\"file:${jars}\\" {\\n};\\n\\ngrant codeBase \\"file:${connectorComponent}\\" {\\n};\\n\\ngrant codeBase \\"file:${webComponent}\\" {\\n};\\n\\ngrant codeBase \\"file:${ejbComponent}\\" {\\n};\\n\\n\\nADMA5016I: Installation of KYC_Remediation started.\\nADMA5026E: No valid target is specified in ObjectName WebSphere:cell=antibpsapp1Cell01,node=antibpsapp1Node01,server=server1 for module KYC_Remediation.war+WEB-INF/web.xml.\\nADMA5011I: The cleanup of the temp directory for application KYC_Remediation is complete.\\nADMA5014E: The installation of application KYC_Remediation failed.\\nWASX7015E: Exception running command: \\"    AdminApp.install(\'/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war\', \'-appname KYC_Remediation -contextroot KYC_Remediation -MapWebModToVH [[ .* .* default_host ]] -MapModulesToServers [[ .* .* WebSphere:cell=antibpsapp1Cell01,node=antibpsapp1Node01,server=server1 ]]\')\\"; exception information:\\ncom.ibm.ws.scripting.ScriptingException: WASX7132E: Application install for /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war failed: see previous messages for details.\\n\\nwsadmin>wsadmin>wsadmin>WASX7015E: Exception running command: \\"    AdminConfig.create(\'LibraryRef\', AdminConfig.getid(\'/Deployment:KYC_Remediation/\'), \'[[libraryName ibps_library,omnidocs_library,wfs_library,od_library]]\')\\"; exception information:\\ncom.ibm.ws.scripting.ScriptingException: WASX7444E: Invalid parameter value \\"\\" for parameter \\"parent config id\\" on command \\"create\\"\\n\\nwsadmin>wsadmin>wsadmin>\'\'\\nwsadmin>WASX7015E: Exception running command: \\"fi\\"; exception information:\\ncom.ibm.bsf.BSFException: exception from Jython:\\nTraceback (innermost last):\\n  File \\"<input>\\", line 1, in ?\\nNameError: fi\\n\\nwsadmin>wsadmin>Deployment failed. Check the output for errors.", "cmd": "cd /ibm/IBM/Application/release/release.3.0.0.41 && ./war-install-in-was.sh", "failed": true, "delta": "0:00:24.060793", "stderr": "Traceback (innermost last):\\n  (no code object) at line 0\\n  File \\"<input>\\", line 1\\n\\telse:\\n\\t^\\nSyntaxError: invalid syntax", "rc": 1, "invocation": {"module_args": {"creates": null, "executable": null, "_uses_shell": true, "strip_empty_ends": true, "_raw_params": "cd /ibm/IBM/Application/release/release.3.0.0.41 && ./war-install-in-was.sh", "removes": null, "argv": null, "warn": false, "chdir": null, "stdin_add_newline": true, "stdin": null}}, "start": "2024-04-23 19:27:59.699092", "msg": "non-zero return code"}\r\n', b'Shared connection to 10.15.11.209 closed.\r\n')
<10.15.11.209> Failed to connect to the host via ssh: Shared connection to 10.15.11.209 closed.
<10.15.11.209> ESTABLISH SSH CONNECTION FOR USER: itdevtra
<10.15.11.209> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o Port=22 -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="itdevtra"' -o ConnectTimeout=30 -o ControlPath=/home/itdevtra/.ansible/cp/9d82de7b55 10.15.11.209 '/bin/sh -c '"'"'rm -f -r /tmp/ansible-tmp-1713885889.8364644-2734025-154317193159194/ > /dev/null 2>&1 && sleep 0'"'"''
<10.15.11.209> (0, b'', b'')
fatal: [ANTIBPSAPP1]: FAILED! => {
    "changed": true,
    "cmd": "cd /ibm/IBM/Application/release/release.3.0.0.41 && ./war-install-in-was.sh",
    "delta": "0:00:24.060793",
    "end": "2024-04-23 19:28:23.759885",
    "invocation": {
        "module_args": {
            "_raw_params": "cd /ibm/IBM/Application/release/release.3.0.0.41 && ./war-install-in-was.sh",
            "_uses_shell": true,
            "argv": null,
            "chdir": null,
            "creates": null,
            "executable": null,
            "removes": null,
            "stdin": null,
            "stdin_add_newline": true,
            "strip_empty_ends": true,
            "warn": false
        }
    },
    "msg": "non-zero return code",
    "rc": 1,
    "start": "2024-04-23 19:27:59.699092",
    "stderr": "Traceback (innermost last):\n  (no code object) at line 0\n  File \"<input>\", line 1\n\telse:\n\t^\nSyntaxError: invalid syntax",
    "stderr_lines": [
        "Traceback (innermost last):",
        "  (no code object) at line 0",
        "  File \"<input>\", line 1",
        "\telse:",
        "\t^",
        "SyntaxError: invalid syntax"
    ],
    "stdout": "WASX7209I: Connected to process \"dmgr\" on node antibpsapp1CellManager01 using SOAP connector;  The type of process is: DeploymentManager\nWASX7031I: For help, enter: \"print Help.help()\"\nwsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>WASX7015E: Exception running command: \"    AdminApp.update('KYC_Remediation', 'app', ['-operation', 'update', '-contents', '/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war', '-contextroot', 'KYC_Remediation', '-MapWebModToVH', '[[ .* .* default_host ]]', '-MapModulesToServers', '[[ .* .* WebSphere:cell=antibpsapp1Cell01,node=antibpsapp1Node01,server=server1 ]]'])\"; exception information:\ncom.ibm.ws.scripting.ScriptingException: WASX7280E: An application with name \"KYC_Remediation\" does not exist.\n\nwsadmin>wsadmin>wsadmin>WASX7015E: Exception running command: \"    AdminConfig.create('LibraryRef', AdminConfig.getid('/Deployment:KYC_Remediation/'), '[[libraryName ibps_library,omnidocs_library,wfs_library,od_library]]')\"; exception information:\ncom.ibm.ws.scripting.ScriptingException: WASX7444E: Invalid parameter value \"\" for parameter \"parent config id\" on command \"create\"\n\nwsadmin>wsadmin>wsadmin>''\nwsadmin>wsadmin>Deploying KYC_Remediation from WAR file: /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war\nwsadmin>wsadmin>WASX7327I: Contents of was.policy file:\n //\n// Template policy file for enterprise application.\n// Extra permissions can be added if required by the enterprise application.\n//\n// NOTE: Syntax errors in the policy files will cause the enterprise application FAIL to start.\n//       Extreme care should be taken when editing these policy files. It is advised to use\n//       the policytool provided by the JDK for editing the policy files\n//       (WAS_HOME/java/jre/bin/policytool). \n//\n\ngrant codeBase \"file:${application}\" {\n};\n\ngrant codeBase \"file:${jars}\" {\n};\n\ngrant codeBase \"file:${connectorComponent}\" {\n};\n\ngrant codeBase \"file:${webComponent}\" {\n};\n\ngrant codeBase \"file:${ejbComponent}\" {\n};\n\n\nADMA5016I: Installation of KYC_Remediation started.\nADMA5026E: No valid target is specified in ObjectName WebSphere:cell=antibpsapp1Cell01,node=antibpsapp1Node01,server=server1 for module KYC_Remediation.war+WEB-INF/web.xml.\nADMA5011I: The cleanup of the temp directory for application KYC_Remediation is complete.\nADMA5014E: The installation of application KYC_Remediation failed.\nWASX7015E: Exception running command: \"    AdminApp.install('/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war', '-appname KYC_Remediation -contextroot KYC_Remediation -MapWebModToVH [[ .* .* default_host ]] -MapModulesToServers [[ .* .* WebSphere:cell=antibpsapp1Cell01,node=antibpsapp1Node01,server=server1 ]]')\"; exception information:\ncom.ibm.ws.scripting.ScriptingException: WASX7132E: Application install for /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war failed: see previous messages for details.\n\nwsadmin>wsadmin>wsadmin>WASX7015E: Exception running command: \"    AdminConfig.create('LibraryRef', AdminConfig.getid('/Deployment:KYC_Remediation/'), '[[libraryName ibps_library,omnidocs_library,wfs_library,od_library]]')\"; exception information:\ncom.ibm.ws.scripting.ScriptingException: WASX7444E: Invalid parameter value \"\" for parameter \"parent config id\" on command \"create\"\n\nwsadmin>wsadmin>wsadmin>''\nwsadmin>WASX7015E: Exception running command: \"fi\"; exception information:\ncom.ibm.bsf.BSFException: exception from Jython:\nTraceback (innermost last):\n  File \"<input>\", line 1, in ?\nNameError: fi\n\nwsadmin>wsadmin>Deployment failed. Check the output for errors.",
    "stdout_lines": [
        "WASX7209I: Connected to process \"dmgr\" on node antibpsapp1CellManager01 using SOAP connector;  The type of process is: DeploymentManager",
        "WASX7031I: For help, enter: \"print Help.help()\"",
        "wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>WASX7015E: Exception running command: \"    AdminApp.update('KYC_Remediation', 'app', ['-operation', 'update', '-contents', '/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war', '-contextroot', 'KYC_Remediation', '-MapWebModToVH', '[[ .* .* default_host ]]', '-MapModulesToServers', '[[ .* .* WebSphere:cell=antibpsapp1Cell01,node=antibpsapp1Node01,server=server1 ]]'])\"; exception information:",
        "com.ibm.ws.scripting.ScriptingException: WASX7280E: An application with name \"KYC_Remediation\" does not exist.",
        "",
        "wsadmin>wsadmin>wsadmin>WASX7015E: Exception running command: \"    AdminConfig.create('LibraryRef', AdminConfig.getid('/Deployment:KYC_Remediation/'), '[[libraryName ibps_library,omnidocs_library,wfs_library,od_library]]')\"; exception information:",
        "com.ibm.ws.scripting.ScriptingException: WASX7444E: Invalid parameter value \"\" for parameter \"parent config id\" on command \"create\"",
        "",
        "wsadmin>wsadmin>wsadmin>''",
        "wsadmin>wsadmin>Deploying KYC_Remediation from WAR file: /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war",
        "wsadmin>wsadmin>WASX7327I: Contents of was.policy file:",
        " //",
        "// Template policy file for enterprise application.",
        "// Extra permissions can be added if required by the enterprise application.",
        "//",
        "// NOTE: Syntax errors in the policy files will cause the enterprise application FAIL to start.",
        "//       Extreme care should be taken when editing these policy files. It is advised to use",
        "//       the policytool provided by the JDK for editing the policy files",
        "//       (WAS_HOME/java/jre/bin/policytool). ",
        "//",
        "",
        "grant codeBase \"file:${application}\" {",
        "};",
        "",
        "grant codeBase \"file:${jars}\" {",
        "};",
        "",
        "grant codeBase \"file:${connectorComponent}\" {",
        "};",
        "",
        "grant codeBase \"file:${webComponent}\" {",
        "};",
        "",
        "grant codeBase \"file:${ejbComponent}\" {",
        "};",
        "",
        "",
        "ADMA5016I: Installation of KYC_Remediation started.",
        "ADMA5026E: No valid target is specified in ObjectName WebSphere:cell=antibpsapp1Cell01,node=antibpsapp1Node01,server=server1 for module KYC_Remediation.war+WEB-INF/web.xml.",
        "ADMA5011I: The cleanup of the temp directory for application KYC_Remediation is complete.",
        "ADMA5014E: The installation of application KYC_Remediation failed.",
        "WASX7015E: Exception running command: \"    AdminApp.install('/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war', '-appname KYC_Remediation -contextroot KYC_Remediation -MapWebModToVH [[ .* .* default_host ]] -MapModulesToServers [[ .* .* WebSphere:cell=antibpsapp1Cell01,node=antibpsapp1Node01,server=server1 ]]')\"; exception information:",
        "com.ibm.ws.scripting.ScriptingException: WASX7132E: Application install for /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war failed: see previous messages for details.",
        "",
        "wsadmin>wsadmin>wsadmin>WASX7015E: Exception running command: \"    AdminConfig.create('LibraryRef', AdminConfig.getid('/Deployment:KYC_Remediation/'), '[[libraryName ibps_library,omnidocs_library,wfs_library,od_library]]')\"; exception information:",
        "com.ibm.ws.scripting.ScriptingException: WASX7444E: Invalid parameter value \"\" for parameter \"parent config id\" on command \"create\"",
        "",
        "wsadmin>wsadmin>wsadmin>''",
        "wsadmin>WASX7015E: Exception running command: \"fi\"; exception information:",
        "com.ibm.bsf.BSFException: exception from Jython:",
        "Traceback (innermost last):",
        "  File \"<input>\", line 1, in ?",
        "NameError: fi",
        "",
        "wsadmin>wsadmin>Deployment failed. Check the output for errors."
    ]
}
...ignoring
META: ran handlers
META: ran handlers
======================

#!/bin/bash

# Server details
WAS_HOST="10.15.11.209"
WAS_PORT="8879"
WAS_ADMIN_USER="deployer"
WAS_ADMIN_PASSWORD="deployer@123"

# WAR file and application details
WAR_FILE_PATH="/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war"
APP_NAME="KYC_Remediation_war"
CONTEXT_ROOT="/KYC_Remediation"

# Combine shared libraries into a single string
SHARED_LIB="ibps_library,omnidocs_library,wfs_library,od_library"

# Path to wsadmin.sh
WSADMIN="/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/wsadmin.sh"

# wsadmin script content
WSADMIN_SCRIPT="
# Check if the application already exists
if '$APP_NAME' in AdminApp.list().splitlines():
    print 'Application $APP_NAME already exists. Updating...'

    # Update the application
    AdminApp.update('$APP_NAME', 'app', ['-operation', 'update', '-contents', '$WAR_FILE_PATH', '-contextroot', '$CONTEXT_ROOT', '-MapWebModToVH', '[[ .* .* default_host ]]', '-MapModulesToServers', '[[ .* .* WebSphere:cell=antibpsapp1Cell01,node=antibpsapp1Node01,server=server1 ]]'])

    # Map shared libraries
    AdminConfig.create('LibraryRef', AdminConfig.getid('/Deployment:$APP_NAME/'), '[[libraryName $SHARED_LIB]]')

    # Save configuration changes
    AdminConfig.save()
else:
    print 'Deploying $APP_NAME from WAR file: $WAR_FILE_PATH'
    # Install the application
    AdminApp.install('$WAR_FILE_PATH', '[ -nopreCompileJSPs -distributeApp -nouseMetaDataFromBinary -nodeployejb -appname $APP_NAME -createMBeansForResources -noreloadEnabled -nodeployws -validateinstall warn -noprocessEmbeddedConfig -filepermission .*\.dll=755#.*\.so=755#.*\.a=755#.*\.sl=755 -noallowDispatchRemoteInclude -noallowServiceRemoteInclude -asyncRequestDispatchType DISABLED -nouseAutoLink -noenableClientModule -clientMode isolated -novalidateSchema -contextroot $CONTEXT_ROOT -MapModulesToServers [[ KYC_Remediation.war KYC_Remediation.war,WEB-INF/web.xml WebSphere:cell=antibpsapp1Cell01,cluster=BPMCLUSTER ]]]' )

    # Map shared libraries
    AdminConfig.create('LibraryRef', AdminConfig.getid('/Deployment:$APP_NAME/'), '[[libraryName $SHARED_LIB]]')

    # Save configuration changes
    AdminConfig.save()
fi
"

# Execute the script with wsadmin
echo "$WSADMIN_SCRIPT" | $WSADMIN -lang jython -conntype SOAP -host $WAS_HOST -port $WAS_PORT -user $WAS_ADMIN_USER -password $WAS_ADMIN_PASSWORD

# Check deployment status
if [ $? -eq 0 ]; then
    echo "Deployment of $APP_NAME completed successfully."
else
    echo "Deployment failed. Check the output for errors."
    exit 1
fi
====================

TASK [IBPS-deployment : Run war-install-in-was.sh on Target Server] ************
task path: /ansible/GITHUB_RUNNER/actions-runner10/_work/ibps-was-ansible-cd/ibps-was-ansible-cd/roles/IBPS-deployment/tasks/main-war-installation.yml:27
<10.15.11.209> ESTABLISH SSH CONNECTION FOR USER: itdevtra
<10.15.11.209> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o Port=22 -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="itdevtra"' -o ConnectTimeout=30 -o ControlPath=/home/itdevtra/.ansible/cp/9d82de7b55 10.15.11.209 '/bin/sh -c '"'"'( umask 77 && mkdir -p "` echo /tmp `"&& mkdir /tmp/ansible-tmp-1714033675.4847848-3645209-11704696654606 && echo ansible-tmp-1714033675.4847848-3645209-11704696654606="` echo /tmp/ansible-tmp-1714033675.4847848-3645209-11704696654606 `" ) && sleep 0'"'"''
<10.15.11.209> (0, b'ansible-tmp-1714033675.4847848-3645209-11704696654606=/tmp/ansible-tmp-1714033675.4847848-3645209-11704696654606\n', b'')
Using module file /usr/lib/python3.6/site-packages/ansible/modules/commands/command.py
<10.15.11.209> PUT /home/itdevtra/.ansible/tmp/ansible-local-3645163iivg47ke/tmpbr94rpan TO /tmp/ansible-tmp-1714033675.4847848-3645209-11704696654606/AnsiballZ_command.py
<10.15.11.209> SSH: EXEC sftp -b - -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o Port=22 -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="itdevtra"' -o ConnectTimeout=30 -o ControlPath=/home/itdevtra/.ansible/cp/9d82de7b55 '[10.15.11.209]'
<10.15.11.209> (0, b'sftp> put /home/itdevtra/.ansible/tmp/ansible-local-3645163iivg47ke/tmpbr94rpan /tmp/ansible-tmp-1714033675.4847848-3645209-11704696654606/AnsiballZ_command.py\n', b'')
<10.15.11.209> ESTABLISH SSH CONNECTION FOR USER: itdevtra
<10.15.11.209> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o Port=22 -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="itdevtra"' -o ConnectTimeout=30 -o ControlPath=/home/itdevtra/.ansible/cp/9d82de7b55 10.15.11.209 '/bin/sh -c '"'"'chmod u+x /tmp/ansible-tmp-1714033675.4847848-3645209-11704696654606/ /tmp/ansible-tmp-1714033675.4847848-3645209-11704696654606/AnsiballZ_command.py && sleep 0'"'"''
<10.15.11.209> (0, b'', b'')
<10.15.11.209> ESTABLISH SSH CONNECTION FOR USER: itdevtra
<10.15.11.209> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o Port=22 -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="itdevtra"' -o ConnectTimeout=30 -o ControlPath=/home/itdevtra/.ansible/cp/9d82de7b55 -tt 10.15.11.209 '/bin/sh -c '"'"'/usr/bin/python /tmp/ansible-tmp-1714033675.4847848-3645209-11704696654606/AnsiballZ_command.py && sleep 0'"'"''
<10.15.11.209> (1, b'\r\n{"changed": true, "end": "2024-04-25 12:32:21.075254", "stdout": "WASX7209I: Connected to process \\"dmgr\\" on node antibpsapp1CellManager01 using SOAP connector;  The type of process is: DeploymentManager\\nWASX7031I: For help, enter: \\"print Help.help()\\"\\nwsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>WASX7015E: Exception running command: \\"    AdminApp.update(\'KYC_Remediation_war\', \'app\', [\'-operation\', \'update\', \'-contents\', \'/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war\', \'-contextroot\', \'/KYC_Remediation\', \'-MapWebModToVH\', \'[[ .* .* default_host ]]\', \'-MapModulesToServers\', \'[[ .* .* WebSphere:cell=antibpsapp1Cell01,node=antibpsapp1Node01,server=server1 ]]\'])\\"; exception information:\\ncom.ibm.ws.scripting.ScriptingException: WASX7280E: An application with name \\"KYC_Remediation_war\\" does not exist.\\n\\nwsadmin>wsadmin>wsadmin>WASX7015E: Exception running command: \\"    AdminConfig.create(\'LibraryRef\', AdminConfig.getid(\'/Deployment:KYC_Remediation_war/\'), \'[[libraryName ibps_library,omnidocs_library,wfs_library,od_library]]\')\\"; exception information:\\ncom.ibm.ws.scripting.ScriptingException: WASX7444E: Invalid parameter value \\"\\" for parameter \\"parent config id\\" on command \\"create\\"\\n\\nwsadmin>wsadmin>wsadmin>\'\'\\nwsadmin>wsadmin>Deploying KYC_Remediation_war from WAR file: /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war\\nwsadmin>wsadmin>WASX7327I: Contents of was.policy file:\\n //\\n// Template policy file for enterprise application.\\n// Extra permissions can be added if required by the enterprise application.\\n//\\n// NOTE: Syntax errors in the policy files will cause the enterprise application FAIL to start.\\n//       Extreme care should be taken when editing these policy files. It is advised to use\\n//       the policytool provided by the JDK for editing the policy files\\n//       (WAS_HOME/java/jre/bin/policytool). \\n//\\n\\ngrant codeBase \\"file:${application}\\" {\\n};\\n\\ngrant codeBase \\"file:${jars}\\" {\\n};\\n\\ngrant codeBase \\"file:${connectorComponent}\\" {\\n};\\n\\ngrant codeBase \\"file:${webComponent}\\" {\\n};\\n\\ngrant codeBase \\"file:${ejbComponent}\\" {\\n};\\n\\n\\nADMA5016I: Installation of KYC_Remediation_war started.\\nADMA5067I: Resource validation for application KYC_Remediation_war completed successfully.\\nADMA5058I: Application and module versions are validated with versions of deployment targets.\\nADMA5005I: The application KYC_Remediation_war is configured in the WebSphere Application Server repository.\\nADMA5005I: The application KYC_Remediation_war is configured in the WebSphere Application Server repository.\\nADMA5081I: The bootstrap address for client module is configured in the WebSphere Application Server repository.\\nADMA5053I: The library references for the installed optional package are created.\\nADMA5005I: The application KYC_Remediation_war is configured in the WebSphere Application Server repository.\\nADMA5001I: The application binaries are saved in /ibm/IBM/WebSphere/AppServer/profiles/Dmgr01/wstemp/Script18f14614d58/workspace/cells/antibpsapp1Cell01/applications/KYC_Remediation_war.ear/KYC_Remediation_war.ear\\nADMA5005I: The application KYC_Remediation_war is configured in the WebSphere Application Server repository.\\nSECJ0400I: Successfully updated the application KYC_Remediation_war with the appContextIDForSecurity information.\\nADMA5005I: The application KYC_Remediation_war is configured in the WebSphere Application Server repository.\\nADMA5005I: The application KYC_Remediation_war is configured in the WebSphere Application Server repository.\\nADMA5113I: Activation plan created successfully.\\nADMA5011I: The cleanup of the temp directory for application KYC_Remediation_war is complete.\\nADMA5013I: Application KYC_Remediation_war installed successfully.\\n\'\'\\nwsadmin>wsadmin>wsadmin>WASX7015E: Exception running command: \\"    AdminConfig.create(\'LibraryRef\', AdminConfig.getid(\'/Deployment:KYC_Remediation_war/\'), \'[[libraryName ibps_library,omnidocs_library,wfs_library,od_library]]\')\\"; exception information:\\ncom.ibm.ws.scripting.ScriptingException: WASX7129E: Cannot create objects of type \\"LibraryRef\\" in parents of type \\"Deployment\\"\\n\\nwsadmin>wsadmin>wsadmin>\'\'\\nwsadmin>WASX7015E: Exception running command: \\"fi\\"; exception information:\\ncom.ibm.bsf.BSFException: exception from Jython:\\nTraceback (innermost last):\\n  File \\"<input>\\", line 1, in ?\\nNameError: fi\\n\\nwsadmin>wsadmin>Deployment failed. Check the output for errors.", "cmd": "cd /ibm/IBM/Application/release/release.3.0.0.41 && ./war-install-in-was.sh", "failed": true, "delta": "0:01:13.109718", "stderr": "Traceback (innermost last):\\n  (no code object) at line 0\\n  File \\"<input>\\", line 1\\n\\telse:\\n\\t^\\nSyntaxError: invalid syntax", "rc": 1, "invocation": {"module_args": {"creates": null, "executable": null, "_uses_shell": true, "strip_empty_ends": true, "_raw_params": "cd /ibm/IBM/Application/release/release.3.0.0.41 && ./war-install-in-was.sh", "removes": null, "argv": null, "warn": false, "chdir": null, "stdin_add_newline": true, "stdin": null}}, "start": "2024-04-25 12:31:07.965536", "msg": "non-zero return code"}\r\n', b'Shared connection to 10.15.11.209 closed.\r\n')
<10.15.11.209> Failed to connect to the host via ssh: Shared connection to 10.15.11.209 closed.
<10.15.11.209> ESTABLISH SSH CONNECTION FOR USER: itdevtra
<10.15.11.209> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o Port=22 -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="itdevtra"' -o ConnectTimeout=30 -o ControlPath=/home/itdevtra/.ansible/cp/9d82de7b55 10.15.11.209 '/bin/sh -c '"'"'rm -f -r /tmp/ansible-tmp-1714033675.4847848-3645209-11704696654606/ > /dev/null 2>&1 && sleep 0'"'"''
<10.15.11.209> (0, b'', b'')
fatal: [ANTIBPSAPP1]: FAILED! => {
    "changed": true,
    "cmd": "cd /ibm/IBM/Application/release/release.3.0.0.41 && ./war-install-in-was.sh",
    "delta": "0:01:13.109718",
    "end": "2024-04-25 12:32:21.075254",
    "invocation": {
        "module_args": {
            "_raw_params": "cd /ibm/IBM/Application/release/release.3.0.0.41 && ./war-install-in-was.sh",
            "_uses_shell": true,
            "argv": null,
            "chdir": null,
            "creates": null,
            "executable": null,
            "removes": null,
            "stdin": null,
            "stdin_add_newline": true,
            "strip_empty_ends": true,
            "warn": false
        }
    },
    "msg": "non-zero return code",
    "rc": 1,
    "start": "2024-04-25 12:31:07.965536",
    "stderr": "Traceback (innermost last):\n  (no code object) at line 0\n  File \"<input>\", line 1\n\telse:\n\t^\nSyntaxError: invalid syntax",
    "stderr_lines": [
        "Traceback (innermost last):",
        "  (no code object) at line 0",
        "  File \"<input>\", line 1",
        "\telse:",
        "\t^",
        "SyntaxError: invalid syntax"
    ],
    "stdout": "WASX7209I: Connected to process \"dmgr\" on node antibpsapp1CellManager01 using SOAP connector;  The type of process is: DeploymentManager\nWASX7031I: For help, enter: \"print Help.help()\"\nwsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>WASX7015E: Exception running command: \"    AdminApp.update('KYC_Remediation_war', 'app', ['-operation', 'update', '-contents', '/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war', '-contextroot', '/KYC_Remediation', '-MapWebModToVH', '[[ .* .* default_host ]]', '-MapModulesToServers', '[[ .* .* WebSphere:cell=antibpsapp1Cell01,node=antibpsapp1Node01,server=server1 ]]'])\"; exception information:\ncom.ibm.ws.scripting.ScriptingException: WASX7280E: An application with name \"KYC_Remediation_war\" does not exist.\n\nwsadmin>wsadmin>wsadmin>WASX7015E: Exception running command: \"    AdminConfig.create('LibraryRef', AdminConfig.getid('/Deployment:KYC_Remediation_war/'), '[[libraryName ibps_library,omnidocs_library,wfs_library,od_library]]')\"; exception information:\ncom.ibm.ws.scripting.ScriptingException: WASX7444E: Invalid parameter value \"\" for parameter \"parent config id\" on command \"create\"\n\nwsadmin>wsadmin>wsadmin>''\nwsadmin>wsadmin>Deploying KYC_Remediation_war from WAR file: /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war\nwsadmin>wsadmin>WASX7327I: Contents of was.policy file:\n //\n// Template policy file for enterprise application.\n// Extra permissions can be added if required by the enterprise application.\n//\n// NOTE: Syntax errors in the policy files will cause the enterprise application FAIL to start.\n//       Extreme care should be taken when editing these policy files. It is advised to use\n//       the policytool provided by the JDK for editing the policy files\n//       (WAS_HOME/java/jre/bin/policytool). \n//\n\ngrant codeBase \"file:${application}\" {\n};\n\ngrant codeBase \"file:${jars}\" {\n};\n\ngrant codeBase \"file:${connectorComponent}\" {\n};\n\ngrant codeBase \"file:${webComponent}\" {\n};\n\ngrant codeBase \"file:${ejbComponent}\" {\n};\n\n\nADMA5016I: Installation of KYC_Remediation_war started.\nADMA5067I: Resource validation for application KYC_Remediation_war completed successfully.\nADMA5058I: Application and module versions are validated with versions of deployment targets.\nADMA5005I: The application KYC_Remediation_war is configured in the WebSphere Application Server repository.\nADMA5005I: The application KYC_Remediation_war is configured in the WebSphere Application Server repository.\nADMA5081I: The bootstrap address for client module is configured in the WebSphere Application Server repository.\nADMA5053I: The library references for the installed optional package are created.\nADMA5005I: The application KYC_Remediation_war is configured in the WebSphere Application Server repository.\nADMA5001I: The application binaries are saved in /ibm/IBM/WebSphere/AppServer/profiles/Dmgr01/wstemp/Script18f14614d58/workspace/cells/antibpsapp1Cell01/applications/KYC_Remediation_war.ear/KYC_Remediation_war.ear\nADMA5005I: The application KYC_Remediation_war is configured in the WebSphere Application Server repository.\nSECJ0400I: Successfully updated the application KYC_Remediation_war with the appContextIDForSecurity information.\nADMA5005I: The application KYC_Remediation_war is configured in the WebSphere Application Server repository.\nADMA5005I: The application KYC_Remediation_war is configured in the WebSphere Application Server repository.\nADMA5113I: Activation plan created successfully.\nADMA5011I: The cleanup of the temp directory for application KYC_Remediation_war is complete.\nADMA5013I: Application KYC_Remediation_war installed successfully.\n''\nwsadmin>wsadmin>wsadmin>WASX7015E: Exception running command: \"    AdminConfig.create('LibraryRef', AdminConfig.getid('/Deployment:KYC_Remediation_war/'), '[[libraryName ibps_library,omnidocs_library,wfs_library,od_library]]')\"; exception information:\ncom.ibm.ws.scripting.ScriptingException: WASX7129E: Cannot create objects of type \"LibraryRef\" in parents of type \"Deployment\"\n\nwsadmin>wsadmin>wsadmin>''\nwsadmin>WASX7015E: Exception running command: \"fi\"; exception information:\ncom.ibm.bsf.BSFException: exception from Jython:\nTraceback (innermost last):\n  File \"<input>\", line 1, in ?\nNameError: fi\n\nwsadmin>wsadmin>Deployment failed. Check the output for errors.",
    "stdout_lines": [
        "WASX7209I: Connected to process \"dmgr\" on node antibpsapp1CellManager01 using SOAP connector;  The type of process is: DeploymentManager",
        "WASX7031I: For help, enter: \"print Help.help()\"",
        "wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>wsadmin>WASX7015E: Exception running command: \"    AdminApp.update('KYC_Remediation_war', 'app', ['-operation', 'update', '-contents', '/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war', '-contextroot', '/KYC_Remediation', '-MapWebModToVH', '[[ .* .* default_host ]]', '-MapModulesToServers', '[[ .* .* WebSphere:cell=antibpsapp1Cell01,node=antibpsapp1Node01,server=server1 ]]'])\"; exception information:",
        "com.ibm.ws.scripting.ScriptingException: WASX7280E: An application with name \"KYC_Remediation_war\" does not exist.",
        "",
        "wsadmin>wsadmin>wsadmin>WASX7015E: Exception running command: \"    AdminConfig.create('LibraryRef', AdminConfig.getid('/Deployment:KYC_Remediation_war/'), '[[libraryName ibps_library,omnidocs_library,wfs_library,od_library]]')\"; exception information:",
        "com.ibm.ws.scripting.ScriptingException: WASX7444E: Invalid parameter value \"\" for parameter \"parent config id\" on command \"create\"",
        "",
        "wsadmin>wsadmin>wsadmin>''",
        "wsadmin>wsadmin>Deploying KYC_Remediation_war from WAR file: /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war",
        "wsadmin>wsadmin>WASX7327I: Contents of was.policy file:",
        " //",
        "// Template policy file for enterprise application.",
        "// Extra permissions can be added if required by the enterprise application.",
        "//",
        "// NOTE: Syntax errors in the policy files will cause the enterprise application FAIL to start.",
        "//       Extreme care should be taken when editing these policy files. It is advised to use",
        "//       the policytool provided by the JDK for editing the policy files",
        "//       (WAS_HOME/java/jre/bin/policytool). ",
        "//",
        "",
        "grant codeBase \"file:${application}\" {",
        "};",
        "",
        "grant codeBase \"file:${jars}\" {",
        "};",
        "",
        "grant codeBase \"file:${connectorComponent}\" {",
        "};",
        "",
        "grant codeBase \"file:${webComponent}\" {",
        "};",
        "",
        "grant codeBase \"file:${ejbComponent}\" {",
        "};",
        "",
        "",
        "ADMA5016I: Installation of KYC_Remediation_war started.",
        "ADMA5067I: Resource validation for application KYC_Remediation_war completed successfully.",
        "ADMA5058I: Application and module versions are validated with versions of deployment targets.",
        "ADMA5005I: The application KYC_Remediation_war is configured in the WebSphere Application Server repository.",
        "ADMA5005I: The application KYC_Remediation_war is configured in the WebSphere Application Server repository.",
        "ADMA5081I: The bootstrap address for client module is configured in the WebSphere Application Server repository.",
        "ADMA5053I: The library references for the installed optional package are created.",
        "ADMA5005I: The application KYC_Remediation_war is configured in the WebSphere Application Server repository.",
        "ADMA5001I: The application binaries are saved in /ibm/IBM/WebSphere/AppServer/profiles/Dmgr01/wstemp/Script18f14614d58/workspace/cells/antibpsapp1Cell01/applications/KYC_Remediation_war.ear/KYC_Remediation_war.ear",
        "ADMA5005I: The application KYC_Remediation_war is configured in the WebSphere Application Server repository.",
        "SECJ0400I: Successfully updated the application KYC_Remediation_war with the appContextIDForSecurity information.",
        "ADMA5005I: The application KYC_Remediation_war is configured in the WebSphere Application Server repository.",
        "ADMA5005I: The application KYC_Remediation_war is configured in the WebSphere Application Server repository.",
        "ADMA5113I: Activation plan created successfully.",
        "ADMA5011I: The cleanup of the temp directory for application KYC_Remediation_war is complete.",
        "ADMA5013I: Application KYC_Remediation_war installed successfully.",
        "''",
        "wsadmin>wsadmin>wsadmin>WASX7015E: Exception running command: \"    AdminConfig.create('LibraryRef', AdminConfig.getid('/Deployment:KYC_Remediation_war/'), '[[libraryName ibps_library,omnidocs_library,wfs_library,od_library]]')\"; exception information:",
        "com.ibm.ws.scripting.ScriptingException: WASX7129E: Cannot create objects of type \"LibraryRef\" in parents of type \"Deployment\"",
        "",
        "wsadmin>wsadmin>wsadmin>''",
        "wsadmin>WASX7015E: Exception running command: \"fi\"; exception information:",
        "com.ibm.bsf.BSFException: exception from Jython:",
        "Traceback (innermost last):",
        "  File \"<input>\", line 1, in ?",
        "NameError: fi",
        "",
        "wsadmin>wsadmin>Deployment failed. Check the output for errors."
    ]
}
...ignoring
META: ran handlers
META: ran handlers
==============
Anisur

Dear Shanmuganathan,


IP- 10.15.11.209 

Script to stop server

cd /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/

./stopServer.sh BPMMBR01
./stopNode.sh

Script to start server

cd /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/

./startNode.sh
./startServer.sh BPMMBR01


IP-10.15.11.210

Script to stop server

cd /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/

./stopServer.sh BPMMBR02
./stopNode.sh

Script to start server

cd /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/

./startNode.sh
./startServer.sh BPMMBR02

===========

hritik

Classification: RAKBANK-Internal

Dear Shanmuganathan,

PFB the details:

APP_NAME: Kindly check with Devdutta.

CONTEXT_ROOT: The war name itself will be the context root (e.g. - KYC_Remediation)

SHARED_LIB :

·         ibps_library

·         omnidocs_library

·         wfs_library

·         od_library

=====================
[3:44 PM] Pradip Kanasani
shared libraries : ibps_library
omnidocs_library
wfs_library
[3:44 PM] Pradip Kanasani
class loader : PARENT LAST
[3:45 PM] Shanmuganathan Murugesan
via console right?
[3:45 PM] Pradip Kanasani
CONTEXT_ROOT="/KYC_Remediation"
============

Hi Anisur,

We've encountered an issue while running the pipeline, where although we're able to install the WAR file into WAS, the web application isn't loading properly. Could you please manually deploy the WAR file installation into WAS and provide us with any insights or results you obtain? If the deployment is successful, please confirm and share the details, and if it fails, kindly share the log files with us for verification.

Server IP: 10.15.11.209
WAR File Name: KYC_Remediation.war
Path: /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war
Shared Libraries:

ibps_library
omnidocs_library
wfs_library
Class Loader: PARENT LAST
CONTEXT_ROOT: "/KYC_Remediation"

===============
Profile_home="$1"
release_version="$2"
zip_file_url="$3"
zip_file_name="$4"

# Extract the zip file to a new release directory
unzip -q "$Profile_home/release.$release_version/$zip_file_name" -d "$Profile_home/release.$release_version"

# Check if release.txt exists
release_txt_path="$Profile_home/release.$release_version/release/release.txt"
if [ ! -f "$release_txt_path" ]; then
    echo "Error: release.txt not found at $release_txt_path"
    exit 1
fi

# Read the content of release.txt and remove any leading/trailing whitespace characters
release_content=$(sed 's/^[[:space:]]*//;s/[[:space:]]*$//' "$release_txt_path" 2>/dev/null)

# Print the content of release_content
echo "$release_content"

# Backup old deployment files for each application with timestamp
if [ -n "$release_content" ]; then
    backup_location="$Profile_home/release.$release_version"
    backup_timestamp=$(date +'%Y%m%d%H%M%S')
    backup_directory="$backup_location/backup-$backup_timestamp"
    mkdir -p "$backup_directory"
    chmod 777 "$backup_directory"

    # Copy release.txt file into backup directory
    cp "$release_txt_path" "$backup_directory"

    # Iterate through each line in release_content
    while IFS=, read -r app_name app_targeted_location; do
        # Check if both app_name and app_targeted_location are not empty
        if [ -n "$app_name" ] && [ -n "$app_targeted_location" ]; then
            # Construct paths for old deployment files and backup location
            old_deployment_path="$app_targeted_location"
            backup_path="$backup_directory/$app_name"

            # Copy old deployment files to backup location
            cp -r "$old_deployment_path" "$backup_path"

            # Print information about the backup
            echo "Backup: $app_name - $old_deployment_path -> $backup_path"

            # Define paths for new deployment files and targeted location
            new_deployment_path="$Profile_home/release.$release_version/release/$app_name"  # Assuming the new files are in the release directory

            # Copy new deployment files to targeted location
            cp -r "$new_deployment_path" "$app_targeted_location"

            # Set permissions to 755 on new deployment files
            chmod -R 755 "$app_targeted_location/$app_name"

            # Print information about the copy
            echo "Copy: $app_name - $new_deployment_path -> $app_targeted_location"
        fi
    done <<< "$release_content"
fi

ls -la "/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/CustomConfig"
ls -la "/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/CustomConfig/KYC_Remediation"
ls -la "/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01"
===============================
[target_wasuat209]
ANTIBPSAPP1 ansible_ssh_host=10.15.11.209

#[target_wasuat210]
#ANTIBPSAPP1 ansible_ssh_host=10.15.11.210

#[target_wasreplica86]
#ANT3CASAPPS02 ansible_ssh_host=10.15.24.86
-===================

#!/bin/bash

# Server details (adapt these variables to your environment)
WAS_HOST="10.15.11.209"
WAS_PORT="9043" # Change to your WAS administrative port, often 9043 for HTTPS
WAS_ADMIN_USER="deployer"
WAS_ADMIN_PASSWORD="deployer@123"

# WAR file and application details
WAR_FILE_PATH="/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war"
APP_NAME="KYC_Remediation"
CONTEXT_ROOT="KYC_Remediation"

# Combine all shared libraries into a single string
SHARED_LIB=$(printf ",%s" "$@")
SHARED_LIB=${SHARED_LIB:1} # Remove the leading comma

# Path to wsadmin.sh (adjust for your WAS installation)
WSADMIN="/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/wsadmin.sh"

# wsadmin script content
WSADMIN_SCRIPT="
# Connect to WebSphere Application Server
AdminConfig.connect('$WAS_ADMIN_USER', '$WAS_ADMIN_PASSWORD')

# Check if the application already exists
if AdminApp.list().find('$APP_NAME') != -1:
    print('Application $APP_NAME already exists. Skipping installation.')
else:
    # Install the application with Parent Last class loader policy
    AdminApp.install('$WAR_FILE_PATH', '[ -appname $APP_NAME -contextroot $CONTEXT_ROOT -MapModulesToServers [[ .* .* WebSphere:cell=YourCellName,node=YourNodeName,server=YourServerName ]] -MapWebModToVH [[ .* .* default_host ]] -classloaderMode PARENT_LAST ]')
    # Install the application
    #AdminApp.install('$WAR_FILE_PATH', '[ -appname $APP_NAME -contextroot $CONTEXT_ROOT -MapWebModToVH [[ .* .* default_host ]] ]')
    # Map shared libraries (Optional: Adjust or remove according to your requirements)
    AdminConfig.create('LibraryRef', AdminConfig.getid('/Deployment:$APP_NAME/'), '[[libraryName $SHARED_LIB]]')
    # Save configuration changes
    AdminConfig.save()

# Disconnect from the server
AdminConfig.disconnect()
"

# Check if shared libraries were provided
if [ -z "$SHARED_LIB" ]; then
    echo "No shared libraries provided. Deployment failed."
    exit 1
fi

# Execute the script with wsadmin
echo "Deploying $APP_NAME from WAR file: $WAR_FILE_PATH"
echo "$WSADMIN_SCRIPT" | $WSADMIN -lang jython -conntype SOAP -host $WAS_HOST -port $WAS_PORT -user $WAS_ADMIN_USER -password $WAS_ADMIN_PASSWORD

if [ $? -eq 0 ]; then
    echo "Deployment of $APP_NAME completed successfully."
else
    echo "Deployment failed. Check the output for errors."
    exit 1
fi
====================

#!/bin/bash
 
# Server details
WAS_HOST="10.15.11.209"
WAS_PORT="9043"
WAS_ADMIN_USER="deployer"
WAS_ADMIN_PASSWORD="deployer@123"
 
# WAR file and application details
WAR_FILE_PATH="/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war"
APP_NAME="KYC_Remediation"
CONTEXT_ROOT="KYC_Remediation"
 
# Combine shared libraries into a single string
SHARED_LIB="ibps_library,omnidocs_library,wfs_library,od_library"
 
# Path to wsadmin.sh
WSADMIN="/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/wsadmin.sh"
 
# wsadmin script content
WSADMIN_SCRIPT="

# Check if the application already exists
if '$APP_NAME' in AdminApp.list().splitlines():
    print('Application $APP_NAME already exists. Updating...')

    # Update the application
    AdminApp.update('$APP_NAME', 'app', ['-operation', 'update', '-contents', '$WAR_FILE_PATH', '-contextroot', '$CONTEXT_ROOT'])

    # Map shared libraries
    AdminConfig.create('LibraryRef', AdminConfig.getid('/Deployment:$APP_NAME/'), '[[libraryName $SHARED_LIB]]')

    # Save configuration changes
    AdminConfig.save()

else:

    # Install the application
    AdminApp.install('$WAR_FILE_PATH', '-appname $APP_NAME -contextroot $CONTEXT_ROOT -MapWebModToVH [[ .* .* default_host ]]')

    # Map shared libraries
    AdminConfig.create('LibraryRef', AdminConfig.getid('/Deployment:$APP_NAME/'), '[[libraryName $SHARED_LIB]]')

    # Save configuration changes
    AdminConfig.save()
"
 
# Execute the script with wsadmin
echo "Deploying $APP_NAME from WAR file: $WAR_FILE_PATH"
echo "$WSADMIN_SCRIPT" | $WSADMIN -lang jython -conntype SOAP -host $WAS_HOST -port $WAS_PORT -user $WAS_ADMIN_USER -password $WAS_ADMIN_PASSWORD
 
# Check deployment status
if [ $? -eq 0 ]; then
    echo "Deployment of $APP_NAME completed successfully."
else
    echo "Deployment failed. Check the output for errors."
    exit 1
fi
========================

I am checking with Application support team and newgen team for the availability time to schedule the meeting and will update once I get it.

I am checking with the Application Support team and the Newgen team to determine their availability for scheduling the meeting. I will update you once I receive the information.


---
# Server details
WAR_FILE_PATH: "/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war"
APP_NAME: "KYC_Remediation_war"
CONTEXT_ROOT: "/KYC_Remediation"
WAS_HOST: "10.15.11.209"
WAS_PORT: "8879"
WAS_ADMIN_USER: "deployer"
WAS_ADMIN_PASSWORD: "deployer@123"
CELL_NAME: "antibpsapp1Cell01"
CLUSTER_NAME: "BPMCLUSTER"
WSADMIN: "/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/wsadmin.sh"
shared_libs: ("ibps_library" "omnidocs_library" "wfs_library")
...

Requested runner group: rakbank-self-hosted-runner
Requested labels: dehitdevtra1
Job defined at: rakbank-internal/ibps-was-ansible-cd/.github/workflows/ibps_deployment.yml@refs/heads/feature/warinstall
Waiting for a runner to pick up this job...
==========

Requested runner group: rakbank-self-hosted-runner
Requested labels: dehitdevtra1
Job defined at: rakbank-internal/ibps-was-ansible-cd/.github/workflows/IBPS-warfileinstall.yml@refs/heads/feature/changes
Waiting for a runner to pick up this job...

https://github.com/rakbank-internal/ibps-was-ansible-cd/actions/workflows/ibps_loose_file_deployment.yml
=================

ERROR! Syntax Error while loading YAML.
  did not find expected ',' or ']'

The error appears to be in '/ansible/GITHUB_RUNNER/actions-runner10/_work/ibps-was-ansible-cd/ibps-was-ansible-cd/roles/IBPS-warfileinstall/defaults/main.yml': line 13, column 30, but may
be elsewhere in the file depending on the exact syntax problem.

The offending line appears to be:

WSADMIN: "/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/wsadmin.sh"
shared_libs: ["ibps_library" "omnidocs_library" "wfs_library"]
                             ^ here
We could be wrong, but this one looks like it might be an issue with
unbalanced quotes. If starting a value with a quote, make sure the
line ends with the same set of quotes. For instance this arbitrary
example:

    foo: "bad" "wolf"

Could be written as:

    foo: '"bad" "wolf"'
Error: Process completed with exit code 4.
=====================

#!/bin/bash
 
# Server details
WAS_HOST="$1"
WAS_PORT="$2"
WAS_ADMIN_USER="$3"
WAS_ADMIN_PASSWORD="$4"
 
# WAR file and application details
WAR_FILE_PATH="$5"
APP_NAME="$6"
CONTEXT_ROOT="$7"
CELL_NAME="$8"
CLUSTER_NAME="$9"
 
# Path to wsadmin.sh
WSADMIN="$10"
 
# Define the shared libraries array
shared_libs=(${11//+/ })
 
# Create a new file for the Jython script
WSADMIN_SCRIPT="wsadmin_script.jy"
 
# Write the initial part of the Jython script to the file
cat <<EOF >$WSADMIN_SCRIPT
import time
import sys

# Check if the application is already running
if '${APP_NAME}' in AdminControl.queryNames('type=Application,*').splitlines():
    print 'Application ${APP_NAME} is already running. Stopping it...'
    app_managers = AdminControl.queryNames('type=ApplicationManager,*').splitlines()
    for app_manager in app_managers:
        AdminControl.invoke(app_manager, 'stopApplication', '${APP_NAME}', '[${CELL_NAME},${CLUSTER_NAME}]')
    print 'Application ${APP_NAME} stop command issued.'

# Wait for the application to stop
while '${APP_NAME}' in AdminControl.queryNames('type=Application,*').splitlines():
    print 'Waiting for application %s to stop...' % '${APP_NAME}'
    time.sleep(30)

print 'Application %s is not running.' % '${APP_NAME}'

# Uninstall the application if it already exists
if '${APP_NAME}' in AdminApp.list().splitlines():
    print 'Application %s already exists. Removing...' % '${APP_NAME}'
    result = AdminApp.uninstall('${APP_NAME}')
    if result != '':
        print 'Failed to uninstall application ' + '${APP_NAME}' + '. Error: ' + result
        raise Exception('Failed to uninstall application ' + '${APP_NAME}')
    else:
        AdminConfig.save()
        print 'Application %s removed.' % '${APP_NAME}'

# Install the application
shared_libs_str = '+'.join(['${APP_NAME}', 'META-INF/application.xml'] + shared_libs)
result = AdminApp.install("${WAR_FILE_PATH}", '[ -nopreCompileJSPs -distributeApp -nouseMetaDataFromBinary -nodeployejb -appname ${APP_NAME} -createMBeansForResources -noreloadEnabled -nodeployws -validateinstall warn -noprocessEmbeddedConfig -filepermission .*\.dll=755#.*\.so=755#.*\.a=755#.*\.sl=755 -noallowDispatchRemoteInclude -noallowServiceRemoteInclude -asyncRequestDispatchType DISABLED -nouseAutoLink -noenableClientModule -clientMode isolated -novalidateSchema -contextroot ${CONTEXT_ROOT} -MapModulesToServers [[ ${WAR_FILE_PATH} ${WAR_FILE_PATH},WEB-INF/web.xml WebSphere:cell=${CELL_NAME},cluster=${CLUSTER_NAME} ]] -MapSharedLibForMod [[ ${shared_libs_str} ]]')
if result != '':
    print 'Failed to install application ' + '${APP_NAME}' + '. Error: ' + result
    raise Exception('Failed to install application ' + '${APP_NAME}')

# Get the deployment descriptor
dep = AdminConfig.getid('/Deployment:${APP_NAME}/')

# Get the deployment descriptor's class loader policy
depObject = AdminConfig.showAttribute(dep, 'deployedObject')
classldr = AdminConfig.showAttribute(depObject, 'classloader')

# Set the class loader order to PARENT_LAST
AdminConfig.modify(classldr, [['mode', 'PARENT_LAST']])

# Set the WAR class loader policy to 'for each WAR file in application'
AdminConfig.modify(depObject, [['warClassLoaderPolicy', 'SINGLE']])

# Save configuration and add a delay before starting the application
AdminConfig.save()
time.sleep(60)

# Start the application on each node in the cluster
print 'Starting application ${APP_NAME}'
AdminControl.invoke('WebSphere:name=ApplicationManager,process=BPMMBR01,platform=proxy,node=antibpsapp1Node01,version=8.5.5.25,type=ApplicationManager,mbeanIdentifier=ApplicationManager,cell=${CELL_NAME},spec=1.0', 'startApplication', '${APP_NAME}')
AdminControl.invoke('WebSphere:name=ApplicationManager,process=BPMMBR02,platform=proxy,node=antibpsapp2Node01,version=8.5.5.25,type=ApplicationManager,mbeanIdentifier=ApplicationManager,cell=${CELL_NAME},spec=1.0', 'startApplication', '${APP_NAME}')
print 'Application ${APP_NAME} started.'
EOF

# Execute the script with wsadmin
$WSADMIN -lang jython -conntype SOAP -host $WAS_HOST -port $WAS_PORT -user $WAS_ADMIN_USER -password $WAS_ADMIN_PASSWORD -f $WSADMIN_SCRIPT
==================

---
- name: Copy war-install-in-was.sh to Target Server
  become: yes
  become_user: "{{ ansible_user }}"
  copy:
    src: "/ansible/GITHUB_RUNNER/actions-runner10/_work/ibps-was-ansible-cd/ibps-was-ansible-cd/war-install-in-was.sh"
    dest: "{{ Profile_home }}/release.{{ release_version }}/war-install-in-was.sh"
    mode: '0755'

- name: Run war-install-in-was.sh on Target Server
  become: yes
  become_user: "{{ ansible_user }}"
  ignore_errors: yes
  shell: "cd {{ Profile_home }}/release.{{ release_version }} && ./war-install-in-was.sh {{ WAS_HOST }} {{ WAS_PORT }} {{ WAS_ADMIN_USER }} {{ WAS_ADMIN_PASSWORD }} {{ WAR_FILE_PATH }} {{ APP_NAME }} {{ CONTEXT_ROOT }} {{ CELL_NAME }} {{ CLUSTER_NAME }} {{ WSADMIN }} {{ shared_libs }}" 
  register: deploy_result
------------------------

---
github_token: "{{ lookup('env', 'TOKEN_GITHUB') }}"
release_version: "{{ lookup('env', 'RELEASE_VERSION') }}"
#zip_file_url: "{{ lookup('env', 'ZIP_FILE_URL') }}"
#zip_file_name: "{{ zip_file_url | basename }}"
ansible_user: "itdevtra"
Profile_home: "/ibm/IBM/Application/release"

# Server details
WAR_FILE_PATH: "/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war"
APP_NAME: "KYC_Remediation_war"
CONTEXT_ROOT: "/KYC_Remediation"
WAS_HOST: "10.15.11.209"
WAS_PORT: "8879"
WAS_ADMIN_USER: "deployer"
WAS_ADMIN_PASSWORD: "deployer@123"
CELL_NAME: "antibpsapp1Cell01"
CLUSTER_NAME: "BPMCLUSTER"
WSADMIN: "/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/wsadmin.sh"
shared_libs: ["ibps_library","omnidocs_library","wfs_library"]
...

=======================

TASK [IBPS-warfileinstall : Run war-install-in-was.sh on Target Server] ********
task path: /ansible/GITHUB_RUNNER/actions-runner10/_work/ibps-was-ansible-cd/ibps-was-ansible-cd/roles/IBPS-warfileinstall/tasks/main.yml:10
<10.15.11.210> ESTABLISH SSH CONNECTION FOR USER: itdevtra
<10.15.11.210> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o Port=22 -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="itdevtra"' -o ConnectTimeout=30 -o ControlPath=/home/itdevtra/.ansible/cp/a17f7a9915 10.15.11.210 '/bin/sh -c '"'"'( umask 77 && mkdir -p "` echo /tmp `"&& mkdir /tmp/ansible-tmp-1715064702.2528074-1653016-240504202769908 && echo ansible-tmp-1715064702.2528074-1653016-240504202769908="` echo /tmp/ansible-tmp-1715064702.2528074-1653016-240504202769908 `" ) && sleep 0'"'"''
<10.15.11.210> (0, b'ansible-tmp-1715064702.2528074-1653016-240504202769908=/tmp/ansible-tmp-1715064702.2528074-1653016-240504202769908\n', b'')
Using module file /usr/lib/python3.6/site-packages/ansible/modules/commands/command.py
<10.15.11.210> PUT /home/itdevtra/.ansible/tmp/ansible-local-1652980oci0ask4/tmp925c_rco TO /tmp/ansible-tmp-1715064702.2528074-1653016-240504202769908/AnsiballZ_command.py
<10.15.11.210> SSH: EXEC sftp -b - -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o Port=22 -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="itdevtra"' -o ConnectTimeout=30 -o ControlPath=/home/itdevtra/.ansible/cp/a17f7a9915 '[10.15.11.210]'
<10.15.11.210> (0, b'sftp> put /home/itdevtra/.ansible/tmp/ansible-local-1652980oci0ask4/tmp925c_rco /tmp/ansible-tmp-1715064702.2528074-1653016-240504202769908/AnsiballZ_command.py\n', b'')
<10.15.11.210> ESTABLISH SSH CONNECTION FOR USER: itdevtra
<10.15.11.210> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o Port=22 -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="itdevtra"' -o ConnectTimeout=30 -o ControlPath=/home/itdevtra/.ansible/cp/a17f7a9915 10.15.11.210 '/bin/sh -c '"'"'chmod u+x /tmp/ansible-tmp-1715064702.2528074-1653016-240504202769908/ /tmp/ansible-tmp-1715064702.2528074-1653016-240504202769908/AnsiballZ_command.py && sleep 0'"'"''
<10.15.11.210> (0, b'', b'')
<10.15.11.210> ESTABLISH SSH CONNECTION FOR USER: itdevtra
<10.15.11.210> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o Port=22 -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="itdevtra"' -o ConnectTimeout=30 -o ControlPath=/home/itdevtra/.ansible/cp/a17f7a9915 -tt 10.15.11.210 '/bin/sh -c '"'"'/usr/bin/python /tmp/ansible-tmp-1715064702.2528074-1653016-240504202769908/AnsiballZ_command.py && sleep 0'"'"''
<10.15.11.210> (1, b'\r\n{"changed": true, "end": "2024-05-07 10:55:12.889429", "stdout": "", "cmd": "cd /ibm/IBM/Application/release/release.3.0.0.47 && ./war-install-in-was.sh 10.15.11.209 8879 deployer deployer@123 /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war KYC_Remediation_war /KYC_Remediation antibpsapp1Cell01 BPMCLUSTER /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/wsadmin.sh [\'ibps_library\', \'omnidocs_library\', \'wfs_library\']", "failed": true, "delta": "0:00:00.028033", "stderr": "./war-install-in-was.sh: line 88: 10.15.11.2090: command not found", "rc": 127, "invocation": {"module_args": {"creates": null, "executable": null, "_uses_shell": true, "strip_empty_ends": true, "_raw_params": "cd /ibm/IBM/Application/release/release.3.0.0.47 && ./war-install-in-was.sh 10.15.11.209 8879 deployer deployer@123 /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war KYC_Remediation_war /KYC_Remediation an
<10.15.11.210> Failed to connect to the host via ssh: Shared connection to 10.15.11.210 closed.
<10.15.11.210> ESTABLISH SSH CONNECTION FOR USER: itdevtra
<10.15.11.210> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o Port=22 -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="itdevtra"' -o ConnectTimeout=30 -o ControlPath=/home/itdevtra/.ansible/cp/a17f7a9915 10.15.11.210 '/bin/sh -c '"'"'rm -f -r /tmp/ansible-tmp-1715064702.2528074-1653016-240504202769908/ > /dev/null 2>&1 && sleep 0'"'"''
<10.15.11.210> (0, b'', b'')
fatal: [ANTIBPSAPP1]: FAILED! => {
    "changed": true,
    "cmd": "cd /ibm/IBM/Application/release/release.3.0.0.47 && ./war-install-in-was.sh 10.15.11.209 8879 deployer deployer@123 /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war KYC_Remediation_war /KYC_Remediation antibpsapp1Cell01 BPMCLUSTER /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/wsadmin.sh ['ibps_library', 'omnidocs_library', 'wfs_library']",
    "delta": "0:00:00.028033",
    "end": "2024-05-07 10:55:12.889429",
    "invocation": {
        "module_args": {
            "_raw_params": "cd /ibm/IBM/Application/release/release.3.0.0.47 && ./war-install-in-was.sh 10.15.11.209 8879 deployer deployer@123 /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war KYC_Remediation_war /KYC_Remediation antibpsapp1Cell01 BPMCLUSTER /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/wsadmin.sh ['ibps_library', 'omnidocs_library', 'wfs_library']",
            "_uses_shell": true,
            "argv": null,
            "chdir": null,
            "creates": null,
            "executable": null,
            "removes": null,
            "stdin": null,
            "stdin_add_newline": true,
            "strip_empty_ends": true,
            "warn": false
        }
    },
    "msg": "non-zero return code",
    "rc": 127,
    "start": "2024-05-07 10:55:12.861396",
    "stderr": "./war-install-in-was.sh: line 88: 10.15.11.2090: command not found",
    "stderr_lines": [
        "./war-install-in-was.sh: line 88: 10.15.11.2090: command not found"
    ],
    "stdout": "",
    "stdout_lines": []
}
...ignoring
META: ran handlers
META: ran handlers
==================

#!/bin/bash
 
# Server details
WAS_HOST="$1"
WAS_PORT="$2"
WAS_ADMIN_USER="$3"
WAS_ADMIN_PASSWORD="$4"
 
# WAR file and application details
WAR_FILE_PATH="$5"
APP_NAME="$6"
CONTEXT_ROOT="$7"
CELL_NAME="$8"
CLUSTER_NAME="$9"
 
# Path to wsadmin.sh
WSADMIN="$10"
 
# Define the shared libraries array
shared_libs=(${11//+/ })
 
# Create a new file for the Jython script
WSADMIN_SCRIPT="wsadmin_script.jy"
 
# Write the initial part of the Jython script to the file
cat <<EOF >$WSADMIN_SCRIPT
import time
import sys

# Check if the application is already running
if '${APP_NAME}' in AdminControl.queryNames('type=Application,*').splitlines():
    print 'Application ${APP_NAME} is already running. Stopping it...'
    app_managers = AdminControl.queryNames('type=ApplicationManager,*').splitlines()
    for app_manager in app_managers:
        AdminControl.invoke(app_manager, 'stopApplication', '${APP_NAME}', '[${CELL_NAME},${CLUSTER_NAME}]')
    print 'Application ${APP_NAME} stop command issued.'

# Wait for the application to stop
while '${APP_NAME}' in AdminControl.queryNames('type=Application,*').splitlines():
    print 'Waiting for application %s to stop...' % '${APP_NAME}'
    time.sleep(30)

print 'Application %s is not running.' % '${APP_NAME}'

# Uninstall the application if it already exists
if '${APP_NAME}' in AdminApp.list().splitlines():
    print 'Application %s already exists. Removing...' % '${APP_NAME}'
    result = AdminApp.uninstall('${APP_NAME}')
    if result != '':
        print 'Failed to uninstall application ' + '${APP_NAME}' + '. Error: ' + result
        raise Exception('Failed to uninstall application ' + '${APP_NAME}')
    else:
        AdminConfig.save()
        print 'Application %s removed.' % '${APP_NAME}'

# Install the application
shared_libs_str = '+'.join(['${APP_NAME}', 'META-INF/application.xml'] + shared_libs)
result = AdminApp.install("${WAR_FILE_PATH}", '[ -nopreCompileJSPs -distributeApp -nouseMetaDataFromBinary -nodeployejb -appname ${APP_NAME} -createMBeansForResources -noreloadEnabled -nodeployws -validateinstall warn -noprocessEmbeddedConfig -filepermission .*\.dll=755#.*\.so=755#.*\.a=755#.*\.sl=755 -noallowDispatchRemoteInclude -noallowServiceRemoteInclude -asyncRequestDispatchType DISABLED -nouseAutoLink -noenableClientModule -clientMode isolated -novalidateSchema -contextroot ${CONTEXT_ROOT} -MapModulesToServers [[ ${WAR_FILE_PATH} ${WAR_FILE_PATH},WEB-INF/web.xml WebSphere:cell=${CELL_NAME},cluster=${CLUSTER_NAME} ]] -MapSharedLibForMod [[ ${shared_libs_str} ]]')
if result != '':
    print 'Failed to install application ' + '${APP_NAME}' + '. Error: ' + result
    raise Exception('Failed to install application ' + '${APP_NAME}')

# Get the deployment descriptor
dep = AdminConfig.getid('/Deployment:${APP_NAME}/')

# Get the deployment descriptor's class loader policy
depObject = AdminConfig.showAttribute(dep, 'deployedObject')
classldr = AdminConfig.showAttribute(depObject, 'classloader')

# Set the class loader order to PARENT_LAST
AdminConfig.modify(classldr, [['mode', 'PARENT_LAST']])

# Set the WAR class loader policy to 'for each WAR file in application'
AdminConfig.modify(depObject, [['warClassLoaderPolicy', 'SINGLE']])

# Save configuration and add a delay before starting the application
AdminConfig.save()
time.sleep(60)

# Start the application on each node in the cluster
print 'Starting application ${APP_NAME}'
AdminControl.invoke('WebSphere:name=ApplicationManager,process=BPMMBR01,platform=proxy,node=antibpsapp1Node01,version=8.5.5.25,type=ApplicationManager,mbeanIdentifier=ApplicationManager,cell=${CELL_NAME},spec=1.0', 'startApplication', '${APP_NAME}')
AdminControl.invoke('WebSphere:name=ApplicationManager,process=BPMMBR02,platform=proxy,node=antibpsapp2Node01,version=8.5.5.25,type=ApplicationManager,mbeanIdentifier=ApplicationManager,cell=${CELL_NAME},spec=1.0', 'startApplication', '${APP_NAME}')
print 'Application ${APP_NAME} started.'
EOF

# Execute the script with wsadmin
$WSADMIN -lang jython -conntype SOAP -host $WAS_HOST -port $WAS_PORT -user $WAS_ADMIN_USER -password $WAS_ADMIN_PASSWORD -f $WSADMIN_SCRIPT
