name: IBPS-warfileinstall
run-name: IBPS-warfileinstall-${{ github.event.inputs.release_version }}
on:
  workflow_dispatch:
    inputs:
      release_version:
        description: 'Release version to deploy'
        required: true 
        type: string

jobs:
  deploy:
    runs-on:
     group: rakbank-self-hosted-runner
     labels: dehitdevtra1

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Debug Working Directory
      run: |
        ls -al
        pwd
    - name: Make war-install-in-was.sh executable
      run: |
        chmod +x war-install-in-was.sh
  
    - name: Run Ansible Playbook
      env:
        TOKEN_GITHUB: ${{ secrets.TOKEN_GITHUB }}
        RELEASE_VERSION: ${{ github.event.inputs.release_version }}
      run: |
        cd ${{ github.workspace }}
        ansible-playbook -vvv -b --extra-vars "target=target_wasuat209 destination=${{ github.workspace }} release_version=${RELEASE_VERSION}" ./playbook/IBPS-warfileinstall.yml #Cluster ip:10.15.11.209
        #ansible-playbook -vvv -b --extra-vars "target=target_wasuat210 destination=${{ github.workspace }} release_version=${RELEASE_VERSION}" ./playbook/IBPS-warfileinstall.yml #Cluster ip:10.15.11.210
        #ansible-playbook -vvv -b --extra-vars "target=target_wasreplica86 destination=${{ github.workspace }} release_version=${RELEASE_VERSION}" ./playbook/IBPS-warfileinstall.yml #replica ip:10.15.24.86

================

---
github_token: "{{ lookup('env', 'TOKEN_GITHUB') }}"
release_version: "{{ lookup('env', 'RELEASE_VERSION') }}"
ansible_user: "itdevtra"
Profile_home: "/ibm/IBM/Application/release"

# Server details
WAR_FILE_PATH: "/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war"
WAR_FILE_NAME: "KYC_Remediation.war"
APP_NAME: "KYC_Remediation_war"
CONTEXT_ROOT: "/KYC_Remediation"
WAS_HOST: "10.15.11.209"
WAS_PORT: "8879"
WAS_ADMIN_USER: "deployer"
WAS_ADMIN_PASSWORD: "deployer@123"
CELL_NAME: "antibpsapp1Cell01"
CLUSTER_NAME: "BPMCLUSTER"
WSADMIN: "/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/wsadmin.sh"
...
