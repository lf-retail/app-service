I have completed the IBPS deployment on below UAT2 cluster servers. This involved downloading the release artifact from Github Releases and copying it onto the targeted servers from the Runner machine. Additionally, I ensured that the application files within the release artifact were copied to their respective locations as specified in the release.txt file.

Here are the details for the two servers:

Application: ANTIBPSAPP1
IP: 10.15.11.209

Application: ANTIBPSAPP2
IP: 10.15.11.210

Additionally, Today had a discussion with Devdutta Singh, Anisur Rahman Abdul Kalam Shaikh, and Hritik Kounsal regarding the installation of WAR files in WAS,. We discussed the necessary steps to follow if there are any WAR files within the release artifact. I'm scheduled to commence this work on Monday.

Please feel free to reach out if there are any additional requirements or if I've overlooked anything.
======================

Could you please share the test environment details needed to test the script for installing WAR files in WAS?
============

#!/bin/bash

# Server details (replace with your actual values)
WAS_HOST="localhost"
WAS_PORT="8080"
WAS_ADMIN_USER="admin"
WAS_ADMIN_PASSWORD="password"

# WAR file path (replace with your actual path)
WAR_FILE_PATH="/path/to/your/war.war"

# Application name (replace with your desired name)
APP_NAME="your_application_name"

# Context Root (replace with your desired context root)
CONTEXT_ROOT="your_app_context_root"

# Connect to WebSphere administration console
AdminConfig.connect("$WAS_HOST:$WAS_PORT", "-user $WAS_ADMIN_USER", "-password $WAS_ADMIN_PASSWORD")

# Check if application already exists
if [ $(AdminConfig.isAppAvailable "$APP_NAME") = "true" ]
then
  echo "Application $APP_NAME already exists. Skipping installation."
else
  # Install the application with detailed options
  AdminApp.installApplication("$WAR_FILE_PATH", "$APP_NAME", "-detailed")

  # Map shared libraries (replace 'your_shared_library' with actual library name)
  AdminConfig.assignSharedLibraryToApp("$APP_NAME", "your_shared_library")

  # Set context root
  AdminConfig.setContextRootForWebModule("[$APP_NAME 0]", "$CONTEXT_ROOT")

  # Save configuration changes
  AdminConfig.save()
fi

# Disconnect from WebSphere administration console
AdminConfig.disconnect()

echo "WAR deployment script complete."
==================

#!/bin/bash

# Server details (adapt these variables to your environment)
WAS_HOST="localhost"
WAS_PORT="9043" # Change to your WAS administrative port, often 9043 for HTTPS
WAS_ADMIN_USER="admin"
WAS_ADMIN_PASSWORD="password"

# WAR file and application details
WAR_FILE_PATH="/path/to/your/war.war"
APP_NAME="your_application_name"
CONTEXT_ROOT="your_app_context_root"
SHARED_LIB="your_shared_library"

# Path to wsadmin.sh (adjust for your WAS installation)
WSADMIN="/path/to/WebSphere/AppServer/profiles/YourProfile/bin/wsadmin.sh"

# wsadmin script content
WSADMIN_SCRIPT="
# Connect to WebSphere Application Server
AdminConfig.connect('$WAS_ADMIN_USER', '$WAS_ADMIN_PASSWORD')

# Check if the application already exists
if AdminApp.list().find('$APP_NAME') != -1:
    print('Application $APP_NAME already exists. Skipping installation.')
else:
    # Install the application
    AdminApp.install('$WAR_FILE_PATH', '[ -appname $APP_NAME -contextroot $CONTEXT_ROOT -MapWebModToVH [[ .* .* default_host ]] ]')
    # Map shared libraries (Optional: Adjust or remove according to your requirements)
    AdminConfig.create('LibraryRef', AdminConfig.getid('/Deployment:$APP_NAME/'), '[[libraryName $SHARED_LIB]]')
    # Save configuration changes
    AdminConfig.save()

# Disconnect from the server
AdminConfig.disconnect()
"

# Execute the script with wsadmin
echo "Deploying $APP_NAME from WAR file: $WAR_FILE_PATH"
echo "$WSADMIN_SCRIPT" | $WSADMIN -lang jython -conntype SOAP -host $WAS_HOST -port $WAS_PORT -user $WAS_ADMIN_USER -password $WAS_ADMIN_PASSWORD

if [ $? -eq 0 ]; then
    echo "Deployment of $APP_NAME completed successfully."
else
    echo "Deployment failed. Check the output for errors."
    exit 1
fi
=============

Jython Language: The script within WSADMIN_SCRIPT uses Jython syntax. Ensure that your wsadmin tool is configured to use Jython (-lang jython). Most modern WebSphere versions support this by default, but it's good to confirm.

Could you please confirm if the wsadmin tool is configured to use Jython (-lang jython)?

As we discussed please share the steps for what you are required then I can take it further steps

As we discussed, please share the steps you require so that I can proceed with further actions.
==============

#!/bin/bash

# Server details (adapt these variables to your environment)
WAS_HOST="10.15.11.209"
WAS_PORT="9043" # Change to your WAS administrative port, often 9043 for HTTPS
WAS_ADMIN_USER="deployer"
WAS_ADMIN_PASSWORD="deployer@123"

# WAR file and application details
WAR_FILE_PATH="/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war"
APP_NAME="KYC_Remediation"
CONTEXT_ROOT="KYC_Remediation"
SHARED_LIB="ibps_library,omnidocs_library,wfs_library,od_library"

# Path to wsadmin.sh (adjust for your WAS installation)
WSADMIN="/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/wsadmin.sh"

# wsadmin script content
WSADMIN_SCRIPT="
# Connect to WebSphere Application Server
AdminConfig.connect('$WAS_ADMIN_USER', '$WAS_ADMIN_PASSWORD')

# Check if the application already exists
if AdminApp.list().find('$APP_NAME') != -1:
    print('Application $APP_NAME already exists. Skipping installation.')
else:
    # Install the application
    AdminApp.install('$WAR_FILE_PATH', '[ -appname $APP_NAME -contextroot $CONTEXT_ROOT -MapWebModToVH [[ .* .* default_host ]] ]')
    # Map shared libraries (Optional: Adjust or remove according to your requirements)
    AdminConfig.create('LibraryRef', AdminConfig.getid('/Deployment:$APP_NAME/'), '[[libraryName $SHARED_LIB]]')
    # Save configuration changes
    AdminConfig.save()

# Disconnect from the server
AdminConfig.disconnect()
"

# Execute the script with wsadmin
echo "Deploying $APP_NAME from WAR file: $WAR_FILE_PATH"
echo "$WSADMIN_SCRIPT" | $WSADMIN -lang jython -conntype SOAP -host $WAS_HOST -port $WAS_PORT -user $WAS_ADMIN_USER -password $WAS_ADMIN_PASSWORD

if [ $? -eq 0 ]; then
    echo "Deployment of $APP_NAME completed successfully."
else
    echo "Deployment failed. Check the output for errors."
    exit 1
fi

============================

---
- name: Stop WAS
  become: true 
  become_user: itdevtra
  command: "/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/stopServer.sh BPMMBR01 --connect controller=0.15.11.209 command=:shutdown"
  command: "/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/stopNode.sh --connect controller=0.15.11.209 command=:shutdown"
  ignore_errors: yes

- name: Copy war-install-in-was1.sh to Target Server
  copy:
    src: "/ansible/GITHUB_RUNNER/actions-runner10/_work/ibps-was-ansible-cd/ibps-was-ansible-cd/war-install-in-was1.sh"
    dest: "{{ Profile_home }}/release.{{ release_version }}/war-install-in-was1.sh"
    mode: '0755'
  become: yes
  become_user: "{{ ansible_user }}"

- name: Run war-install-in-was1.sh on Target Server
  become: yes
  become_user: "{{ ansible_user }}"
  shell: "cd {{ Profile_home }}/release.{{ release_version }} && ./war-install-in-was1.sh {{ Profile_home }} {{ release_version }}"
  register: deploy_result
  ignore_errors: yes

- name: Start WAS 
  become: true 
  become_user: itdevtra
  command: /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/startNode.sh
  command: /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/startServer.sh BPMMBR01
  
==============
---
- name: Stop WAS
  become: true
  become_user: itdevtra
  ignore_errors: yes
  shell:
    cmd: |
      /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/stopServer.sh BPMMBR01 --connect controller=0.15.11.209 command=:shutdown &&
      /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/stopNode.sh --connect controller=0.15.11.209 command=:shutdown

- name: Copy war-install-in-was1.sh to Target Server
  become: yes
  become_user: "{{ ansible_user }}"
  copy:
    src: "/ansible/GITHUB_RUNNER/actions-runner10/_work/ibps-was-ansible-cd/ibps-was-ansible-cd/war-install-in-was1.sh"
    dest: "{{ Profile_home }}/release.{{ release_version }}/war-install-in-was1.sh"
    mode: '0755'

- name: Run war-install-in-was1.sh on Target Server
  become: yes
  become_user: "{{ ansible_user }}"
  ignore_errors: yes
  shell: "cd {{ Profile_home }}/release.{{ release_version }} && ./war-install-in-was1.sh {{ Profile_home }} {{ release_version }}"
  register: deploy_result

- name: Start WAS
  become: true
  become_user: itdevtra
  shell:
    cmd: |
      /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/startNode.sh &&
      /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/startServer.sh BPMMBR01
================

#!/bin/bash

# Server details (adapt these variables to your environment)
WAS_HOST="10.15.11.209"
WAS_PORT="9043" # Change to your WAS administrative port, often 9043 for HTTPS
WAS_ADMIN_USER="deployer"
WAS_ADMIN_PASSWORD="deployer@123"

# WAR file and application details
WAR_FILE_PATH="/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war"
APP_NAME="KYC_Remediation"
CONTEXT_ROOT="KYC_Remediation"
SHARED_LIB="ibps_library,omnidocs_library,wfs_library,od_library"

# Path to wsadmin.sh (adjust for your WAS installation)
WSADMIN="/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/wsadmin.sh"

# wsadmin script content
WSADMIN_SCRIPT="
# Connect to WebSphere Application Server
AdminConfig.connect('$WAS_ADMIN_USER', '$WAS_ADMIN_PASSWORD')

# Check if the application already exists
if AdminApp.list().find('$APP_NAME') != -1:
    print('Application $APP_NAME already exists. Skipping installation.')
else:
    # Install the application
    AdminApp.install('$WAR_FILE_PATH', '[ -appname $APP_NAME -contextroot $CONTEXT_ROOT -MapWebModToVH [[ .* .* default_host ]] ]')
    # Map shared libraries (Optional: Adjust or remove according to your requirements)
    AdminConfig.create('LibraryRef', AdminConfig.getid('/Deployment:$APP_NAME/'), '[[libraryName $SHARED_LIB]]')
    # Save configuration changes
    AdminConfig.save()

# Disconnect from the server
AdminConfig.disconnect()
"

# Execute the script with wsadmin
echo "Deploying $APP_NAME from WAR file: $WAR_FILE_PATH"
echo "$WSADMIN_SCRIPT" | $WSADMIN -lang jython -conntype SOAP -host $WAS_HOST -port $WAS_PORT -user $WAS_ADMIN_USER -password $WAS_ADMIN_PASSWORD

if [ $? -eq 0 ]; then
    echo "Deployment of $APP_NAME completed successfully."
else
    echo "Deployment failed. Check the output for errors."
    exit 1
fi
==============

#!/bin/bash

# Server details (adapt these variables to your environment)
WAS_HOST="10.15.11.209"
WAS_PORT="9043" # Change to your WAS administrative port, often 9043 for HTTPS
WAS_ADMIN_USER="deployer"
WAS_ADMIN_PASSWORD="deployer@123"

# WAR file and application details
WAR_FILE_PATH="/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war"
APP_NAME="KYC_Remediation"
CONTEXT_ROOT="KYC_Remediation"
SHARED_LIB="$1" # Accept shared libraries as arguments

# Path to wsadmin.sh (adjust for your WAS installation)
WSADMIN="/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/wsadmin.sh"

# wsadmin script content
WSADMIN_SCRIPT="
# Connect to WebSphere Application Server
AdminConfig.connect('$WAS_ADMIN_USER', '$WAS_ADMIN_PASSWORD')

# Check if the application already exists
if AdminApp.list().find('$APP_NAME') != -1:
    print('Application $APP_NAME already exists. Skipping installation.')
else:
    # Install the application
    AdminApp.install('$WAR_FILE_PATH', '[ -appname $APP_NAME -contextroot $CONTEXT_ROOT -MapWebModToVH [[ .* .* default_host ]] ]')
    # Map shared libraries
    for lib in $SHARED_LIB; do
        AdminConfig.create('LibraryRef', AdminConfig.getid('/Deployment:$APP_NAME/'), '[[libraryName $lib]]')
    done
    # Save configuration changes
    AdminConfig.save()

# Disconnect from the server
AdminConfig.disconnect()
"

# Check if shared libraries were provided
if [ -z "$SHARED_LIB" ]; then
    echo "No shared libraries provided. Deployment failed."
    exit 1
fi

# Execute the script with wsadmin
echo "Deploying $APP_NAME from WAR file: $WAR_FILE_PATH"
echo "$WSADMIN_SCRIPT" | $WSADMIN -lang jython -conntype SOAP -host $WAS_HOST -port $WAS_PORT -user $WAS_ADMIN_USER -password $WAS_ADMIN_PASSWORD

if [ $? -eq 0 ]; then
    echo "Deployment of $APP_NAME completed successfully."
else
    echo "Deployment failed. Check the output for errors."
    exit 1
fi

./your_script.sh ibps_library omnidocs_library wfs_library od_library
=============
#!/bin/bash

# Server details (adapt these variables to your environment)
WAS_HOST="10.15.11.209"
WAS_PORT="9043" # Change to your WAS administrative port, often 9043 for HTTPS
WAS_ADMIN_USER="deployer"
WAS_ADMIN_PASSWORD="deployer@123"

# WAR file and application details
WAR_FILE_PATH="/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war"
APP_NAME="KYC_Remediation"
CONTEXT_ROOT="KYC_Remediation"

# Combine all shared libraries into a single string
SHARED_LIB=$(printf ",%s" "$@")
SHARED_LIB=${SHARED_LIB:1} # Remove the leading comma

# Path to wsadmin.sh (adjust for your WAS installation)
WSADMIN="/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/wsadmin.sh"

# wsadmin script content
WSADMIN_SCRIPT="
# Connect to WebSphere Application Server
AdminConfig.connect('$WAS_ADMIN_USER', '$WAS_ADMIN_PASSWORD')

# Check if the application already exists
if AdminApp.list().find('$APP_NAME') != -1:
    print('Application $APP_NAME already exists. Skipping installation.')
else:
    # Install the application
    AdminApp.install('$WAR_FILE_PATH', '[ -appname $APP_NAME -contextroot $CONTEXT_ROOT -MapWebModToVH [[ .* .* default_host ]] ]')
    # Map shared libraries (Optional: Adjust or remove according to your requirements)
    AdminConfig.create('LibraryRef', AdminConfig.getid('/Deployment:$APP_NAME/'), '[[libraryName $SHARED_LIB]]')
    # Save configuration changes
    AdminConfig.save()

# Disconnect from the server
AdminConfig.disconnect()
"

# Check if shared libraries were provided
if [ -z "$SHARED_LIB" ]; then
    echo "No shared libraries provided. Deployment failed."
    exit 1
fi

# Execute the script with wsadmin
echo "Deploying $APP_NAME from WAR file: $WAR_FILE_PATH"
echo "$WSADMIN_SCRIPT" | $WSADMIN -lang jython -conntype SOAP -host $WAS_HOST -port $WAS_PORT -user $WAS_ADMIN_USER -password $WAS_ADMIN_PASSWORD

if [ $? -eq 0 ]; then
    echo "Deployment of $APP_NAME completed successfully."
else
    echo "Deployment failed. Check the output for errors."
    exit 1
fi
=====================

---
- name: Stop WAS
  become: true
  become_user: "{{ ansible_user }}"
  ignore_errors: yes
  shell:
    cmd: |
      /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/stopServer.sh BPMMBR01 --connect controller=10.15.11.209 command=:shutdown &&
      /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/stopNode.sh --connect controller=10.15.11.209 command=:shutdown

- name: Copy war-install-in-was1.sh to Target Server
  become: yes
  become_user: "{{ ansible_user }}"
  copy:
    src: "/ansible/GITHUB_RUNNER/actions-runner10/_work/ibps-was-ansible-cd/ibps-was-ansible-cd/war-install-in-was1.sh"
    dest: "{{ Profile_home }}/release.{{ release_version }}/war-install-in-was1.sh"
    mode: '0755'

- name: Run war-install-in-was1.sh on Target Server
  become: yes
  become_user: "{{ ansible_user }}"
  ignore_errors: yes
  shell: "cd {{ Profile_home }}/release.{{ release_version }} && ./war-install-in-was1.sh ibps_library omnidocs_library wfs_library od_library"
  register: deploy_result

- name: Start WAS
  become: true
  become_user: "{{ ansible_user }}"
  shell:
    cmd: |
      /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/startNode.sh &&
      /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/startServer.sh BPMMBR01
=================

We have a scheduled meeting for this at 11:00 AM Dubai time. We can discuss it over the call


I am going to run the script on target machine from source server but I want to conform any permission required for the below path if there is no permission could you please give access for that

I am planning to execute the script on the target machine from the source server. However, I need to confirm whether any permissions are required for the following path. If there are no permissions granted, could you please provide access?

3.	Make the WAR as Parent Last
=============

#!/bin/bash

# Server details (adapt these variables to your environment)
WAS_HOST="10.15.11.209"
WAS_PORT="9043" # Change to your WAS administrative port, often 9043 for HTTPS
WAS_ADMIN_USER="deployer"
WAS_ADMIN_PASSWORD="deployer@123"

# WAR file and application details
WAR_FILE_PATH="/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war"
APP_NAME="KYC_Remediation"
CONTEXT_ROOT="KYC_Remediation"

# Combine all shared libraries into a single string
SHARED_LIB=$(printf ",%s" "$@")
SHARED_LIB=${SHARED_LIB:1} # Remove the leading comma

# Path to wsadmin.sh (adjust for your WAS installation)
WSADMIN="/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/wsadmin.sh"

# wsadmin script content
WSADMIN_SCRIPT="
# Connect to WebSphere Application Server
AdminConfig.connect('$WAS_ADMIN_USER', '$WAS_ADMIN_PASSWORD')

# Check if the application already exists
if AdminApp.list().find('$APP_NAME') != -1:
    print('Application $APP_NAME already exists. Skipping installation.')
else:
    # Install the application with Parent Last class loader policy
    AdminApp.install('$WAR_FILE_PATH', '[ -appname $APP_NAME -contextroot $CONTEXT_ROOT -MapModulesToServers [[ .* .* WebSphere:cell=YourCellName,node=YourNodeName,server=YourServerName ]] -MapWebModToVH [[ .* .* default_host ]] -classloaderMode PARENT_LAST ]')
    # Map shared libraries (Optional: Adjust or remove according to your requirements)
    AdminConfig.create('LibraryRef', AdminConfig.getid('/Deployment:$APP_NAME/'), '[[libraryName $SHARED_LIB]]')
    # Save configuration changes
    AdminConfig.save()

# Disconnect from the server
AdminConfig.disconnect()
"

# Check if shared libraries were provided
if [ -z "$SHARED_LIB" ]; then
    echo "No shared libraries provided. Deployment failed."
    exit 1
fi

# Execute the script with wsadmin
echo "Deploying $APP_NAME from WAR file: $WAR_FILE_PATH"
echo "$WSADMIN_SCRIPT" | $WSADMIN -lang jython -conntype SOAP -host $WAS_HOST -port $WAS_PORT -user $WAS_ADMIN_USER -password $WAS_ADMIN_PASSWORD

if [ $? -eq 0 ]; then
    echo "Deployment of $APP_NAME completed successfully."
else
    echo "Deployment failed. Check the output for errors."
    exit 1
fi
============

1.	Install the WAR
2.	Map the Lib
3.	Make the WAR as Parent Last
4.	Start the WAR File .
==============

TASK [IBPS-deployment : Include rollback playbook] *****************************
task path: /ansible/GITHUB_RUNNER/actions-runner10/_work/ibps-was-ansible-cd/ibps-was-ansible-cd/roles/IBPS-deployment/tasks/main.yml:9
included: /ansible/GITHUB_RUNNER/actions-runner10/_work/ibps-was-ansible-cd/ibps-was-ansible-cd/roles/IBPS-deployment/tasks/main-war-installation.yml for ANTIBPSAPP1
TASK [IBPS-deployment : Stop WAS] **********************************************
task path: /ansible/GITHUB_RUNNER/actions-runner10/_work/ibps-was-ansible-cd/ibps-was-ansible-cd/roles/IBPS-deployment/tasks/main-war-installation.yml:2
<10.15.11.209> ESTABLISH SSH CONNECTION FOR USER: itdevtra
<10.15.11.209> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o Port=22 -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="itdevtra"' -o ConnectTimeout=30 -o ControlPath=/home/itdevtra/.ansible/cp/9d82de7b55 10.15.11.209 '/bin/sh -c '"'"'( umask 77 && mkdir -p "` echo /tmp `"&& mkdir /tmp/ansible-tmp-1711718581.0367749-2813593-88567109022318 && echo ansible-tmp-1711718581.0367749-2813593-88567109022318="` echo /tmp/ansible-tmp-1711718581.0367749-2813593-88567109022318 `" ) && sleep 0'"'"''
<10.15.11.209> (0, b'ansible-tmp-1711718581.0367749-2813593-88567109022318=/tmp/ansible-tmp-1711718581.0367749-2813593-88567109022318\n', b'')
Using module file /usr/lib/python3.6/site-packages/ansible/modules/commands/command.py
<10.15.11.209> PUT /home/itdevtra/.ansible/tmp/ansible-local-28135698gmit7ao/tmpu9su7axr TO /tmp/ansible-tmp-1711718581.0367749-2813593-88567109022318/AnsiballZ_command.py
<10.15.11.209> SSH: EXEC sftp -b - -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o Port=22 -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="itdevtra"' -o ConnectTimeout=30 -o ControlPath=/home/itdevtra/.ansible/cp/9d82de7b55 '[10.15.11.209]'
<10.15.11.209> (0, b'sftp> put /home/itdevtra/.ansible/tmp/ansible-local-28135698gmit7ao/tmpu9su7axr /tmp/ansible-tmp-1711718581.0367749-2813593-88567109022318/AnsiballZ_command.py\n', b'')
<10.15.11.209> ESTABLISH SSH CONNECTION FOR USER: itdevtra
<10.15.11.209> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o Port=22 -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="itdevtra"' -o ConnectTimeout=30 -o ControlPath=/home/itdevtra/.ansible/cp/9d82de7b55 10.15.11.209 '/bin/sh -c '"'"'chmod u+x /tmp/ansible-tmp-1711718581.0367749-2813593-88567109022318/ /tmp/ansible-tmp-1711718581.0367749-2813593-88567109022318/AnsiballZ_command.py && sleep 0'"'"''
<10.15.11.209> (0, b'', b'')
<10.15.11.209> ESTABLISH SSH CONNECTION FOR USER: itdevtra
<10.15.11.209> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o Port=22 -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="itdevtra"' -o ConnectTimeout=30 -o ControlPath=/home/itdevtra/.ansible/cp/9d82de7b55 -tt 10.15.11.209 '/bin/sh -c '"'"'/usr/bin/python /tmp/ansible-tmp-1711718581.0367749-2813593-88567109022318/AnsiballZ_command.py && sleep 0'"'"''
<10.15.11.209> (1, b'\r\n{"changed": true, "end": "2024-03-29 17:25:33.597067", "stdout": "", "cmd": "/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/stopServer.sh BPMMBR01 --connect controller=10.15.11.209 command=:shutdown &&\\n/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/stopNode.sh --connect controller=10.15.11.209 command=:shutdown\\n", "failed": true, "delta": "0:00:00.691620", "stderr": "!SESSION 2024-03-29 17:25:33.147 -----------------------------------------------\\neclipse.buildId=M20060921-0945\\njava.fullversion=8.0.8.15 - pxa6480sr8fp15-20231030_01(SR8 FP15)\\nJRE 1.8.0 Linux amd64-64-Bit Compressed References 20230908_57744 (JIT enabled, AOT enabled)\\nOpenJ9   - ec90c19\\nOMR      - 8b64d40\\nIBM      - 696e9df\\nBootLoader constants: OS=linux, ARCH=x86_64, WS=gtk, NL=en_US\\nFramework arguments:  -application com.ibm.ws.bootstrap.WSLauncher\\nCommand-line arguments:  -application com.ibm.ws.bootstrap.WSLauncher\\n\\n!ENTRY org.eclipse.osgi 4 0 2024-03-29 17:25:33.585\\n!MESSAGE Error
<10.15.11.209> Failed to connect to the host via ssh: Shared connection to 10.15.11.209 closed.
<10.15.11.209> ESTABLISH SSH CONNECTION FOR USER: itdevtra
<10.15.11.209> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o Port=22 -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="itdevtra"' -o ConnectTimeout=30 -o ControlPath=/home/itdevtra/.ansible/cp/9d82de7b55 10.15.11.209 '/bin/sh -c '"'"'rm -f -r /tmp/ansible-tmp-1711718581.0367749-2813593-88567109022318/ > /dev/null 2>&1 && sleep 0'"'"''
<10.15.11.209> (0, b'', b'')
fatal: [ANTIBPSAPP1]: FAILED! => {
    "changed": true,
    "cmd": "/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/stopServer.sh BPMMBR01 --connect controller=10.15.11.209 command=:shutdown &&\n/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/stopNode.sh --connect controller=10.15.11.209 command=:shutdown\n",
    "delta": "0:00:00.691620",
    "end": "2024-03-29 17:25:33.597067",
    "invocation": {
        "module_args": {
            "_raw_params": "/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/stopServer.sh BPMMBR01 --connect controller=10.15.11.209 command=:shutdown &&\n/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/stopNode.sh --connect controller=10.15.11.209 command=:shutdown\n",
            "_uses_shell": true,
            "argv": null,
            "chdir": null,
            "creates": null,
            "executable": null,
            "removes": null,
            "stdin": null,
            "stdin_add_newline": true,
            "strip_empty_ends": true,
            "warn": false
        }
    },
    "msg": "non-zero return code",
    "rc": 15,
    "start": "2024-03-29 17:25:32.905447",
    "stderr": "!SESSION 2024-03-29 17:25:33.147 -----------------------------------------------\neclipse.buildId=M20060921-0945\njava.fullversion=8.0.8.15 - pxa6480sr8fp15-20231030_01(SR8 FP15)\nJRE 1.8.0 Linux amd64-64-Bit Compressed References 20230908_57744 (JIT enabled, AOT enabled)\nOpenJ9   - ec90c19\nOMR      - 8b64d40\nIBM      - 696e9df\nBootLoader constants: OS=linux, ARCH=x86_64, WS=gtk, NL=en_US\nFramework arguments:  -application com.ibm.ws.bootstrap.WSLauncher\nCommand-line arguments:  -application com.ibm.ws.bootstrap.WSLauncher\n\n!ENTRY org.eclipse.osgi 4 0 2024-03-29 17:25:33.585\n!MESSAGE Error reading configuration: /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/configuration/org.eclipse.osgi/.manager/.fileTableLock (Permission denied)\n!STACK 0\njava.io.FileNotFoundException: /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/configuration/org.eclipse.osgi/.manager/.fileTableLock (Permission denied)\n\tat java.io.RandomAccessFile.open0(Native Method)\n\tat java.io.RandomAccessFile.open(Random
    "stderr_lines": [
        "!SESSION 2024-03-29 17:25:33.147 -----------------------------------------------",
        "eclipse.buildId=M20060921-0945",
        "java.fullversion=8.0.8.15 - pxa6480sr8fp15-20231030_01(SR8 FP15)",
        "JRE 1.8.0 Linux amd64-64-Bit Compressed References 20230908_57744 (JIT enabled, AOT enabled)",
        "OpenJ9   - ec90c19",
        "OMR      - 8b64d40",
        "IBM      - 696e9df",
        "BootLoader constants: OS=linux, ARCH=x86_64, WS=gtk, NL=en_US",
        "Framework arguments:  -application com.ibm.ws.bootstrap.WSLauncher",
        "Command-line arguments:  -application com.ibm.ws.bootstrap.WSLauncher",
        "",
        "!ENTRY org.eclipse.osgi 4 0 2024-03-29 17:25:33.585",
        "!MESSAGE Error reading configuration: /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/configuration/org.eclipse.osgi/.manager/.fileTableLock (Permission denied)",
        "!STACK 0",
        "java.io.FileNotFoundException: /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/configuration/org.eclipse.osgi/.manager/.fileTableLock (Permission denied)",
        "\tat java.io.RandomAccessFile.open0(Native Method)",
        "\tat java.io.RandomAccessFile.open(RandomAccessFile.java:333)",
        "\tat java.io.RandomAccessFile.<init>(RandomAccessFile.java:257)",
        "\tat org.eclipse.core.runtime.internal.adaptor.Locker_JavaNio.lock(Locker_JavaNio.java:33)",
        "\tat org.eclipse.osgi.storagemanager.StorageManager.lock(StorageManager.java:388)",
        "\tat org.eclipse.osgi.storagemanager.StorageManager.open(StorageManager.java:701)",
        "\tat org.eclipse.osgi.internal.baseadaptor.BaseStorage.initFileManager(BaseStorage.java:213)",
        "\tat org.eclipse.osgi.internal.baseadaptor.BaseStorage.initialize(BaseStorage.java:147)",
        "\tat org.eclipse.osgi.baseadaptor.BaseAdaptor.initializeStorage(BaseAdaptor.java:114)",
        "\tat org.eclipse.osgi.framework.internal.core.Framework.initialize(Framework.java:186)",
        "\tat org.eclipse.osgi.framework.internal.core.Framework.<init>(Framework.java:158)",
        "\tat org.eclipse.core.runtime.adaptor.EclipseStarter.startup(EclipseStarter.java:286)",
        "\tat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:175)",
        "\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)",
        "\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:90)",
        "\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:55)",
        "\tat java.lang.reflect.Method.invoke(Method.java:508)",
        "\tat org.eclipse.core.launcher.Main.invokeFramework(Main.java:340)",
        "\tat org.eclipse.core.launcher.Main.basicRun(Main.java:282)",
        "\tat org.eclipse.core.launcher.Main.run(Main.java:981)",
        "\tat com.ibm.wsspi.bootstrap.WSPreLauncher.launchEclipse(WSPreLauncher.java:425)",
        "\tat com.ibm.wsspi.bootstrap.WSPreLauncher.main(WSPreLauncher.java:178)"
    ],
    "stdout": "",
    "stdout_lines": []
}
...ignoring
============

TASK [IBPS-deployment : Run war-install-in-was1.sh on Target Server] ***********
task path: /ansible/GITHUB_RUNNER/actions-runner10/_work/ibps-was-ansible-cd/ibps-was-ansible-cd/roles/IBPS-deployment/tasks/main-war-installation.yml:25
<10.15.11.209> ESTABLISH SSH CONNECTION FOR USER: itdevtra
<10.15.11.209> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o Port=22 -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="itdevtra"' -o ConnectTimeout=30 -o ControlPath=/home/itdevtra/.ansible/cp/9d82de7b55 10.15.11.209 '/bin/sh -c '"'"'( umask 77 && mkdir -p "` echo /tmp `"&& mkdir /tmp/ansible-tmp-1711718583.8387764-2813695-99872535440489 && echo ansible-tmp-1711718583.8387764-2813695-99872535440489="` echo /tmp/ansible-tmp-1711718583.8387764-2813695-99872535440489 `" ) && sleep 0'"'"''
<10.15.11.209> (0, b'ansible-tmp-1711718583.8387764-2813695-99872535440489=/tmp/ansible-tmp-1711718583.8387764-2813695-99872535440489\n', b'')
Using module file /usr/lib/python3.6/site-packages/ansible/modules/commands/command.py
<10.15.11.209> PUT /home/itdevtra/.ansible/tmp/ansible-local-28135698gmit7ao/tmpud2y9opl TO /tmp/ansible-tmp-1711718583.8387764-2813695-99872535440489/AnsiballZ_command.py
<10.15.11.209> SSH: EXEC sftp -b - -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o Port=22 -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="itdevtra"' -o ConnectTimeout=30 -o ControlPath=/home/itdevtra/.ansible/cp/9d82de7b55 '[10.15.11.209]'
<10.15.11.209> (0, b'sftp> put /home/itdevtra/.ansible/tmp/ansible-local-28135698gmit7ao/tmpud2y9opl /tmp/ansible-tmp-1711718583.8387764-2813695-99872535440489/AnsiballZ_command.py\n', b'')
<10.15.11.209> ESTABLISH SSH CONNECTION FOR USER: itdevtra
<10.15.11.209> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o Port=22 -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="itdevtra"' -o ConnectTimeout=30 -o ControlPath=/home/itdevtra/.ansible/cp/9d82de7b55 10.15.11.209 '/bin/sh -c '"'"'chmod u+x /tmp/ansible-tmp-1711718583.8387764-2813695-99872535440489/ /tmp/ansible-tmp-1711718583.8387764-2813695-99872535440489/AnsiballZ_command.py && sleep 0'"'"''
<10.15.11.209> (0, b'', b'')
        "\tat org.eclipse.core.runtime.internal.adaptor.Locker_JavaNio.lock(Locker_JavaNio.java:33)",
        "\tat org.eclipse.osgi.storagemanager.StorageManager.lock(StorageManager.java:388)",
        "\tat org.eclipse.osgi.storagemanager.StorageManager.open(StorageManager.java:701)",
        "\tat org.eclipse.osgi.internal.baseadaptor.BaseStorage.initFileManager(BaseStorage.java:213)",
        "\tat org.eclipse.osgi.internal.baseadaptor.BaseStorage.initialize(BaseStorage.java:147)",
        "\tat org.eclipse.osgi.baseadaptor.BaseAdaptor.initializeStorage(BaseAdaptor.java:114)",
        "\tat org.eclipse.osgi.framework.internal.core.Framework.initialize(Framework.java:186)",
        "\tat org.eclipse.osgi.framework.internal.core.Framework.<init>(Framework.java:158)",
        "\tat org.eclipse.core.runtime.adaptor.EclipseStarter.startup(EclipseStarter.java:286)",
        "\tat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:175)",
        "\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)",
        "\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:90)",
        "\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:55)",
        "\tat java.lang.reflect.Method.invoke(Method.java:508)",
        "\tat org.eclipse.core.launcher.Main.invokeFramework(Main.java:340)",
        "\tat org.eclipse.core.launcher.Main.basicRun(Main.java:282)",
        "\tat org.eclipse.core.launcher.Main.run(Main.java:981)",
        "\tat com.ibm.wsspi.bootstrap.WSPreLauncher.launchEclipse(WSPreLauncher.java:425)",
        "\tat com.ibm.wsspi.bootstrap.WSPreLauncher.main(WSPreLauncher.java:178)"
    ],
    "stdout": "Deploying KYC_Remediation from WAR file: /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war\nDeployment failed. Check the output for errors.",
    "stdout_lines": [
        "Deploying KYC_Remediation from WAR file: /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war",
        "Deployment failed. Check the output for errors."
    ]
}
...ignoring
===================

#!/bin/bash

# Server details (adapt these variables to your environment)
WAS_HOST="10.15.11.209"
WAS_PORT="9043" # Change to your WAS administrative port, often 9043 for HTTPS
WAS_ADMIN_USER="deployer"
WAS_ADMIN_PASSWORD="deployer@123"

# WAR file and application details
WAR_FILE_PATH="/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war"
APP_NAME="KYC_Remediation"
CONTEXT_ROOT="KYC_Remediation"

# Combine all shared libraries into a single string
SHARED_LIB=$(printf ",%s" "$@")
SHARED_LIB=${SHARED_LIB:1} # Remove the leading comma

# Path to wsadmin.sh (adjust for your WAS installation)
WSADMIN="/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/wsadmin.sh"

# wsadmin script content
WSADMIN_SCRIPT="
# Connect to WebSphere Application Server
AdminConfig.connect('$WAS_ADMIN_USER', '$WAS_ADMIN_PASSWORD')

# Check if the application already exists
if AdminApp.list().find('$APP_NAME') != -1:
    print('Application $APP_NAME already exists. Skipping installation.')
else:
    # Install the application with Parent Last class loader policy
    AdminApp.install('$WAR_FILE_PATH', '[ -appname $APP_NAME -contextroot $CONTEXT_ROOT -MapModulesToServers [[ .* .* WebSphere:cell=YourCellName,node=YourNodeName,server=YourServerName ]] -MapWebModToVH [[ .* .* default_host ]] -classloaderMode PARENT_LAST ]')
    # Install the application
    #AdminApp.install('$WAR_FILE_PATH', '[ -appname $APP_NAME -contextroot $CONTEXT_ROOT -MapWebModToVH [[ .* .* default_host ]] ]')
    # Map shared libraries (Optional: Adjust or remove according to your requirements)
    AdminConfig.create('LibraryRef', AdminConfig.getid('/Deployment:$APP_NAME/'), '[[libraryName $SHARED_LIB]]')
    # Save configuration changes
    AdminConfig.save()

# Disconnect from the server
AdminConfig.disconnect()
"

# Check if shared libraries were provided
if [ -z "$SHARED_LIB" ]; then
    echo "No shared libraries provided. Deployment failed."
    exit 1
fi

# Execute the script with wsadmin
echo "Deploying $APP_NAME from WAR file: $WAR_FILE_PATH"
echo "$WSADMIN_SCRIPT" | $WSADMIN -lang jython -conntype SOAP -host $WAS_HOST -port $WAS_PORT -user $WAS_ADMIN_USER -password $WAS_ADMIN_PASSWORD

if [ $? -eq 0 ]; then
    echo "Deployment of $APP_NAME completed successfully."
else
    echo "Deployment failed. Check the output for errors."
    exit 1
fi
=================

---
- name: Stop WAS
  become: true
  become_user: "{{ ansible_user }}"
  ignore_errors: yes
  shell:
    cmd: |
      /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/stopServer.sh -username your_username -password your_password BPMMBR01 &&
      /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/stopNode.sh -username your_username -password your_password

- name: Start WAS
  become: true
  become_user: "{{ ansible_user }}"
  shell:
    cmd: |
      /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/startNode.sh -username your_username -password your_password &&
      /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/startServer.sh -username your_username -password your_password BPMMBR01
===========================

- name: Stop WAS
  become: true
  become_user: "{{ ansible_user }}"
  ignore_errors: yes
  shell:
    cmd: |
      /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/stopServer.sh BPMMBR01 &&
      /ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/stopNode.sh
