#!/bin/bash

# Extract release.zip on Target Server
sudo -u itdevtra tar -xzf "{{ Profile_home }}/{{ zip_file_name }}" -C "{{ Profile_home }}/"

# Run ls -la on the Target Server
sudo -u itdevtra ls -la "{{ Profile_home }}/release/" > ls_result.txt

# Display ls -la result
cat ls_result.txt

# Read release.txt content
release_content=$(sudo -u itdevtra cat "{{ Profile_home }}/release/release.txt")

# Copy application files to targeted location on Target Server
IFS=$'\n'
for line in $release_content; do
  source_file=$(echo $line | sed 's/\(.*\),\(.*\)/\1/')
  target_file=$(echo $line | sed 's/\(.*\),\(.*\)/\2/')
  sudo -u itdevtra cp "{{ Profile_home }}/release/$source_file" "{{ targeted_location }}/$target_file"
done

# Run ls -la on the Target Server
sudo -u itdevtra ls -la "{{ targeted_location }}" > ls_result_targeted.txt

# Display ls -la result
cat ls_result_targeted.txt
