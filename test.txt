---
- name: Download zip from GitHub packages on Runner
  delegate_to: localhost
  run_once: true
  get_url:
    url: "{{ zip_file_url }}"
    dest: "/tmp/{{ zip_file_name }}"
    headers:
      Authorization: "token {{ github_token }}"

- name: Copy zip to Target Server
  copy:
    src: "/tmp/{{ zip_file_name }}"
    dest: "{{ Profile_home }}/{{ zip_file_name }}"

- name: Extract release.zip in the temp directory within Profile_home
  become: true
  become_user: itdevtra
  shell: 'unzip -q "{{ Profile_home }}/{{ zip_file_name }}" -d "{{ Profile_home }}/temp_directory/"'

- name: Read release.txt content
  become: true
  become_user: itdevtra
  shell: 'while IFS=, read -r file target; do cp "{{ Profile_home }}/temp_directory/$file" "{{ Profile_home }}/$target"; done < "{{ Profile_home }}/temp_directory/release.txt"'
