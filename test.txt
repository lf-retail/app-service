name: IBPS deployment

on:
  workflow_dispatch:

jobs:
  deploy:
    runs-on:
      group: rakbank-self-hosted-runner
      labels: dehitdevtra1

    environment:
      GITHUB_TOKEN: ${{ secrets.TOKEN_GITHUB }}

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Debug Working Directory
      run: |
        ls -al      

    - name: Make deploy.sh and rollback.sh executable
      run: |
        chmod +x deploy.sh rollback.sh      

    - name: Run Ansible Playbook
      run: |
        cd ${{ github.workspace }}
        ansible-playbook -b --extra-vars "target=target_jb destination=$destination" ./playbook/IBPS-deployment.yml
