using release.yml

name: Release Pipeline

on:
  workflow_dispatch:
    inputs:
      releaseVersion:
        description: 'Release Version'
        required: true
        default: '1.0.0'
      choice:
        type: choice
        description: Select a service
        options:
        - Rakbank-DEH-Onboarding/RetailOnboarding-AccMS
      Organization:
        type: choice
        description: Select an Organization
        options:
        - Rakbank-DEH-Onboarding
        default: Rakbank-DEH-Onboarding

jobs:
  initial_build:
    runs-on: ubuntu-latest
    steps:
      - name: Get Token
        id: get-workflow-token
        uses: peter-murray/workflow-application-token-action@v2
        with:
          application_id: 403159
          application_private_key: ${{ secrets.DEVOPSTOKEN_DEH }}
      - name: Display selected inputs
        run: |
          echo "Selected Release Version: ${{ github.event.inputs.releaseVersion }}"
          echo "Selected Repository: ${{ github.event.inputs.choice }}"
          echo "Selected Organization: ${{ github.event.inputs.Organization }}"
      
      - name: Checkout selected repository
        uses: actions/checkout@v4
        with:
          repository: ${{ github.event.inputs.choice }}
          ref: feature/version-test
          token: ${{ steps.get-workflow-token.outputs.token }}

      - name: Create and push new branch
        run: |
          git checkout -b rel.${{ github.event.inputs.releaseVersion }}
          git push origin rel.${{ github.event.inputs.releaseVersion }}
          
      - name: Checkout the new branch (rel.x.x.x)
        uses: actions/checkout@v4
        with:
          repository: ${{ github.event.inputs.choice }}
          ref: rel.${{ github.event.inputs.releaseVersion }}
          token: ${{ steps.get-workflow-token.outputs.token }}

  call_reusable_workflow:
    needs: initial_build
    uses: Rakbank-DEH-Onboarding/RetailOnboarding-AccMS/.github/workflows/ci-gradle-build.yml@dev
    secrets: inherit
    with:
      Organization: ${{ github.event.inputs.Organization }}
      repoName: ${{ github.event.inputs.choice }}
      releaseVersion: ${{ github.event.inputs.releaseVersion }}

using release-ci-test-new.yml

name: Gradle_Build

permissions:
  security-events: write

on:
  workflow_call:
    secrets:
      token:
        required: true
    inputs:
      #releaseVersion:
       # required: true
        #type: string
      repoName:
        required: true
        type: string 
      branchName:
        type: string
        required: true
      #Organization:
       # required: true
        #type: string
env:
  REPOSITORY: ${{ inputs.repoName }}
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    #- name: Get Token
     # id: get-workflow-token
      #uses: peter-murray/workflow-application-token-action@v2
      #with:
       # application_id: 403159
        #application_private_key: ${{ secrets.DEVOPSTOKEN_DEH }}
        #organization: ${{ env.ORGANIZATION }}

    - name: Check Out Code from Dispatched Repo
      uses: actions/checkout@v3
      with:
        repository: ${{ inputs.repoName }}
        ref: release/r-${{inputs.releaseVersion}}
        token: ${{ secrets.GITHUB_TOKEN }}
        #token: ${{ steps.get-workflow-token.outputs.token }}

    - name: Set up JDK
      uses: actions/setup-java@v2
      with:
        distribution: 'adopt'
        java-version: '8'

    - name: Grant execute permission for Gradle
      run: chmod +x gradle-4.10.1/bin/gradle

    - name: Build with bundled Gradle
      run: ./gradle-4.10.1/bin/gradle build -PbuildVersion=${{ github.event.inputs.version }}
      env:
        USERNAME_GITHUB: ${{ secrets.USERNAME_GITHUB }}
        TOKEN_GITHUB: ${{ secrets.TOKEN_GITHUB }}
    
    - name: List generated WAR files
      run: ls build/libs

    - name: Publish to GitHub Packages
      run: |
        ./gradle-4.10.1/bin/gradle publish -PbuildVersion=${{ github.event.inputs.version }}
      env:
        USERNAME_GITHUB: ${{ secrets.USERNAME_GITHUB }}
        TOKEN_GITHUB: ${{ secrets.TOKEN_GITHUB }}

and getting error:
  remote: Repository not found.
  Error: fatal: repository 'https://github.com/Rakbank-DEH-Onboarding/RetailOnboarding-AccMS/' not found
  The process '/usr/bin/git' failed with exit code 128
  Waiting 18 seconds before trying again
  /usr/bin/git -c protocol.version=2 fetch --no-tags --prune --progress --no-recurse-submodules --depth=1 origin +refs/heads/release/r-2.0.0.8*:refs/remotes/origin/release/r-2.0.0.8* +refs/tags/release/r-2.0.0.8*:refs/tags/release/r-2.0.0.8*
  remote: Repository not found.
  Error: fatal: repository 'https://github.com/Rakbank-DEH-Onboarding/RetailOnboarding-AccMS/' not found
  The process '/usr/bin/git' failed with exit code 128
  Waiting 10 seconds before trying again
  /usr/bin/git -c protocol.version=2 fetch --no-tags --prune --progress --no-recurse-submodules --depth=1 origin +refs/heads/release/r-2.0.0.8*:refs/remotes/origin/release/r-2.0.0.8* +refs/tags/release/r-2.0.0.8*:refs/tags/release/r-2.0.0.8*
  remote: Repository not found.
  Error: fatal: repository 'https://github.com/Rakbank-DEH-Onboarding/RetailOnboarding-AccMS/' not found
  Error: The process '/usr/bin/git' failed with exit code 128
