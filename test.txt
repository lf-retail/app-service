name: IBPS-warfileinstall
run-name: IBPS-warfileinstall-${{ github.event.inputs.release_version }}
on:
  workflow_dispatch:
    inputs:
      release_version:
        description: 'Release version to deploy'
        required: true 
        type: string
      war_file_path:
        description: 'Path to the WAR file on the target server'
        required: true
        type: string
        default: '/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/installedApps/antibpsapp1Cell01/KYC_Remediation.war'
      war_file_name:
        description: 'Name of the WAR file'
        required: true
        type: string
        default: 'KYC_Remediation.war'
      app_name:
        description: 'Name of the deployed application'
        required: true
        type: string
        default: 'KYC_Remediation_war'
      context_root:
        description: 'Context root of the deployed application'
        required: true
        type: string
        default: '/KYC_Remediation'


jobs:
  deploy:
    runs-on:
     group: rakbank-self-hosted-runner
     labels: dehitdevtra1

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Debug Working Directory
      run: |
        ls -al
        pwd
    - name: Make war-install-in-was.sh executable
      run: |
        chmod +x war-install-in-was.sh
  
    - name: Run Ansible Playbook
      env:
        TOKEN_GITHUB: ${{ secrets.TOKEN_GITHUB }}
        RELEASE_VERSION: ${{ github.event.inputs.release_version }}
        WAR_FILE_PATH: ${{ github.event.inputs.war_file_path }}
        WAR_FILE_NAME: ${{ github.event.inputs.war_file_name }}
        APP_NAME: ${{ github.event.inputs.app_name }}
        CONTEXT_ROOT: ${{ github.event.inputs.context_root }}
      run: |
        cd ${{ github.workspace }}
        ansible-playbook -vvv -b --extra-vars "target=target_wasuat209 destination=${{ github.workspace }} release_version=${RELEASE_VERSION} war_file_path=${WAR_FILE_PATH} war_file_name=${WAR_FILE_NAME} app_name=${APP_NAME} context_root=${CONTEXT_ROOT}" ./playbook/IBPS-warfileinstall.yml #Cluster ip:10.15.11.209
        #ansible-playbook -vvv -b --extra-vars "target=target_wasuat210 destination=${{ github.workspace }} release_version=${RELEASE_VERSION} war_file_path=${WAR_FILE_PATH} war_file_name=${WAR_FILE_NAME} app_name=${APP_NAME} context_root=${CONTEXT_ROOT}" ./playbook/IBPS-warfileinstall.yml #Cluster ip:10.15.11.210
        #ansible-playbook -vvv -b --extra-vars "target=target_wasreplica86 destination=${{ github.workspace }} release_version=${RELEASE_VERSION} war_file_path=${WAR_FILE_PATH} war_file_name=${WAR_FILE_NAME} app_name=${APP_NAME} context_root=${CONTEXT_ROOT}" ./playbook/IBPS-warfileinstall.yml #replica ip:10.15.24.86

================

---
github_token: "{{ lookup('env', 'TOKEN_GITHUB') }}"
release_version: "{{ lookup('env', 'RELEASE_VERSION') }}"
ansible_user: "itdevtra"
Profile_home: "/ibm/IBM/Application/release"

# Server details
WAR_FILE_PATH:  "{{ lookup('env', 'WAR_FILE_PATH') }}"
WAR_FILE_NAME:  "{{ lookup('env', 'WAR_FILE_NAME') }}"
APP_NAME:  "{{ lookup('env', 'APP_NAME') }}"
CONTEXT_ROOT:  "{{ lookup('env', 'CONTEXT_ROOT') }}"
WAS_HOST: "10.15.11.209"
WAS_PORT: "8879"
WAS_ADMIN_USER: "deployer"
WAS_ADMIN_PASSWORD: "deployer@123"
CELL_NAME: "antibpsapp1Cell01"
CLUSTER_NAME: "BPMCLUSTER"
WSADMIN: "/ibm/IBM/WebSphere/AppServer/profiles/AppSrv01/bin/wsadmin.sh"
...
===================

rakbank-internal/ibps-was-ansible-cd/.github/workflows/IBPS-warfileinstall.yml@refs/heads/feature/changes-new-update
================

Hi Anisur Rahman/Hritik,

I'm reaching out to confirm whether the deployment of the KYC_Remediation.war file to the WebSphere Application Server (WAS) cluster was successful.

Below are the details for your reference:

Cluster IP: 10.15.11.209
Nodes: antibpsapp1Node01, antibpsapp2Node01
Application Name: KYC_Remediation.war

Could you please verify if the installation was completed without any issues?

Thanks,
Shanmuganathan M
==========================

Hi Hritik,

We implemented CD pipeline so today we ran once again so please verify today the WAR file installation is completed in WAS console.

Thanks,
Shanmuganathan M
=======================

/ansible/GITHUB_RUNNER/actions-runner10/_work/ibps-was-ansible-cd/ibps-was-ansible-cd/
