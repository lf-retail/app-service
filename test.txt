- hosts: '{{ target }}'
  become: yes
  become_method: sudo
  gather_facts: no
  tasks:
    - name: Execute deployment script
      become_user: root
      shell: "/bin/bash -c 'cd {{ destination }} && ./deploy.sh'"
      args:
        chdir: "{{ destination }}"
      register: deploy_result
      ignore_errors: yes

    - name: Rollback on Deployment Failure
      become_user: root
      shell: "/bin/bash -c 'cd {{ destination }} && ./rollback.sh change.log'"
      args:
        chdir: "{{ destination }}"
      when: deploy_result|failed
