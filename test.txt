name: IBPS deployment

on:
  workflow_dispatch:

jobs:
  deploy:
    runs-on:
      group: rakbank-self-hosted-runner
      labels: dehitdevtra1

    environment:
      GITHUB_TOKEN: ${{ secrets.TOKEN_GITHUB }}

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Debug Working Directory
      run: |
        ls -al      

    - name: Make deploy.sh and rollback.sh executable
      run: |
        chmod +x deploy.sh rollback.sh      

    - name: Run Ansible Playbook
      run: |
        cd ${{ github.workspace }}
        ansible-playbook -b --extra-vars "target=target_jb destination=$destination" ./playbook/IBPS-deployment.yml
==============================
Run cd /ansible/GITHUB_RUNNER/actions-runner10/_work/IBPS-Deployment/IBPS-Deployment

PLAY [target_jb] ***************************************************************

TASK [Gathering Facts] *********************************************************
ok: [ANT3CASAPPS01]

TASK [Execute deployment script] ***********************************************
fatal: [ANT3CASAPPS01]: FAILED! => {"msg": "The task includes an option with an undefined variable. The error was: 'github' is undefined\n\nThe error appears to be in '/ansible/GITHUB_RUNNER/actions-runner10/_work/IBPS-Deployment/IBPS-Deployment/playbook/IBPS-deployment.yml': line 7, column 7, but may\nbe elsewhere in the file depending on the exact syntax problem.\n\nThe offending line appears to be:\n\n  tasks:\n    - name: Execute deployment script\n      ^ here\n"}
...ignoring

TASK [Rollback on Deployment Failure] ******************************************
fatal: [ANT3CASAPPS01]: FAILED! => {"msg": "The task includes an option with an undefined variable. The error was: 'github' is undefined\n\nThe error appears to be in '/ansible/GITHUB_RUNNER/actions-runner10/_work/IBPS-Deployment/IBPS-Deployment/playbook/IBPS-deployment.yml': line 22, column 7, but may\nbe elsewhere in the file depending on the exact syntax problem.\n\nThe offending line appears to be:\n\n\n    - name: Rollback on Deployment Failure\n      ^ here\n"}

PLAY RECAP *********************************************************************
ANT3CASAPPS01              : ok=2    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=1   

Error: Process completed with exit code 2.
