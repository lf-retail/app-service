- name: Deploy Application
  become_user: root
  shell: "/bin/bash -c 'cd {{ deployment_directory }} && ./deploy.sh'"
  args:
    chdir: "{{ deployment_directory }}"
  register: deploy_result
  ignore_errors: yes

- name: Rollback on Deployment Failure
  become_user: root
  shell: "/bin/bash -c 'cd {{ deployment_directory }} && ./rollback.sh change.log'"
  args:
    chdir: "{{ deployment_directory }}"
  when: deploy_result|failed
