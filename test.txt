- hosts: '{{ target }}'
  become: yes
  become_user: itdevtra
  gather_facts: yes
  tasks:
    - name: Execute deployment script
      script:
        cmd: "{{ playbook_dir }}/deploy.sh"
      register: deploy_result
      ignore_errors: yes

    - name: Rollback on Deployment Failure
      script:
        cmd: "{{ playbook_dir }}/rollback.sh change.log"
      when: deploy_result|failed
