---
- name: Download and Move Release
  hosts: localhost
  gather_facts: yes
  tasks:
    - name: Download release.zip from GitHub Packages
      github_release:
        owner: your-github-username
        repo: your-repo
        asset_name: release.zip
        token: "{{ TOKEN_GITHUB }}"
        dest: "{{ github.workspace }}/release.zip"
      delegate_to: localhost
      register: download_result

    - name: Fail if download fails
      fail:
        msg: "Failed to download release.zip from GitHub Packages"
      when: not download_result.changed

    - name: Create temp directory on target server
      ansible.builtin.shell:
        cmd: 'mkdir -p /path/on/target/server/temp_directory'
      delegate_to: your-target-server

    - name: Transfer release.zip to target server temp directory
      ansible.builtin.copy:
        src: "{{ github.workspace }}/release.zip"
        dest: "/path/on/target/server/temp_directory/release.zip"
      delegate_to: localhost


==================

#!/bin/bash

# Step 1: Extract release.zip in the temp directory on the targeted server
unzip -q /path/on/target/server/temp_directory/release.zip -d /path/on/target/server/temp_directory/

# Step 2: Read release.txt content on the targeted server
while IFS=, read -r file target; do
    # Step 3: Copy application files to targeted location on the targeted server
    cp "/path/on/target/server/temp_directory/$file" "$target"
done < /path/on/target/server/temp_directory/release.txt

echo "Deployment completed successfully."
