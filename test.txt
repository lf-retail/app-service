#!/bin/bash

Profile_home: "$1"

echo "Profile_home: $Profile_home"

===================

TASK [IBPS-deployment : Run deploy on Target Server] ***************************
task path: /ansible/GITHUB_RUNNER/actions-runner10/_work/ibps-was-ansible-cd/ibps-was-ansible-cd/roles/IBPS-deployment/tasks/main.yml:34
<10.15.13.148> ESTABLISH SSH CONNECTION FOR USER: itdevtra
<10.15.13.148> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o Port=22 -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="itdevtra"' -o ConnectTimeout=30 -o ControlPath=/home/itdevtra/.ansible/cp/2b6c10444a 10.15.13.148 '/bin/sh -c '"'"'( umask 77 && mkdir -p "` echo /tmp `"&& mkdir /tmp/ansible-tmp-1706261684.5816512-847723-77822631036710 && echo ansible-tmp-1706261684.5816512-847723-77822631036710="` echo /tmp/ansible-tmp-1706261684.5816512-847723-77822631036710 `" ) && sleep 0'"'"''
<10.15.13.148> (0, b'ansible-tmp-1706261684.5816512-847723-77822631036710=/tmp/ansible-tmp-1706261684.5816512-847723-77822631036710\n', b'')
Using module file /usr/lib/python3.6/site-packages/ansible/modules/commands/command.py
<10.15.13.148> PUT /home/itdevtra/.ansible/tmp/ansible-local-8476356ip20i25/tmpro0ri83e TO /tmp/ansible-tmp-1706261684.5816512-847723-77822631036710/AnsiballZ_command.py
<10.15.13.148> SSH: EXEC sftp -b - -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o Port=22 -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="itdevtra"' -o ConnectTimeout=30 -o ControlPath=/home/itdevtra/.ansible/cp/2b6c10444a '[10.15.13.148]'
<10.15.13.148> (0, b'sftp> put /home/itdevtra/.ansible/tmp/ansible-local-8476356ip20i25/tmpro0ri83e /tmp/ansible-tmp-1706261684.5816512-847723-77822631036710/AnsiballZ_command.py\n', b'')
<10.15.13.148> ESTABLISH SSH CONNECTION FOR USER: itdevtra
<10.15.13.148> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o Port=22 -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="itdevtra"' -o ConnectTimeout=30 -o ControlPath=/home/itdevtra/.ansible/cp/2b6c10444a 10.15.13.148 '/bin/sh -c '"'"'chmod u+x /tmp/ansible-tmp-1706261684.5816512-847723-77822631036710/ /tmp/ansible-tmp-1706261684.5816512-847723-77822631036710/AnsiballZ_command.py && sleep 0'"'"''
<10.15.13.148> (0, b'', b'')
<10.15.13.148> ESTABLISH SSH CONNECTION FOR USER: itdevtra
<10.15.13.148> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o Port=22 -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="itdevtra"' -o ConnectTimeout=30 -o ControlPath=/home/itdevtra/.ansible/cp/2b6c10444a -tt 10.15.13.148 '/bin/sh -c '"'"'/usr/bin/python /tmp/ansible-tmp-1706261684.5816512-847723-77822631036710/AnsiballZ_command.py && sleep 0'"'"''
<10.15.13.148> (0, b'\r\n{"changed": true, "end": "2024-01-26 13:35:42.315179", "stdout": "Profile_home: ", "cmd": "cd /ibm/IBM-CAS/WebSphere/AppServer/profiles/AppSrv01/bin && ./deploy.sh \'/ibm/IBM-CAS/WebSphere/AppServer/profiles/AppSrv01/bin\'", "rc": 0, "start": "2024-01-26 13:35:41.998519", "stderr": "./deploy.sh: line 3: Profile_home:: command not found", "delta": "0:00:00.316660", "invocation": {"module_args": {"creates": null, "executable": null, "_uses_shell": true, "strip_empty_ends": true, "_raw_params": "cd /ibm/IBM-CAS/WebSphere/AppServer/profiles/AppSrv01/bin && ./deploy.sh \'/ibm/IBM-CAS/WebSphere/AppServer/profiles/AppSrv01/bin\'", "removes": null, "argv": null, "warn": false, "chdir": null, "stdin_add_newline": true, "stdin": null}}}\r\n', b'Shared connection to 10.15.13.148 closed.\r\n')
<10.15.13.148> ESTABLISH SSH CONNECTION FOR USER: itdevtra
<10.15.13.148> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o Port=22 -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="itdevtra"' -o ConnectTimeout=30 -o ControlPath=/home/itdevtra/.ansible/cp/2b6c10444a 10.15.13.148 '/bin/sh -c '"'"'rm -f -r /tmp/ansible-tmp-1706261684.5816512-847723-77822631036710/ > /dev/null 2>&1 && sleep 0'"'"''
<10.15.13.148> (0, b'', b'')
changed: [ANT3CASAPPS01] => {
    "changed": true,
    "cmd": "cd /ibm/IBM-CAS/WebSphere/AppServer/profiles/AppSrv01/bin && ./deploy.sh '/ibm/IBM-CAS/WebSphere/AppServer/profiles/AppSrv01/bin'",
    "delta": "0:00:00.316660",
    "end": "2024-01-26 13:35:42.315179",
    "invocation": {
        "module_args": {
            "_raw_params": "cd /ibm/IBM-CAS/WebSphere/AppServer/profiles/AppSrv01/bin && ./deploy.sh '/ibm/IBM-CAS/WebSphere/AppServer/profiles/AppSrv01/bin'",
            "_uses_shell": true,
            "argv": null,
            "chdir": null,
            "creates": null,
            "executable": null,
            "removes": null,
            "stdin": null,
            "stdin_add_newline": true,
            "strip_empty_ends": true,
            "warn": false
        }
    },
    "rc": 0,
    "start": "2024-01-26 13:35:41.998519",
    "stderr": "./deploy.sh: line 3: Profile_home:: command not found",
    "stderr_lines": [
        "./deploy.sh: line 3: Profile_home:: command not found"
    ],
    "stdout": "Profile_home: ",
    "stdout_lines": [
        "Profile_home: "
    ]
}
META: ran handlers
META: ran handlers
=============
- name: Run deploy on Target Server
  become: yes
  become_user: "{{ ansible_user }}"
  #shell: "cd {{ Profile_home }} && ./deploy.sh '{{ Profile_home }}'" #'{{ ibps_server }}' '{{ github_token }}' '{{ zip_file_url }}' '{{ zip_file_name }}' '{{ Profile_home }}' '{{ targeted_location }}' '{{ ansible_user }}' '{{ backup_location }}'"
  shell: "cd {{ Profile_home }} && ./deploy.sh '{{ Profile_home }}'"
  register: deploy_result
  ignore_errors: yes
