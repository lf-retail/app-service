---
- name: Download zip from GitHub packages on Runner
  delegate_to: localhost
  run_once: true
  get_url:
    url: "{{ zip_file_url }}"
    dest: "/tmp/{{ zip_file_name }}"
    headers:
      Authorization: "token {{ github_token }}"

- name: Copy release.zip to Target Server
  copy:
    src: "/tmp/{{ zip_file_name }}"
    dest: "{{ Profile_home }}/{{ zip_file_name }}"

- name: Extract release.zip on Target Server
  become: true
  become_user: itdevtra
  unarchive:
    src: "{{ Profile_home }}/{{ zip_file_name }}"
    dest: "{{ Profile_home }}/"
    remote_src: yes
  register: unarchive_result  

- name: Run ls -la on the Target Server
  become: true
  become_user: itdevtra
  command: "ls -la {{ Profile_home }}/release/"
  register: ls_result    

- name: Display ls -la result
  debug:
    var: ls_result.stdout_lines   

- name: Read release.txt content
  become: true
  become_user: itdevtra
  shell: cat "{{ Profile_home }}/release/release.txt"
  register: release_content

- name: Copy application files to targeted location on Target Server
  become: true
  become_user: itdevtra
  command: "cd {{ Profile_home }}/release && cp {{ item.0 }} {{ item.1 }}"
  loop: "{{ release_content.stdout_lines | map('regex_replace', '^(.+?),(.+)$', '\\1 \\2') | list }}"
  when: release_content.stdout_lines | length > 0

- name: Run ls -la on the Target Server
  become: true
  become_user: itdevtra
  command: "ls -la {{ targeted_location }}"
  register: ls_result    

- name: Display ls -la result
  debug:
    var: ls_result.stdout_lines 

============================

---
ibps_server: 10.15.13.148:9043
github_token: "{{ lookup('env', 'TOKEN_GITHUB') }}"
zip_file_url: "https://maven.pkg.github.com/rakbank-internal/IBPS-Deployment/Rak/IBPS/release/2.0.0/release-2.0.0.zip"
zip_file_name: "{{ zip_file_url | basename }}"
Profile_home: "/ibm/IBM-CAS/WebSphere/AppServer/profiles/AppSrv01/bin"
targeted_location: "/ibm/IBM-CAS/WebSphere/AppServer/profiles/AppSrv01/installedApps/ANT2CASAPPS01Node01Cell"
ansible_user: itdevtra
backup_location: /ibm/IBM-CAS/WebSphere/AppServer/profiles/AppSrv01/backup
...
