---
jboss_controller: 10.15.14.105:18990
#jboss_user: "{{ lookup('env', 'JBOSS_USER') }}"
#jboss_password: "{{ lookup('env', 'JBOSS_PASSWORD') }}"
github_token: "{{ lookup('env', 'TOKEN_GITHUB') }}"
war_file_url: "https://maven.pkg.github.com/Rakbank-DEH-Onboarding/RetailOnboarding-AccMS/com/rakbank/infosys/lib/retailonboarding-accms/1111/retailonboarding-accms-1111.war"
war_file_name: "{{ war_file_url | basename }}"
jboss_home: "/apps/JBOSSEAP7.2_EXP_DIGIHUB_DIGITAL_BANK/EAP-7.2.0"
jboss_deployments_dir: "{{ jboss_home }}/standalone/deployments"
#dest_path: "/apps/JBOSSEAP7.2_EXP_DIGIHUB_DIGITAL_BANK/EAP-7.2.0/standalone/{{ war_file_name }}"
...

---
- name: Download WAR from GitHub packages
  get_url:
    url: "{{ war_file_url }}"
    dest: "{{ jboss_deployments_dir }}/{{ war_file_name }}"
    headers:
      Authorization: "token {{ github_token }}"

- name: Undeploy existing WAR (if it exists) from JBoss
  shell: "{{ jboss_home }}/bin/jboss-cli.sh --connect --controller={{ jboss_controller }} --command='undeploy {{ war_file_name }} --keep-content'"
  ignore_errors: yes  

- name: Deploy the WAR file to JBoss
  shell: "{{ jboss_home }}/bin/jboss-cli.sh --connect --controller={{ jboss_controller }} --command='deploy --force {{ jboss_deployments_dir }}/{{ war_file_name }}'"
...
