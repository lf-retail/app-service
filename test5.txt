name: hif & config
on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest

    steps:
      - name: Checkout actions code
        uses: actions/checkout@v4
        with:
          repository: Rakbank-DEH-Onboarding/SMEDigitalBank
          token: ${{ secrets.TOKEN_GITHUB }}

      - name: Run Batch File
        uses: ./.github/actions/workdir

=========================

name: 'run hif and config'
description: 'run batch file'
runs:
  using: 'composite'
  steps:
    - name: Set up JDK 1.8
      uses: actions/setup-java@v1
      with:
        java-version: 1.8
    - name: Set Environment Variables
      run: |
        echo "HIF_OUTPUT=${{ github.workspace }}/hif/output" >> $GITHUB_ENV
        echo "APPLICATION_CONFIGURATION_FILE=${{ github.workspace }}/hif/BankAway.properties" >> $GITHUB_ENV
        echo "FEBA_SYS_PATH=${{ github.workspace }}/hif/WorkingDirectory/data" >> $GITHUB_ENV
        echo "classpath=${{ github.workspace }}/hif/lib/*;" >> $GITHUB_ENV
        echo "XML_DIR=${{ github.workspace }}/hif/Input" >> $GITHUB_ENV
      shell: bash

    - name: run bat file
      shell: powershell
      run: |
        $batFile = "${{ github.workspace }}\hif\devrun_HIFCompiler.bat"
        Write-Host "Running $batFile..."
        Set-Location -Path "${{ github.workspace }}\hif"
        Write-Host "Current directory: $(Get-Location)"
        & cmd /c "call $batFile"
      env:
        DEBUG_MODE: 0
        GITHUB_WORKSPACE: ${{ github.workspace }}
===============
@echo off
setlocal enabledelayedexpansion

rem Assuming the current directory is already set to where the batch file resides
set PATH=%JAVA_HOME%/bin;%PATH%
set HIF_OUTPUT=%GITHUB_WORKSPACE%\hif\Output\
set DEBUG_MODE=0
set APPLICATION_CONFIGURATION_FILE=%GITHUB_WORKSPACE%\hif\BankAway.properties
set FEBA_SYS_PATH=%GITHUB_WORKSPACE%\hif\WorkingDirectory\data
set classpath=%GITHUB_WORKSPACE%\hif\lib\*;

rem Check if the Output directory exists, if not create it
if not exist "%HIF_OUTPUT%" mkdir "%HIF_OUTPUT%"

rem Directory containing the XML files
set "XML_DIR=%GITHUB_WORKSPACE%\hif\Input"

rem Loop over each XML file in the directory
for /R %XML_DIR% %%F in (*.xml) do (
    set "TOOLS_SPEC=%%F"
    java -DAPPLICATION_CONFIGURATION_FILE=!APPLICATION_CONFIGURATION_FILE! -DFEBA_SYS_PATH=!FEBA_SYS_PATH! -DFEBA_EXTENSION_DIRECTORY=%GITHUB_WORKSPACE%\hif\WorkingDirectory\extension -DFEBA_MERGE_DIRECTORY=%GITHUB_WORKSPACE%\hif\WorkingDirectory\merge -classpath !classpath! com.infosys.feba.framework.hif.compiler.LaunchHIFCompilerTool -SOURCE !TOOLS_SPEC! -OUTPUT !HIF_OUTPUT! -xsdValidation N
)

rem File sorting logic begins here
set DEST_DIR_REQ=%GITHUB_WORKSPACE%\workdir\extension\hif\host\default\request
set DEST_DIR_TRANS=%GITHUB_WORKSPACE%\workdir\extension\hif\host\default\transformer

rem Ensure destination directories exist
if not exist "%DEST_DIR_REQ%" mkdir "%DEST_DIR_REQ%"
if not exist "%DEST_DIR_TRANS%" mkdir "%DEST_DIR_TRANS%"

rem Copy Request files
for %%f in (%HIF_OUTPUT%\*Request*.hif) do (
    echo Copying %%f to %DEST_DIR_REQ%
    copy %%f %DEST_DIR_REQ%
)

rem Copy Transformer files
for %%f in (%HIF_OUTPUT%\*Transformer*.hif) do (
    echo Copying %%f to %DEST_DIR_TRANS%
    copy %%f %DEST_DIR_TRANS%
)

echo Verifying copied files in request directory:
dir %DEST_DIR_REQ%\*Request*.hif

echo Verifying copied files in transformer directory:
dir %DEST_DIR_TRANS%\*Transformer*.hif

pause
endlocal
==================
